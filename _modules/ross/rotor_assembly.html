<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>ross.rotor_assembly &#8212; ross 0.2.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/sphinx_copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../_static/ross-logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/ross-logo.svg"></span>
          ROSS</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../examples/tutorial.html">Tutorial</a></li>
                <li><a href="../../examples.html">Examples</a></li>
                <li><a href="../../api.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#install-python">Install Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#install-ross">Install ROSS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial.html#Materials">Materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial.html#ShaftElement">ShaftElement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial.html#ShaftTaperedElement">ShaftTaperedElement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial.html#DiskElement">DiskElement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial.html#BearingElement">BearingElement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial.html#Rotor">Rotor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial.html#Running-the-simulation">Running the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial.html#Obtaining-results">Obtaining results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_05_08_01.html">Example 1 - Number of DOF influence in Natural Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_05_08_02.html">Example 2 - Effect of varying slenderness ratio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_05_09_01.html">Example 3 - Isotropic Bearings, asymmetrical rotor.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_05_09_02.html">Example 4 - Anisotropic Bearings.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_05_09_04.html">Example 5 - Cross-coupled bearings.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_05_09_05.html">Example 6 - Isotropic bearings with damping.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_05_09_06.html">Example 7 - Hydrodinamic Bearings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_05_09_09.html">Example 8 - Overhung rotor.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../download.html">Download notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api.html#material">Material</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html#elements">Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html#rotor">Rotor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#feedback-and-contribution">Feedback and Contribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#version-control-system-git">Version-control system: Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#code-style-black">Code style: Black</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#tests">Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#integrated-development-environment-pycharm">Integrated development environment: PyCharm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#how-to-contribute-to-ross-using-git">How to contribute to ross using git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#making-new-releases">Making new releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes.html#version-0-2-0-beta-release">Version 0.2.0 (beta release)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes.html#version-0-1-0-alpha-release">Version 0.1.0 (alpha release)</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for ross.rotor_assembly</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">namedtuple</span><span class="p">,</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">bokeh.palettes</span> <span class="k">as</span> <span class="nn">bp</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="k">as</span> <span class="nn">sio</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="k">as</span> <span class="nn">la</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">scipy.sparse.linalg</span> <span class="k">as</span> <span class="nn">las</span>
<span class="kn">import</span> <span class="nn">toml</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span>
<span class="kn">from</span> <span class="nn">bokeh.models.glyphs</span> <span class="kn">import</span> <span class="n">Text</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">cycler</span> <span class="kn">import</span> <span class="n">cycler</span>
<span class="kn">from</span> <span class="nn">ross.utils</span> <span class="kn">import</span> <span class="n">convert</span>

<span class="kn">import</span> <span class="nn">ross</span>
<span class="kn">from</span> <span class="nn">ross.bearing_seal_element</span> <span class="kn">import</span> <span class="n">BearingElement</span><span class="p">,</span> <span class="n">SealElement</span>
<span class="kn">from</span> <span class="nn">ross.disk_element</span> <span class="kn">import</span> <span class="n">DiskElement</span>
<span class="kn">from</span> <span class="nn">ross.materials</span> <span class="kn">import</span> <span class="n">steel</span>
<span class="kn">from</span> <span class="nn">ross.results</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CampbellResults</span><span class="p">,</span>
    <span class="n">ConvergenceResults</span><span class="p">,</span>
    <span class="n">ForcedResponseResults</span><span class="p">,</span>
    <span class="n">FrequencyResponseResults</span><span class="p">,</span>
    <span class="n">ModalResults</span><span class="p">,</span>
    <span class="n">StaticResults</span><span class="p">,</span>
    <span class="n">SummaryResults</span><span class="p">,</span>
    <span class="n">TimeResponseResults</span><span class="p">,</span>
    <span class="n">OrbitResponseResults</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ross.shaft_element</span> <span class="kn">import</span> <span class="n">ShaftElement</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Rotor&quot;</span><span class="p">,</span> <span class="s2">&quot;CoAxialRotor&quot;</span><span class="p">,</span> <span class="s2">&quot;rotor_example&quot;</span><span class="p">,</span> <span class="s2">&quot;coaxrotor_example&quot;</span><span class="p">]</span>

<span class="c1"># set style and colors</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-white&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;lines.linewidth&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="s2">&quot;axes.grid&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;axes.linewidth&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s2">&quot;grid.color&quot;</span><span class="p">:</span> <span class="s2">&quot;.9&quot;</span><span class="p">,</span>
        <span class="s2">&quot;grid.linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="s2">&quot;legend.frameon&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;legend.framealpha&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># set bokeh palette of colors</span>
<span class="n">bokeh_colors</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">RdGy</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>

<span class="n">_orig_rc_params</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">seaborn_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#4c72b0&quot;</span><span class="p">,</span> <span class="s2">&quot;#55a868&quot;</span><span class="p">,</span> <span class="s2">&quot;#c44e52&quot;</span><span class="p">,</span> <span class="s2">&quot;#8172b2&quot;</span><span class="p">,</span> <span class="s2">&quot;#ccb974&quot;</span><span class="p">,</span> <span class="s2">&quot;#64b5cd&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="Rotor"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor">[docs]</a><span class="k">class</span> <span class="nc">Rotor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A rotor object.</span>

<span class="sd">    This class will create a rotor with the shaft,</span>
<span class="sd">    disk, bearing and seal elements provided.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shaft_elements : list</span>
<span class="sd">        List with the shaft elements</span>
<span class="sd">    disk_elements : list</span>
<span class="sd">        List with the disk elements</span>
<span class="sd">    bearing_elements : list</span>
<span class="sd">        List with the bearing elements</span>
<span class="sd">    point_mass_elements: list</span>
<span class="sd">        List with the point mass elements</span>
<span class="sd">    sparse : bool, optional</span>
<span class="sd">        If sparse, eigenvalues will be calculated with arpack.</span>
<span class="sd">        Default is True.</span>
<span class="sd">    n_eigen : int, optional</span>
<span class="sd">        Number of eigenvalues calculated by arpack.</span>
<span class="sd">        Default is 12.</span>
<span class="sd">    tag : str</span>
<span class="sd">        A tag for the rotor</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A rotor object.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    evalues : array</span>
<span class="sd">        Rotor&#39;s eigenvalues.</span>
<span class="sd">    evectors : array</span>
<span class="sd">        Rotor&#39;s eigenvectors.</span>
<span class="sd">    wn : array</span>
<span class="sd">        Rotor&#39;s natural frequencies in rad/s.</span>
<span class="sd">    wd : array</span>
<span class="sd">        Rotor&#39;s damped natural frequencies in rad/s.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #  Rotor without damping with 2 shaft elements 1 disk and 2 bearings</span>
<span class="sd">    &gt;&gt;&gt; import ross as rs</span>
<span class="sd">    &gt;&gt;&gt; steel = rs.materials.steel</span>
<span class="sd">    &gt;&gt;&gt; z = 0</span>
<span class="sd">    &gt;&gt;&gt; le = 0.25</span>
<span class="sd">    &gt;&gt;&gt; i_d = 0</span>
<span class="sd">    &gt;&gt;&gt; o_d = 0.05</span>
<span class="sd">    &gt;&gt;&gt; tim0 = rs.ShaftElement(le, i_d, o_d,</span>
<span class="sd">    ...                        material=steel,</span>
<span class="sd">    ...                        shear_effects=True,</span>
<span class="sd">    ...                        rotary_inertia=True,</span>
<span class="sd">    ...                        gyroscopic=True)</span>
<span class="sd">    &gt;&gt;&gt; tim1 = rs.ShaftElement(le, i_d, o_d,</span>
<span class="sd">    ...                        material=steel,</span>
<span class="sd">    ...                        shear_effects=True,</span>
<span class="sd">    ...                        rotary_inertia=True,</span>
<span class="sd">    ...                        gyroscopic=True)</span>
<span class="sd">    &gt;&gt;&gt; shaft_elm = [tim0, tim1]</span>
<span class="sd">    &gt;&gt;&gt; disk0 = rs.DiskElement.from_geometry(1, steel, 0.07, 0.05, 0.28)</span>
<span class="sd">    &gt;&gt;&gt; stf = 1e6</span>
<span class="sd">    &gt;&gt;&gt; bearing0 = rs.BearingElement(0, kxx=stf, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearing1 = rs.BearingElement(2, kxx=stf, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; rotor = rs.Rotor(shaft_elm, [disk0], [bearing0, bearing1])</span>
<span class="sd">    &gt;&gt;&gt; modal = rotor.run_modal(speed=0)</span>
<span class="sd">    &gt;&gt;&gt; modal.wd[0] # doctest: +ELLIPSIS</span>
<span class="sd">    215.3707...</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Rotor.__init__"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">shaft_elements</span><span class="p">,</span>
        <span class="n">disk_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">bearing_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">point_mass_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">n_eigen</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">min_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rated_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;sparse&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;n_eigen&quot;</span><span class="p">:</span> <span class="n">n_eigen</span><span class="p">,</span>
            <span class="s2">&quot;min_w&quot;</span><span class="p">:</span> <span class="n">min_w</span><span class="p">,</span>
            <span class="s2">&quot;max_w&quot;</span><span class="p">:</span> <span class="n">max_w</span><span class="p">,</span>
            <span class="s2">&quot;rated_w&quot;</span><span class="p">:</span> <span class="n">rated_w</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Rotor 0&quot;</span>

        <span class="c1">####################################################</span>
        <span class="c1"># Config attributes</span>
        <span class="c1">####################################################</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span> <span class="o">=</span> <span class="n">sparse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_eigen</span> <span class="o">=</span> <span class="n">n_eigen</span>
        <span class="c1"># operational speeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_w</span> <span class="o">=</span> <span class="n">min_w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_w</span> <span class="o">=</span> <span class="n">max_w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span> <span class="o">=</span> <span class="n">rated_w</span>

        <span class="c1">####################################################</span>

        <span class="c1"># flatten shaft_elements</span>
        <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
                    <span class="k">yield from</span> <span class="n">flatten</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">el</span>

        <span class="c1"># flatten and make a copy for shaft elements to avoid altering</span>
        <span class="c1"># attributes for elements that might be used in different rotors</span>
        <span class="c1"># e.g. altering shaft_element.n</span>
        <span class="n">shaft_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">flatten</span><span class="p">(</span><span class="n">shaft_elements</span><span class="p">)]</span>

        <span class="c1"># set n for each shaft element</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shaft_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">disk_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">disk_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">bearing_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bearing_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">point_mass_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">point_mass_elements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">disk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disk_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">disk</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Disk &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">brg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">brg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span> <span class="ow">and</span> <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Bearing &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">brg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;SealElement&quot;</span> <span class="ow">and</span> <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Seal &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p_mass</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">point_mass_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Point Mass &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span> <span class="o">=</span> <span class="n">disk_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span> <span class="o">=</span> <span class="n">point_mass_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">el</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">flatten</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="c1">####################################################</span>
        <span class="c1"># Rotor summary</span>
        <span class="c1">####################################################</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_link&quot;</span><span class="p">,</span>
            <span class="s2">&quot;L&quot;</span><span class="p">,</span>
            <span class="s2">&quot;node_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;node_pos_r&quot;</span><span class="p">,</span>
            <span class="s2">&quot;idl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;odl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;idr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;odr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;i_d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;o_d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;beam_cg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axial_cg_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;y_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;material&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rho&quot;</span><span class="p">,</span>
            <span class="s2">&quot;volume&quot;</span><span class="p">,</span>
            <span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">df_shaft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="n">df_disks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="n">df_bearings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_seals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;SealElement&quot;</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_point_mass</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">])</span>

        <span class="n">nodes_pos_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">nodes_pos_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>
                <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">+</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;n_l&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;n_l&quot;</span><span class="p">]:</span>
                <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>
            <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">+</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;axial_cg_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axial_cg_pos</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">df_shaft</span><span class="p">,</span> <span class="n">df_disks</span><span class="p">,</span> <span class="n">df_bearings</span><span class="p">,</span> <span class="n">df_point_mass</span><span class="p">,</span> <span class="n">df_seals</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;n_l&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>

        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">))</span>
        <span class="n">df_disks</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_disks</span><span class="p">))</span>
        <span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_bearings</span><span class="p">))</span>
        <span class="n">df_seals</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_seals</span><span class="p">))</span>
        <span class="n">df_point_mass</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_point_mass</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span> <span class="o">=</span> <span class="n">df_disks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span> <span class="o">=</span> <span class="n">df_bearings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span> <span class="o">=</span> <span class="n">df_shaft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_point_mass</span> <span class="o">=</span> <span class="n">df_point_mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_seals</span> <span class="o">=</span> <span class="n">df_seals</span>

        <span class="c1"># check consistence for disks and bearings location</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_point_mass</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_loc_point_mass</span> <span class="o">=</span> <span class="n">df_point_mass</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_loc_point_mass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_location</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">max_loc_point_mass</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">n_l</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_location</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trying to set disk or bearing outside shaft&quot;</span><span class="p">)</span>

        <span class="c1"># nodes axial position and diameter</span>
        <span class="n">nodes_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">nodes_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span> <span class="o">=</span> <span class="n">nodes_pos</span>

        <span class="n">nodes_i_d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">nodes_i_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_i_d</span> <span class="o">=</span> <span class="n">nodes_i_d</span>

        <span class="n">nodes_o_d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">nodes_o_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_o_d</span> <span class="o">=</span> <span class="n">nodes_o_d</span>

        <span class="n">shaft_elements_length</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;L&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements_length</span> <span class="o">=</span> <span class="n">shaft_elements_length</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># rotor mass can also be calculated with self.M()[::4, ::4].sum()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_disks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">disk</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_shaft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sh_el</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">sh_el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_disks</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_shaft</span>

        <span class="c1"># rotor center of mass and total inertia</span>
        <span class="n">CG_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">sh</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">CG_dsk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CG</span> <span class="o">=</span> <span class="n">CG_sh</span> <span class="o">+</span> <span class="n">CG_dsk</span>

        <span class="n">Ip_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sh</span><span class="o">.</span><span class="n">Im</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="n">Ip_dsk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">disk</span><span class="o">.</span><span class="n">Ip</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span> <span class="o">=</span> <span class="n">Ip_sh</span> <span class="o">+</span> <span class="n">Ip_dsk</span>

        <span class="c1"># values for evalues and evectors will be calculated by self.run_modal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evalues</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evectors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lti</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_v0</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># used to call eigs</span>

        <span class="c1"># number of dofs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">n</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">shaft_elements</span><span class="p">])</span>
            <span class="o">+</span> <span class="mi">8</span>
            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">([</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">point_mass_elements</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># global indexes for dofs</span>
        <span class="n">n_last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dof_mapping</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_mapping</span><span class="p">()</span>
            <span class="n">global_dof_mapping</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">dof_letter</span><span class="p">,</span> <span class="n">dof_number</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">dof_letter</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dof_number</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">dof_tuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;GlobalIndex&quot;</span><span class="p">,</span> <span class="n">global_dof_mapping</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">global_dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">global_dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">v</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="s2">&quot;n_link&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">&lt;=</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x_</span><span class="si">{elm.n_link}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;y_</span><span class="si">{elm.n_link}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x_</span><span class="si">{elm.n_link}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="p">)</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;y_</span><span class="si">{elm.n_link}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">5</span>
                    <span class="p">)</span>

            <span class="n">dof_tuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;GlobalIndex&quot;</span><span class="p">,</span> <span class="n">global_dof_mapping</span><span class="p">)</span>
            <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span> <span class="o">=</span> <span class="n">dof_tuple</span><span class="p">(</span><span class="o">**</span><span class="n">global_dof_mapping</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;dof_global_index&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>

        <span class="c1">#  values for static analysis will be calculated by def static</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_y</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># define positions for disks</span>
        <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">disk_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">nodes_o_d</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>

        <span class="c1"># define positions for bearings</span>
        <span class="c1"># check if there are bearings without location</span>
        <span class="n">bearings_no_zloc</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">b</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearing_elements</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="c1"># cycle while there are bearings without a z location</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bearings_no_zloc</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearings_no_zloc</span><span class="p">:</span>
                    <span class="c1"># first check if b.n is on list, if not, check for n_link</span>
                    <span class="n">node_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span>
                    <span class="n">node_r</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">node_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_l&quot;</span>
                        <span class="p">]</span>
                        <span class="n">node_r</span> <span class="o">=</span> <span class="n">node_l</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_l</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bearings_no_zloc</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_r</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bearings_no_zloc</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">dfb</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">z_positions</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">z_pos</span> <span class="ow">in</span> <span class="n">z_positions</span><span class="p">:</span>
            <span class="n">dfb_z_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">nodes_pos_l</span> <span class="o">==</span> <span class="n">z_pos</span><span class="p">]</span>
            <span class="n">dfb_z_pos</span> <span class="o">=</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;n_l&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span>
                            <span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;n_l&quot;</span><span class="p">])</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span>
                            <span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;n_r&quot;</span><span class="p">])</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="nb">max</span><span class="p">(</span>
                                <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span>
                                    <span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;n_l&quot;</span><span class="p">])</span>
                                <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                            <span class="p">),</span>
                            <span class="nb">max</span><span class="p">(</span>
                                <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span>
                                    <span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;n_l&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                                <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="n">mean_od</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">nodes_o_d</span><span class="p">)</span>
            <span class="n">scale_size</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">mean_od</span>
            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="n">y_pos</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scale_size</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;y_pos_sup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos_sup</span>
                <span class="n">y_pos</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mean_od</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_pos_sup</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mean_od</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># define position for point mass elements</span>
        <span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">point_mass_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span></div>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Equality method for comparasions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : obj</span>
<span class="sd">            parameter for comparasion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        True if other is equal to the reference parameter.</span>
<span class="sd">        False if not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">elements</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Rotor.run_modal"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.run_modal">[docs]</a>    <span class="k">def</span> <span class="nf">run_modal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to calculate eigenvalues and eigvectors for a given rotor system</span>
<span class="sd">        This method is automatically called when a rotor is instantiated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        evalues : array</span>
<span class="sd">            Eigenvalues array</span>
<span class="sd">        evectors : array</span>
<span class="sd">            Eigenvectors array</span>
<span class="sd">        wn : array</span>
<span class="sd">            Undamped natural frequencies array</span>
<span class="sd">        wd : array</span>
<span class="sd">            Damped natural frequencies array</span>
<span class="sd">        log_dec : array</span>
<span class="sd">            Logarithmic decrement array</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; modal = rotor.run_modal(speed=0)</span>
<span class="sd">        &gt;&gt;&gt; modal.wn[:2]</span>
<span class="sd">        array([91.79655318, 96.28899977])</span>
<span class="sd">        &gt;&gt;&gt; modal.wd[:2]</span>
<span class="sd">        array([91.79655318, 96.28899977])</span>
<span class="sd">        &gt;&gt;&gt; modal.plot_mode3D(0) # doctest: +ELLIPSIS</span>
<span class="sd">        (&lt;Figure ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigen</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="n">wn_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">evalues</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">wn</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">evalues</span><span class="p">))[:</span><span class="n">wn_len</span><span class="p">]</span>
        <span class="n">wd</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">evalues</span><span class="p">))[:</span><span class="n">wn_len</span><span class="p">]</span>
        <span class="n">damping_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">evalues</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">evalues</span><span class="p">))[:</span><span class="n">wn_len</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">log_dec</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">damping_ratio</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">damping_ratio</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">lti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lti</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="n">modal_results</span> <span class="o">=</span> <span class="n">ModalResults</span><span class="p">(</span>
            <span class="n">speed</span><span class="p">,</span>
            <span class="n">evalues</span><span class="p">,</span>
            <span class="n">evectors</span><span class="p">,</span>
            <span class="n">wn</span><span class="p">,</span>
            <span class="n">wd</span><span class="p">,</span>
            <span class="n">damping_ratio</span><span class="p">,</span>
            <span class="n">log_dec</span><span class="p">,</span>
            <span class="n">lti</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements_length</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">modal_results</span></div>

<div class="viewcode-block" id="Rotor.convergence"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.convergence">[docs]</a>    <span class="k">def</span> <span class="nf">convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_eigval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">err_max</span><span class="o">=</span><span class="mf">1e-02</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to analyze the eigenvalues convergence through the number of</span>
<span class="sd">        shaft elements. Every new run doubles the number os shaft elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_eigval : int</span>
<span class="sd">            The nth eigenvalue which the convergence analysis will run.</span>
<span class="sd">            Default is 0 (the first eigenvalue).</span>
<span class="sd">        err_max : float</span>
<span class="sd">            Maximum allowable convergence error.</span>
<span class="sd">            Default is 1e-02</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Lists containing the information about:</span>
<span class="sd">            The number or elements in each run;</span>
<span class="sd">            The relative error calculated in each run;</span>
<span class="sd">            The natural frequency calculated in each run.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; i_d = 0</span>
<span class="sd">        &gt;&gt;&gt; o_d = 0.05</span>
<span class="sd">        &gt;&gt;&gt; n = 6</span>
<span class="sd">        &gt;&gt;&gt; L = [0.25 for _ in range(n)]</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; shaft_elem = [rs.ShaftElement(l, i_d, o_d, material=steel,</span>
<span class="sd">        ... shear_effects=True, rotary_inertia=True, gyroscopic=True) for l in L]</span>
<span class="sd">        &gt;&gt;&gt; disk0 = DiskElement.from_geometry(2, steel, 0.07, 0.05, 0.28)</span>
<span class="sd">        &gt;&gt;&gt; disk1 = DiskElement.from_geometry(4, steel, 0.07, 0.05, 0.35)</span>
<span class="sd">        &gt;&gt;&gt; bearing0 = BearingElement(0, kxx=1e6, kyy=8e5, cxx=2e3)</span>
<span class="sd">        &gt;&gt;&gt; bearing1 = BearingElement(6, kxx=1e6, kyy=8e5, cxx=2e3)</span>
<span class="sd">        &gt;&gt;&gt; rotor0 = Rotor(shaft_elem, [disk0, disk1], [bearing0, bearing1])</span>
<span class="sd">        &gt;&gt;&gt; len(rotor0.shaft_elements)</span>
<span class="sd">        6</span>
<span class="sd">        &gt;&gt;&gt; convergence = rotor0.convergence(n_eigval=0, err_max=1e-08)</span>
<span class="sd">        &gt;&gt;&gt; len(rotor0.shaft_elements)</span>
<span class="sd">        96</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">el_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">)])</span>
        <span class="n">eigv_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">error_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eigv_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eigv_arr</span><span class="p">,</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="n">n_eigval</span><span class="p">])</span>

        <span class="c1"># this value is up to start the loop while</span>
        <span class="n">error</span> <span class="o">=</span> <span class="mf">1.0e10</span>
        <span class="n">nel_r</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="k">while</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="n">err_max</span><span class="p">:</span>
            <span class="n">shaft_elem</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">disk_elem</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">brgs_elem</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">:</span>
                <span class="n">le</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">L</span> <span class="o">/</span> <span class="n">nel_r</span>
                <span class="n">odl</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">odl</span>
                <span class="n">odr</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">odr</span>
                <span class="n">idl</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">idl</span>
                <span class="n">idr</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">idr</span>

                <span class="c1"># loop to double the number of element</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nel_r</span><span class="p">):</span>
                    <span class="n">odr</span> <span class="o">=</span> <span class="p">((</span><span class="n">nel_r</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">odl</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">odr</span><span class="p">)</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="n">idr</span> <span class="o">=</span> <span class="p">((</span><span class="n">nel_r</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">idl</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">idr</span><span class="p">)</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="n">odl</span> <span class="o">=</span> <span class="p">((</span><span class="n">nel_r</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">odl</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">odr</span><span class="p">)</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="n">idl</span> <span class="o">=</span> <span class="p">((</span><span class="n">nel_r</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">idl</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">idr</span><span class="p">)</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="n">shaft_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">ShaftElement</span><span class="p">(</span>
                            <span class="n">L</span><span class="o">=</span><span class="n">le</span><span class="p">,</span>
                            <span class="n">idl</span><span class="o">=</span><span class="n">idl</span><span class="p">,</span>
                            <span class="n">odl</span><span class="o">=</span><span class="n">odl</span><span class="p">,</span>
                            <span class="n">idr</span><span class="o">=</span><span class="n">idr</span><span class="p">,</span>
                            <span class="n">odr</span><span class="o">=</span><span class="n">odr</span><span class="p">,</span>
                            <span class="n">material</span><span class="o">=</span><span class="n">shaft</span><span class="o">.</span><span class="n">material</span><span class="p">,</span>
                            <span class="n">shear_effects</span><span class="o">=</span><span class="n">shaft</span><span class="o">.</span><span class="n">shear_effects</span><span class="p">,</span>
                            <span class="n">rotary_inertia</span><span class="o">=</span><span class="n">shaft</span><span class="o">.</span><span class="n">rotary_inertia</span><span class="p">,</span>
                            <span class="n">gyroscopic</span><span class="o">=</span><span class="n">shaft</span><span class="o">.</span><span class="n">gyroscopic</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">for</span> <span class="n">DiskEl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">:</span>
                <span class="n">aux_DiskEl</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">DiskEl</span><span class="p">)</span>
                <span class="n">aux_DiskEl</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">DiskEl</span><span class="o">.</span><span class="n">n</span>
                <span class="n">disk_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_DiskEl</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">Brg_SealEl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
                <span class="n">aux_Brg_SealEl</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">Brg_SealEl</span><span class="p">)</span>
                <span class="n">aux_Brg_SealEl</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">Brg_SealEl</span><span class="o">.</span><span class="n">n</span>
                <span class="n">brgs_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_Brg_SealEl</span><span class="p">)</span>

            <span class="n">aux_rotor</span> <span class="o">=</span> <span class="n">Rotor</span><span class="p">(</span><span class="n">shaft_elem</span><span class="p">,</span> <span class="n">disk_elem</span><span class="p">,</span> <span class="n">brgs_elem</span><span class="p">,</span> <span class="n">n_eigen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_eigen</span><span class="p">)</span>
            <span class="n">aux_modal</span> <span class="o">=</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">eigv_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eigv_arr</span><span class="p">,</span> <span class="n">aux_modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="n">n_eigval</span><span class="p">])</span>
            <span class="n">el_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el_num</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shaft_elem</span><span class="p">))</span>

            <span class="n">error</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">eigv_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">eigv_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">eigv_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">eigv_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">error</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">error</span>

            <span class="n">error_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_arr</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">error</span><span class="p">)</span>
            <span class="n">nel_r</span> <span class="o">*=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_arr</span> <span class="o">=</span> <span class="n">error_arr</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">ConvergenceResults</span><span class="p">(</span><span class="n">el_num</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">eigv_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">error_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.M"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.M">[docs]</a>    <span class="k">def</span> <span class="nf">M</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Mass matrix for an instance of a rotor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Mass matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.M()[:4, :4]</span>
<span class="sd">        array([[ 1.42050794,  0.        ,  0.        ,  0.04931719],</span>
<span class="sd">               [ 0.        ,  1.42050794, -0.04931719,  0.        ],</span>
<span class="sd">               [ 0.        , -0.04931719,  0.00231392,  0.        ],</span>
<span class="sd">               [ 0.04931719,  0.        ,  0.        ,  0.00231392]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">M0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>
            <span class="n">M0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">M</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">M0</span></div>

<div class="viewcode-block" id="Rotor.K"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.K">[docs]</a>    <span class="k">def</span> <span class="nf">K</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stiffness matrix for an instance of a rotor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frequency : float, optional</span>
<span class="sd">            Excitation frequency.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Stiffness matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; np.round(rotor.K(0)[:4, :4]/1e6)</span>
<span class="sd">        array([[47.,  0.,  0.,  6.],</span>
<span class="sd">               [ 0., 46., -6.,  0.],</span>
<span class="sd">               [ 0., -6.,  1.,  0.],</span>
<span class="sd">               [ 6.,  0.,  0.,  1.]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">K0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">K0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">K0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">K</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">K0</span></div>

<div class="viewcode-block" id="Rotor.C"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.C">[docs]</a>    <span class="k">def</span> <span class="nf">C</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Damping matrix for an instance of a rotor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frequency : float</span>
<span class="sd">            Excitation frequency.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Damping matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.C(0)[:4, :4]</span>
<span class="sd">        array([[0., 0., 0., 0.],</span>
<span class="sd">               [0., 0., 0., 0.],</span>
<span class="sd">               [0., 0., 0., 0.],</span>
<span class="sd">               [0., 0., 0., 0.]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">C0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">C</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">C0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">C</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">C0</span></div>

<div class="viewcode-block" id="Rotor.G"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.G">[docs]</a>    <span class="k">def</span> <span class="nf">G</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gyroscopic matrix for an instance of a rotor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Gyroscopic matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.G()[:4, :4]</span>
<span class="sd">        array([[ 0.        ,  0.01943344, -0.00022681,  0.        ],</span>
<span class="sd">               [-0.01943344,  0.        ,  0.        , -0.00022681],</span>
<span class="sd">               [ 0.00022681,  0.        ,  0.        ,  0.0001524 ],</span>
<span class="sd">               [ 0.        ,  0.00022681, -0.0001524 ,  0.        ]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">G0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>
            <span class="n">G0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">G</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">G0</span></div>

<div class="viewcode-block" id="Rotor.A"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.A">[docs]</a>    <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;State space matrix for an instance of a rotor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed: float, optional</span>
<span class="sd">            Rotor speed.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        frequency : float, optional</span>
<span class="sd">            Excitation frequency. Default is rotor speed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        State space matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; np.round(rotor.A()[50:56, :2])</span>
<span class="sd">        array([[     0.,  10927.],</span>
<span class="sd">               [-10924.,     -0.],</span>
<span class="sd">               [  -174.,      0.],</span>
<span class="sd">               [    -0.,   -174.],</span>
<span class="sd">               [    -0.,  10723.],</span>
<span class="sd">               [-10719.,     -0.]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frequency</span> <span class="o">=</span> <span class="n">speed</span>

        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">)</span>

        <span class="c1"># fmt: off</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Z</span><span class="p">,</span> <span class="n">I</span><span class="p">]),</span>
             <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">frequency</span><span class="p">)),</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">()</span> <span class="o">*</span> <span class="n">speed</span><span class="p">))])])</span>
        <span class="c1"># fmt: on</span>

        <span class="k">return</span> <span class="n">A</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function used to generate an index that will sort</span>
<span class="sd">        eigenvalues and eigenvectors based on the imaginary (wd)</span>
<span class="sd">        part of the eigenvalues. Positive eigenvalues will be</span>
<span class="sd">        positioned at the first half of the array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        eigenvalues: array</span>
<span class="sd">            Array with the eigenvalues.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        idx:</span>
<span class="sd">            An array with indices that will sort the</span>
<span class="sd">            eigenvalues and eigenvectors.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; evalues, evectors = rotor._eigen(0, sorted_=True)</span>
<span class="sd">        &gt;&gt;&gt; idx = rotor._index(evalues)</span>
<span class="sd">        &gt;&gt;&gt; idx[:6] # doctest: +ELLIPSIS</span>
<span class="sd">        array([0, 1, 2, 3, 4, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># avoid float point errors when sorting</span>
        <span class="n">evals_truncated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">evals_truncated</span><span class="p">)</span>  <span class="c1"># First column</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">evals_truncated</span><span class="p">)</span>  <span class="c1"># Second column</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>  <span class="c1"># Sort by imag (wd), then by absolute (wn)</span>
        <span class="c1"># Positive eigenvalues first</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]]</span>
        <span class="n">negative</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]]</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">positive</span><span class="p">,</span> <span class="n">negative</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">idx</span>

    <span class="k">def</span> <span class="nf">_eigen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sorted_</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This method will return the eigenvalues and eigenvectors of the</span>
<span class="sd">        state space matrix A, sorted by the index method which considers</span>
<span class="sd">        the imaginary part (wd) of the eigenvalues for sorting.</span>
<span class="sd">        To avoid sorting use sorted_=False</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed: float</span>
<span class="sd">            Rotor speed.</span>
<span class="sd">        frequency: float</span>
<span class="sd">            Excitation frequency.</span>
<span class="sd">        sorted_: bool, optional</span>
<span class="sd">            Sort considering the imaginary part (wd)</span>
<span class="sd">            Default is True</span>
<span class="sd">        A: np.array, optional</span>
<span class="sd">            Matrix for which eig will be calculated.</span>
<span class="sd">            Defaul is the rotor A matrix.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        evalues: array</span>
<span class="sd">            An array with the eigenvalues</span>
<span class="sd">        evectors array</span>
<span class="sd">            An array with the eigenvectors</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; evalues, evectors = rotor._eigen(0)</span>
<span class="sd">        &gt;&gt;&gt; evalues[0].imag # doctest: +ELLIPSIS</span>
<span class="sd">        91.796...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span> <span class="o">=</span> <span class="n">las</span><span class="o">.</span><span class="n">eigs</span><span class="p">(</span>
                    <span class="n">A</span><span class="p">,</span>
                    <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_eigen</span><span class="p">,</span>
                    <span class="n">sigma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ncv</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_eigen</span><span class="p">,</span>
                    <span class="n">which</span><span class="o">=</span><span class="s2">&quot;LM&quot;</span><span class="p">,</span>
                    <span class="n">v0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_v0</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># store v0 as a linear combination of the previously</span>
                <span class="c1"># calculated eigenvectors to use in the next call to eigs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">evectors</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">las</span><span class="o">.</span><span class="n">ArpackError</span><span class="p">:</span>
                <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sorted_</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span><span class="n">evalues</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">evalues</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">evectors</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_lti</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Continuous-time linear time invariant system.</span>

<span class="sd">        This method is used to create a Continuous-time linear</span>
<span class="sd">        time invariant system for the mdof system.</span>
<span class="sd">        From this system we can obtain poles, impulse response,</span>
<span class="sd">        generate a bode, etc.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed: float</span>
<span class="sd">            Rotor speed.</span>
<span class="sd">        frequency: float, optional</span>
<span class="sd">            Excitation frequency.</span>
<span class="sd">            Default is rotor speed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sys : StateSpaceContinuous</span>
<span class="sd">            Space State Continuos with A, B, C and D matrices</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; A = rotor._lti(speed=0).A</span>
<span class="sd">        &gt;&gt;&gt; B = rotor._lti(speed=0).B</span>
<span class="sd">        &gt;&gt;&gt; C = rotor._lti(speed=0).C</span>
<span class="sd">        &gt;&gt;&gt; D = rotor._lti(speed=0).D</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">)</span>

        <span class="c1"># x&#39; = Ax + Bu</span>
        <span class="n">B2</span> <span class="o">=</span> <span class="n">I</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frequency</span> <span class="o">=</span> <span class="n">speed</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">)</span>
        <span class="c1"># fmt: off</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">Z</span><span class="p">,</span>
                       <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="n">B2</span><span class="p">)])</span>
        <span class="c1"># fmt: on</span>

        <span class="c1"># y = Cx + Du</span>
        <span class="c1"># Observation matrices</span>
        <span class="n">Cd</span> <span class="o">=</span> <span class="n">I</span>
        <span class="n">Cv</span> <span class="o">=</span> <span class="n">Z</span>
        <span class="n">Ca</span> <span class="o">=</span> <span class="n">Z</span>

        <span class="c1"># fmt: off</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Cd</span> <span class="o">-</span> <span class="n">Ca</span> <span class="o">@</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">frequency</span><span class="p">)),</span> <span class="n">Cv</span> <span class="o">-</span> <span class="n">Ca</span> <span class="o">@</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">(</span><span class="n">frequency</span><span class="p">))))</span>
        <span class="c1"># fmt: on</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">Ca</span> <span class="o">@</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="n">B2</span><span class="p">)</span>

        <span class="n">sys</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sys</span>

<div class="viewcode-block" id="Rotor.transfer_matrix"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.transfer_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the fer matrix for the frequency response function (FRF)</span>

<span class="sd">        Paramenters</span>
<span class="sd">        -----------</span>
<span class="sd">        frequency : float, optional</span>
<span class="sd">            Excitation frequency. Default is rotor speed.</span>
<span class="sd">        speed : float, optional</span>
<span class="sd">            Rotating speed. Default is rotor speed (frequency).</span>
<span class="sd">        modes : list, optional</span>
<span class="sd">            List with modes used to calculate the matrix.</span>
<span class="sd">            (all modes will be used if a list is not given).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        H : matrix</span>
<span class="sd">            System transfer matrix</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = 100.0</span>
<span class="sd">        &gt;&gt;&gt; H = rotor.transfer_matrix(speed=speed)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">lti</span><span class="o">.</span><span class="n">B</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">lti</span><span class="o">.</span><span class="n">C</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">lti</span><span class="o">.</span><span class="n">D</span>

        <span class="c1"># calculate eigenvalues and eigenvectors using la.eig to get</span>
        <span class="c1"># left and right eigenvectors.</span>

        <span class="n">evals</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="p">))</span>

        <span class="n">psi_inv</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span>  <span class="c1"># n dof -&gt; number of modes</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span>  <span class="c1"># -&gt; number of desired modes</span>
            <span class="c1"># idx to get each evalue/evector and its conjugate</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">modes</span>  <span class="c1"># modes</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">m</span><span class="p">:]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">)[</span><span class="o">-</span><span class="n">m</span><span class="p">:]</span>  <span class="c1"># conjugates (see how evalues are ordered)</span>

            <span class="n">evals</span> <span class="o">=</span> <span class="n">evals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">),</span> <span class="n">idx</span><span class="p">)]</span>
            <span class="n">psi_inv</span> <span class="o">=</span> <span class="n">psi_inv</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">))]</span>

        <span class="n">diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">-</span> <span class="n">lam</span><span class="p">)</span> <span class="k">for</span> <span class="n">lam</span> <span class="ow">in</span> <span class="n">evals</span><span class="p">])</span>

        <span class="n">H</span> <span class="o">=</span> <span class="n">C</span> <span class="o">@</span> <span class="n">psi</span> <span class="o">@</span> <span class="n">diag</span> <span class="o">@</span> <span class="n">psi_inv</span> <span class="o">@</span> <span class="n">B</span> <span class="o">+</span> <span class="n">D</span>

        <span class="k">return</span> <span class="n">H</span></div>

<div class="viewcode-block" id="Rotor.run_freq_response"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.run_freq_response">[docs]</a>    <span class="k">def</span> <span class="nf">run_freq_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Frequency response for a mdof system.</span>

<span class="sd">        This method returns the frequency response for a mdof system</span>
<span class="sd">        given a range of frequencies and the modes that will be used.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed_range : array, optional</span>
<span class="sd">            Array with the desired range of frequencies (the default</span>
<span class="sd">             is 0 to 1.5 x highest damped natural frequency.</span>
<span class="sd">        modes : list, optional</span>
<span class="sd">            Modes that will be used to calculate the frequency response</span>
<span class="sd">            (all modes will be used if a list is not given).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : array</span>
<span class="sd">            Array with the frequencies, magnitude (dB) of the frequency</span>
<span class="sd">            response for each pair input/output, and</span>
<span class="sd">            phase of the frequency response for each pair input/output..</span>
<span class="sd">            It will be returned if plot=False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 1000, 101)</span>
<span class="sd">        &gt;&gt;&gt; response = rotor.run_freq_response(speed_range=speed)</span>
<span class="sd">        &gt;&gt;&gt; response.magnitude # doctest: +ELLIPSIS</span>
<span class="sd">        array([[[1.00000000e-06, 1.00261725e-06, 1.01076952e-06, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">speed_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">speed_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">modal</span><span class="o">.</span><span class="n">evalues</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="n">freq_resp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">speed_range</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">speed_range</span><span class="p">):</span>
            <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer_matrix</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">)</span>
            <span class="n">freq_resp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">FrequencyResponseResults</span><span class="p">(</span>
            <span class="n">freq_resp</span><span class="o">=</span><span class="n">freq_resp</span><span class="p">,</span>
            <span class="n">speed_range</span><span class="o">=</span><span class="n">speed_range</span><span class="p">,</span>
            <span class="n">magnitude</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">freq_resp</span><span class="p">),</span>
            <span class="n">phase</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">freq_resp</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.run_forced_response"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.run_forced_response">[docs]</a>    <span class="k">def</span> <span class="nf">run_forced_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">speed_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unbalanced response for a mdof system.</span>

<span class="sd">        This method returns the unbalanced response for a mdof system</span>
<span class="sd">        given magnitude and phase of the unbalance, the node where it&#39;s</span>
<span class="sd">        applied and a frequency range.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        force : list</span>
<span class="sd">            Unbalance force in each degree of freedom for each value in omega</span>
<span class="sd">        speed_range : list, float</span>
<span class="sd">            Array with the desired range of frequencies</span>
<span class="sd">        modes : list, optional</span>
<span class="sd">            Modes that will be used to calculate the frequency response</span>
<span class="sd">            (all modes will be used if a list is not given).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        force_resp : array</span>
<span class="sd">            Array with the force response for each node for each frequency</span>
<span class="sd">        speed_range : array</span>
<span class="sd">            Array with the frequencies</span>
<span class="sd">        magnitude : array</span>
<span class="sd">            Magnitude (dB) of the frequency response for node for each frequency</span>
<span class="sd">        phase : array</span>
<span class="sd">            Phase of the frequency response for node for each frequency</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 1000, 101)</span>
<span class="sd">        &gt;&gt;&gt; force = rotor._unbalance_force(3, 10.0, 0.0, speed)</span>
<span class="sd">        &gt;&gt;&gt; resp = rotor.run_forced_response(force=force, speed_range=speed)</span>
<span class="sd">        &gt;&gt;&gt; resp.magnitude # doctest: +ELLIPSIS</span>
<span class="sd">        array([[0.00000000e+00, 5.06073311e-04, 2.10044826e-03, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">freq_resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_response</span><span class="p">(</span><span class="n">speed_range</span><span class="o">=</span><span class="n">speed_range</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">)</span>

        <span class="n">forced_resp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_resp</span><span class="o">.</span><span class="n">speed_range</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq_resp</span><span class="o">.</span><span class="n">speed_range</span><span class="p">)):</span>
            <span class="n">forced_resp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_resp</span><span class="o">.</span><span class="n">freq_resp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">force</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>

        <span class="n">forced_resp</span> <span class="o">=</span> <span class="n">ForcedResponseResults</span><span class="p">(</span>
            <span class="n">forced_resp</span><span class="o">=</span><span class="n">forced_resp</span><span class="p">,</span>
            <span class="n">speed_range</span><span class="o">=</span><span class="n">speed_range</span><span class="p">,</span>
            <span class="n">magnitude</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">forced_resp</span><span class="p">),</span>
            <span class="n">phase</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">forced_resp</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">forced_resp</span></div>

    <span class="k">def</span> <span class="nf">_unbalance_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">omega</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate unbalance force</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node : int</span>
<span class="sd">            Node where the unbalance is applied.</span>
<span class="sd">        magnitude : float</span>
<span class="sd">            Unbalance magnitude (kg.m)</span>
<span class="sd">        phase : float</span>
<span class="sd">            Unbalance phase (rad)</span>
<span class="sd">        omega : list, float</span>
<span class="sd">            Array with the desired range of frequencies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        F0 : list</span>
<span class="sd">            Unbalance force in each degree of freedom for each value in omega</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 1000, 101)</span>
<span class="sd">        &gt;&gt;&gt; rotor._unbalance_force(3, 10.0, 0.0, speed)[12] # doctest: +ELLIPSIS</span>
<span class="sd">        array([0.000e+00+0.j, 1.000e+03+0.j, 4.000e+03+0.j, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">F0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">me</span> <span class="o">=</span> <span class="n">magnitude</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">me</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">delta</span><span class="p">),</span>
                <span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">me</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">delta</span><span class="p">),</span>
                <span class="mi">0</span><span class="p">,</span>  <span class="c1"># 1j*(Id - Ip)*beta*np.exp(1j*gamma),</span>
                <span class="mi">0</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># (Id - Ip)*beta*np.exp(1j*gamma)])</span>

        <span class="n">n0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">node</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">n0</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">omega</span><span class="p">):</span>
            <span class="n">F0</span><span class="p">[</span><span class="n">n0</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b0</span>

        <span class="k">return</span> <span class="n">F0</span>

<div class="viewcode-block" id="Rotor.unbalance_response"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.unbalance_response">[docs]</a>    <span class="k">def</span> <span class="nf">unbalance_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">frequency_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unbalanced response for a mdof system.</span>

<span class="sd">        This method returns the unbalanced response for a mdof system</span>
<span class="sd">        given magnitide and phase of the unbalance, the node where it&#39;s</span>
<span class="sd">        applied and a frequency range.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node : list, int</span>
<span class="sd">            Node where the unbalance is applied.</span>
<span class="sd">        magnitude : list, float</span>
<span class="sd">            Unbalance magnitude (kg.m)</span>
<span class="sd">        phase : list, float</span>
<span class="sd">            Unbalance phase (rad)</span>
<span class="sd">        frequency_range : list, float</span>
<span class="sd">            Array with the desired range of frequencies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        force_resp : array</span>
<span class="sd">            Array with the force response for each node for each frequency</span>
<span class="sd">        speed_range : array</span>
<span class="sd">            Array with the frequencies</span>
<span class="sd">        magdb : array</span>
<span class="sd">            Magnitude (dB) of the frequency response for each pair input/output.</span>
<span class="sd">            The order of the array is: [output, input, magnitude]</span>
<span class="sd">        phase : array</span>
<span class="sd">            Phase of the frequency response for each pair input/output.</span>
<span class="sd">            The order of the array is: [output, input, phase]</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 1000, 101)</span>
<span class="sd">        &gt;&gt;&gt; response = rotor.unbalance_response(node=3, magnitude=10.0, phase=0.0, frequency_range=speed)</span>
<span class="sd">        &gt;&gt;&gt; response.magnitude # doctest: +ELLIPSIS</span>
<span class="sd">        array([[0.00000000e+00, 5.06073311e-04, 2.10044826e-03, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">force</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequency_range</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
                <span class="n">force</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unbalance_force</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">frequency_range</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unbalance_force</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">frequency_range</span><span class="p">)</span>

        <span class="n">forced_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_forced_response</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="n">frequency_range</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">forced_response</span></div>

<div class="viewcode-block" id="Rotor.time_response"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.time_response">[docs]</a>    <span class="k">def</span> <span class="nf">time_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Time response for a rotor.</span>

<span class="sd">        This method returns the time response for a rotor</span>
<span class="sd">        given a force, time and initial conditions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        F : array</span>
<span class="sd">            Force array (needs to have the same length as time array).</span>
<span class="sd">        t : array</span>
<span class="sd">            Time array. (must have the same length than lti.B matrix)</span>
<span class="sd">        ic : array, optional</span>
<span class="sd">            The initial conditions on the state vector (zero by default).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        t : array</span>
<span class="sd">            Time values for the output.</span>
<span class="sd">        yout : array</span>
<span class="sd">            System response.</span>
<span class="sd">        xout : array</span>
<span class="sd">            Time evolution of the state vector.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = 0</span>
<span class="sd">        &gt;&gt;&gt; size = 28</span>
<span class="sd">        &gt;&gt;&gt; t = np.linspace(0, 5, size)</span>
<span class="sd">        &gt;&gt;&gt; F = np.ones((size, rotor.ndof))</span>
<span class="sd">        &gt;&gt;&gt; rotor.time_response(speed, F, t) # doctest: +ELLIPSIS</span>
<span class="sd">        (array([0.        , 0.18518519, 0.37037037, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">signal</span><span class="o">.</span><span class="n">lsim</span><span class="p">(</span><span class="n">modal</span><span class="o">.</span><span class="n">lti</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">X0</span><span class="o">=</span><span class="n">ic</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_plot_rotor_matplotlib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">check_sld</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots a rotor object.</span>

<span class="sd">        This function will take a rotor object and plot its shaft,</span>
<span class="sd">        disks and bearing elements</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : int, optional</span>
<span class="sd">            Increment that will be used to plot nodes label.</span>
<span class="sd">        check_sld : bool</span>
<span class="sd">            If True, checks the slenderness ratio for each element</span>
<span class="sd">        ax : matplotlib plotting axes, optional</span>
<span class="sd">            Axes in which the plot will be drawn.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : matplotlib axes</span>
<span class="sd">            Returns the axes object with the plot.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor._plot_rotor_matplotlib() # doctest: +ELLIPSIS</span>
<span class="sd">        &lt;matplotlib.axes...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="c1">#  plot shaft centerline</span>
        <span class="n">shaft_end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;k-.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">max_diameter</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">disk</span><span class="o">.</span><span class="n">o_d</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">max_diameter</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">shaft</span><span class="o">.</span><span class="n">odl</span> <span class="k">for</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">max_diameter</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">max_diameter</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Axial location (m)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Shaft radius (m)&quot;</span><span class="p">)</span>

        <span class="c1"># plot nodes</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[::</span><span class="n">nodes</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">position</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#6caed6&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">position</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;{node*nodes}&quot;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="s2">&quot;smaller&quot;</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># plot shaft elements</span>
        <span class="k">for</span> <span class="n">sh_elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">sh_elm</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">sh_elm</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">check_sld</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="n">mean_od</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_o_d</span><span class="p">)</span>
        <span class="c1"># plot disk elements</span>
        <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_o_d</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mean_od</span><span class="p">)</span>
            <span class="n">disk</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="c1"># plot bearings</span>
        <span class="k">for</span> <span class="n">bearing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">bearing</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">bearing</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">bearing</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;y_pos_sup&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">y_pos_sup</span><span class="p">)</span>
            <span class="n">bearing</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="c1"># plot point mass</span>
        <span class="k">for</span> <span class="n">p_mass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">)</span>
            <span class="n">p_mass</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">_plot_rotor_bokeh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">check_sld</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bk_ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots a rotor object.</span>

<span class="sd">        This function will take a rotor object and plot its shaft,</span>
<span class="sd">        disks and bearing elements</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : int, optional</span>
<span class="sd">            Increment that will be used to plot nodes label.</span>
<span class="sd">        check_sld : bool</span>
<span class="sd">            If True, checks the slenderness ratio for each element</span>
<span class="sd">        bk_ax : bokeh plotting axes, optional</span>
<span class="sd">            Axes in which the plot will be drawn.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bk_ax : bokeh plotting axes</span>
<span class="sd">            Returns the axes object with the plot.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; figure = rotor._plot_rotor_bokeh()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#  plot shaft centerline</span>
        <span class="n">shaft_end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)</span>

        <span class="c1"># bokeh plot - create a new plot</span>
        <span class="n">bk_ax</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
            <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;pan, wheel_zoom, reset, save&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">x_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">],</span>
            <span class="n">y_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">],</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Rotor model&quot;</span><span class="p">,</span>
            <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Axial location (m)&quot;</span><span class="p">,</span>
            <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Shaft radius (m)&quot;</span><span class="p">,</span>
            <span class="n">match_aspect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;14pt&quot;</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;14pt&quot;</span>

        <span class="c1"># bokeh plot - plot shaft centerline</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">line_dash</span><span class="o">=</span><span class="s2">&quot;dotdash&quot;</span><span class="p">,</span>
            <span class="n">line_color</span><span class="o">=</span><span class="n">bokeh_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># plot nodes</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[::</span><span class="n">nodes</span><span class="p">]):</span>
            <span class="c1"># bokeh plot</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">))</span>
            <span class="n">x_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

        <span class="c1"># bokeh plot - plot nodes</span>
        <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[::</span><span class="n">nodes</span><span class="p">]))</span>

        <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">))</span>

        <span class="n">bk_ax</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">bokeh_colors</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">glyph</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">text_font_style</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
            <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span>
            <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">text_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">text_color</span><span class="o">=</span><span class="n">bokeh_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">add_glyph</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">glyph</span><span class="p">)</span>

        <span class="c1"># plot shaft elements</span>
        <span class="k">for</span> <span class="n">sh_elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">sh_elm</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">hover</span> <span class="o">=</span> <span class="n">sh_elm</span><span class="o">.</span><span class="n">bokeh_patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">check_sld</span><span class="p">,</span> <span class="n">bk_ax</span><span class="p">)</span>

        <span class="n">bk_ax</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>

        <span class="n">mean_od</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_o_d</span><span class="p">)</span>
        <span class="c1"># plot disk elements</span>
        <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_o_d</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mean_od</span><span class="p">)</span>
            <span class="n">hover</span> <span class="o">=</span> <span class="n">disk</span><span class="o">.</span><span class="n">bokeh_patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">bk_ax</span><span class="p">)</span>

        <span class="n">bk_ax</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>

        <span class="c1"># plot bearings</span>
        <span class="k">for</span> <span class="n">bearing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">bearing</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">bearing</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">bearing</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;y_pos_sup&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">y_pos_sup</span><span class="p">)</span>
            <span class="n">bearing</span><span class="o">.</span><span class="n">bokeh_patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">bk_ax</span><span class="p">)</span>

        <span class="c1"># plot point mass</span>
        <span class="k">for</span> <span class="n">p_mass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">)</span>
            <span class="n">hover</span> <span class="o">=</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">bokeh_patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">bk_ax</span><span class="p">)</span>

        <span class="n">bk_ax</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bk_ax</span>

<div class="viewcode-block" id="Rotor.plot_rotor"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.plot_rotor">[docs]</a>    <span class="k">def</span> <span class="nf">plot_rotor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;bokeh&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots a rotor object.</span>

<span class="sd">        This function will take a rotor object and plot its shaft,</span>
<span class="sd">        disks and bearing elements</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : int, optional</span>
<span class="sd">            Increment that will be used to plot nodes label.</span>
<span class="sd">        plot_type : str</span>
<span class="sd">            Matplotlib or bokeh.</span>
<span class="sd">            Default is matplotlib.</span>
<span class="sd">        ax : matplotlib axes, optional</span>
<span class="sd">            Axes in which the plot will be drawn.</span>
<span class="sd">        bk_ax : bokeh plotting axes, optional</span>
<span class="sd">            Axes in which the plot will be drawn.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : matplotlib axes</span>
<span class="sd">            Returns the axes object with the plot.</span>
<span class="sd">        bk_ax : bokeh plotting axes</span>
<span class="sd">            Returns the axes object with the plot.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.plot_rotor() # doctest: +ELLIPSIS</span>
<span class="sd">        Figure...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;matplotlib&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_rotor_matplotlib</span><span class="p">(</span>
                <span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span> <span class="n">check_sld</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;bokeh&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_rotor_bokeh</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span> <span class="n">check_sld</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{plot_type}</span><span class="s2"> is not a valid plot type.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.check_slenderness_ratio"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.check_slenderness_ratio">[docs]</a>    <span class="k">def</span> <span class="nf">check_slenderness_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots a rotor object and check the slenderness ratio</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : int, optional</span>
<span class="sd">            Increment that will be used to plot nodes label.</span>
<span class="sd">        plot_type : str</span>
<span class="sd">            Matplotlib or bokeh.</span>
<span class="sd">            Default is matplotlib.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : matplotlib axes</span>
<span class="sd">            Returns the axes object with the plot.</span>
<span class="sd">        bk_ax : bokeh plotting axes</span>
<span class="sd">            Returns the axes object with the plot.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.check_slenderness_ratio() # doctest: +ELLIPSIS</span>
<span class="sd">        &lt;matplotlib.axes...</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check slenderness ratio of beam elements</span>
        <span class="n">SR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shaft</span><span class="o">.</span><span class="n">slenderness_ratio</span> <span class="o">&lt;</span> <span class="mf">1.6</span><span class="p">:</span>
                <span class="n">SR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SR</span><span class="p">,</span> <span class="n">shaft</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SR</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The beam elements &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">SR</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; have slenderness ratio (G*A*L^2 / EI) of less than 1.6.&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; Results may not converge correctly&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;matplotlib&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_rotor_matplotlib</span><span class="p">(</span>
                <span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span> <span class="n">check_sld</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;bokeh&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_rotor_bokeh</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span> <span class="n">check_sld</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{plot_type}</span><span class="s2"> is not a valid plot type.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.run_campbell"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.run_campbell">[docs]</a>    <span class="k">def</span> <span class="nf">run_campbell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed_range</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">frequency_type</span><span class="o">=</span><span class="s2">&quot;wd&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the Campbell diagram.</span>

<span class="sd">        This function will calculate the damped natural frequencies</span>
<span class="sd">        for a speed range.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed_range : array</span>
<span class="sd">            Array with the speed range in rad/s.</span>
<span class="sd">        frequencies : int, optional</span>
<span class="sd">            Number of frequencies that will be calculated.</span>
<span class="sd">            Default is 6.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : array</span>
<span class="sd">            Array with the damped natural frequencies, log dec and precessions</span>
<span class="sd">            corresponding to each speed of the speed_rad array.</span>
<span class="sd">            It will be returned if plot=False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor1 = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 400, 101)</span>
<span class="sd">        &gt;&gt;&gt; camp = rotor1.run_campbell(speed)</span>
<span class="sd">        &gt;&gt;&gt; camp.plot() # doctest: +ELLIPSIS</span>
<span class="sd">        Figure...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># store in results [speeds(x axis), frequencies[0] or logdec[1] or</span>
        <span class="c1"># whirl[2](y axis), 3]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">speed_range</span><span class="p">),</span> <span class="n">frequencies</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">speed_range</span><span class="p">):</span>
            <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">frequency_type</span> <span class="o">==</span> <span class="s2">&quot;wd&quot;</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wd</span><span class="p">[:</span><span class="n">frequencies</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">log_dec</span><span class="p">[:</span><span class="n">frequencies</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">whirl_values</span><span class="p">()[:</span><span class="n">frequencies</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span><span class="n">frequencies</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">log_dec</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span><span class="n">frequencies</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">whirl_values</span><span class="p">()[</span><span class="n">idx</span><span class="p">][:</span><span class="n">frequencies</span><span class="p">]</span>

            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[:</span><span class="n">frequencies</span><span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">CampbellResults</span><span class="p">(</span>
            <span class="n">speed_range</span><span class="o">=</span><span class="n">speed_range</span><span class="p">,</span>
            <span class="n">wd</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">log_dec</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">whirl_values</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.plot_ucs"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.plot_ucs">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ucs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stiffness_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_html</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot undamped critical speed map.</span>

<span class="sd">        This method will plot the undamped critical speed map for a given range</span>
<span class="sd">        of stiffness values. If the range is not provided, the bearing</span>
<span class="sd">        stiffness at rated speed will be used to create a range.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stiffness_range : tuple, optional</span>
<span class="sd">            Tuple with (start, end) for stiffness range.</span>
<span class="sd">        num : int</span>
<span class="sd">            Number of steps in the range.</span>
<span class="sd">            Default is 20.</span>
<span class="sd">        ax : matplotlib axes, optional</span>
<span class="sd">            Axes in which the plot will be drawn.</span>
<span class="sd">        output_html : Boolean, optional</span>
<span class="sd">            outputs a html file.</span>
<span class="sd">            Default is False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : matplotlib axes</span>
<span class="sd">            Returns the axes object with the plot.</span>
<span class="sd">        bk_ax : bokeh plot axes</span>
<span class="sd">            Returns the axes object with the plot.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; i_d = 0</span>
<span class="sd">        &gt;&gt;&gt; o_d = 0.05</span>
<span class="sd">        &gt;&gt;&gt; n = 6</span>
<span class="sd">        &gt;&gt;&gt; L = [0.25 for _ in range(n)]</span>
<span class="sd">        &gt;&gt;&gt; shaft_elem = [</span>
<span class="sd">        ...     ShaftElement(</span>
<span class="sd">        ...         l, i_d, o_d, material=steel, shear_effects=True,</span>
<span class="sd">        ...         rotary_inertia=True, gyroscopic=True</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     for l in L</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; disk0 = DiskElement.from_geometry(</span>
<span class="sd">        ...     n=2, material=steel, width=0.07, i_d=0.05, o_d=0.28</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; disk1 = DiskElement.from_geometry(</span>
<span class="sd">        ...     n=4, material=steel, width=0.07, i_d=0.05, o_d=0.28</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; stfx = [1e6, 2e7, 3e8]</span>
<span class="sd">        &gt;&gt;&gt; stfy = [0.8e6, 1.6e7, 2.4e8]</span>
<span class="sd">        &gt;&gt;&gt; bearing0 = BearingElement(0, kxx=stfx, kyy=stfy, cxx=0, frequency=[0,1000, 2000])</span>
<span class="sd">        &gt;&gt;&gt; bearing1 = BearingElement(6, kxx=stfx, kyy=stfy, cxx=0, frequency=[0,1000, 2000])</span>
<span class="sd">        &gt;&gt;&gt; rotor = Rotor(shaft_elem, [disk0, disk1], [bearing0, bearing1])</span>
<span class="sd">        &gt;&gt;&gt; rotor.plot_ucs() # doctest: +ELLIPSIS</span>
<span class="sd">        &lt;matplotlib.axes._subplots.AxesSubplot ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">stiffness_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">bearing</span><span class="o">.</span><span class="n">kxx</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                <span class="n">stiffness_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stiffness_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

        <span class="n">stiffness_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">*</span><span class="n">stiffness_range</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">)</span>
        <span class="n">rotor_wn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stiffness_log</span><span class="p">)))</span>

        <span class="n">bearings_elements</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># exclude the seals</span>
        <span class="k">for</span> <span class="n">bearing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bearing</span><span class="p">)</span> <span class="o">==</span> <span class="n">BearingElement</span><span class="p">:</span>
                <span class="n">bearings_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bearing</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stiffness_log</span><span class="p">):</span>
            <span class="n">bearings</span> <span class="o">=</span> <span class="p">[</span><span class="n">BearingElement</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearings_elements</span><span class="p">]</span>
            <span class="n">rotor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span> <span class="n">bearings</span><span class="p">,</span> <span class="n">n_eigen</span><span class="o">=</span><span class="mi">16</span>
            <span class="p">)</span>
            <span class="n">modal</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">rotor_wn</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[:</span><span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_prop_cycle</span><span class="p">(</span><span class="n">cycler</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">seaborn_colors</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">stiffness_log</span><span class="p">,</span> <span class="n">rotor_wn</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Bearing Stiffness (N/m)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Critical Speed (rad/s)&quot;</span><span class="p">)</span>

        <span class="n">bearing0</span> <span class="o">=</span> <span class="n">bearings_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">bearing0</span><span class="o">.</span><span class="n">kxx</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span><span class="p">),</span>
            <span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;kxx&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">bearing0</span><span class="o">.</span><span class="n">kyy</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span><span class="p">),</span>
            <span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;kyy&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="c1"># bokeh plot - output to static HTML file</span>
        <span class="k">if</span> <span class="n">output_html</span><span class="p">:</span>
            <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Plot_UCS.html&quot;</span><span class="p">)</span>

        <span class="c1"># bokeh plot - create a new plot</span>
        <span class="n">bk_ax</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
            <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;pan, box_zoom, wheel_zoom, reset, save&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Undamped critical speed map&quot;</span><span class="p">,</span>
            <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Bearing Stiffness (N/m)&quot;</span><span class="p">,</span>
            <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Critical Speed (rad/s)&quot;</span><span class="p">,</span>
            <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
            <span class="n">y_axis_type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;14pt&quot;</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;14pt&quot;</span>

        <span class="c1"># bokeh plot - plot shaft centerline</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
            <span class="n">bearing0</span><span class="o">.</span><span class="n">kxx</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span><span class="p">),</span>
            <span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">fill_color</span><span class="o">=</span><span class="n">bokeh_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Kxx&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">square</span><span class="p">(</span>
            <span class="n">bearing0</span><span class="o">.</span><span class="n">kyy</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span><span class="p">),</span>
            <span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">fill_color</span><span class="o">=</span><span class="n">bokeh_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Kyy&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rotor_wn</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">bk_ax</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                <span class="n">stiffness_log</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">rotor_wn</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">j</span><span class="p">],</span>
                <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">line_color</span><span class="o">=</span><span class="n">bokeh_colors</span><span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Rotor.plot_level1"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.plot_level1">[docs]</a>    <span class="k">def</span> <span class="nf">plot_level1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot level 1 stability analysis.</span>

<span class="sd">        This method will plot the stability 1 analysis for a</span>
<span class="sd">        given stiffness range.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stiffness_range : tuple, optional</span>
<span class="sd">            Tuple with (start, end) for stiffness range.</span>
<span class="sd">        num : int</span>
<span class="sd">            Number of steps in the range.</span>
<span class="sd">            Default is 5.</span>
<span class="sd">        ax : matplotlib axes, optional</span>
<span class="sd">            Axes in which the plot will be drawn.</span>
<span class="sd">        output_html : Boolean, optional</span>
<span class="sd">            outputs a html file.</span>
<span class="sd">            Default is False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : matplotlib axes</span>
<span class="sd">            Returns the axes object with the plot.</span>
<span class="sd">        bk_ax : bokeh plot axes</span>
<span class="sd">            Returns the axes object with the plot.</span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; i_d = 0</span>
<span class="sd">        &gt;&gt;&gt; o_d = 0.05</span>
<span class="sd">        &gt;&gt;&gt; n = 6</span>
<span class="sd">        &gt;&gt;&gt; L = [0.25 for _ in range(n)]</span>
<span class="sd">        &gt;&gt;&gt; shaft_elem = [</span>
<span class="sd">        ...     ShaftElement(</span>
<span class="sd">        ...         l, i_d, o_d, material=steel, shear_effects=True,</span>
<span class="sd">        ...         rotary_inertia=True, gyroscopic=True</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     for l in L</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; disk0 = DiskElement.from_geometry(</span>
<span class="sd">        ...     n=2, material=steel, width=0.07, i_d=0.05, o_d=0.28</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; disk1 = DiskElement.from_geometry(</span>
<span class="sd">        ...     n=4, material=steel, width=0.07, i_d=0.05, o_d=0.28</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; stfx = 1e6</span>
<span class="sd">        &gt;&gt;&gt; stfy = 0.8e6</span>
<span class="sd">        &gt;&gt;&gt; bearing0 = BearingElement(0, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">        &gt;&gt;&gt; bearing1 = BearingElement(6, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">        &gt;&gt;&gt; rotor = Rotor(shaft_elem, [disk0, disk1], [bearing0, bearing1], rated_w=0)</span>
<span class="sd">        &gt;&gt;&gt; rotor.plot_level1(n=0, stiffness_range=(1e6, 1e11)) # doctest: +ELLIPSIS</span>
<span class="sd">        (&lt;matplotlib.axes._subplots.AxesSubplot ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="n">stiffness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">stiffness_range</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

        <span class="n">log_dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stiffness</span><span class="p">))</span>

        <span class="c1"># set rotor speed to mcs</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span>
        <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stiffness</span><span class="p">):</span>
            <span class="n">bearings</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">]</span>
            <span class="n">cross_coupling</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kxy</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span> <span class="n">kyx</span><span class="o">=-</span><span class="n">Q</span><span class="p">)</span>
            <span class="n">bearings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cross_coupling</span><span class="p">)</span>

            <span class="n">rotor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span> <span class="n">bearings</span><span class="p">)</span>

            <span class="n">modal</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">)</span>
            <span class="n">non_backward</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">whirl_direction</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;Backward&quot;</span>
            <span class="n">log_dec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">log_dec</span><span class="p">[</span><span class="n">non_backward</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stiffness</span><span class="p">,</span> <span class="n">log_dec</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Applied Cross Coupled Stiffness, Q (N/m)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Log Dec&quot;</span><span class="p">)</span>

        <span class="c1"># bokeh plot - output to static HTML file</span>
        <span class="k">if</span> <span class="n">output_html</span><span class="p">:</span>
            <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Plot_level1.html&quot;</span><span class="p">)</span>

        <span class="c1"># bokeh plot - create a new plot</span>
        <span class="n">bk_ax</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
            <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;pan, box_zoom, wheel_zoom, reset, save&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Level 1 stability analysis&quot;</span><span class="p">,</span>
            <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Applied Cross Coupled Stiffness, Q (N/m)&quot;</span><span class="p">,</span>
            <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Log Dec&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;14pt&quot;</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;14pt&quot;</span>

        <span class="c1"># bokeh plot - plot shaft centerline</span>
        <span class="n">bk_ax</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">stiffness</span><span class="p">,</span> <span class="n">log_dec</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="n">bokeh_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bk_ax</span></div>

<div class="viewcode-block" id="Rotor.run_time_response"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.run_time_response">[docs]</a>    <span class="k">def</span> <span class="nf">run_time_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dof</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the time response.</span>

<span class="sd">        This function will take a rotor object and plot its time response</span>
<span class="sd">        given a force and a time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        F : array</span>
<span class="sd">            Force array (needs to have the same number of rows as time array).</span>
<span class="sd">            Each column corresponds to a dof and each row to a time.</span>
<span class="sd">        t : array</span>
<span class="sd">            Time array.</span>
<span class="sd">        dof : int</span>
<span class="sd">            Degree of freedom that will be observed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : array</span>
<span class="sd">            Array containing the time array, the system response, and the</span>
<span class="sd">            time evolution of the state vector.</span>
<span class="sd">            It will be returned if plot=False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = 0</span>
<span class="sd">        &gt;&gt;&gt; size = 28</span>
<span class="sd">        &gt;&gt;&gt; t = np.linspace(0, 5, size)</span>
<span class="sd">        &gt;&gt;&gt; F = np.ones((size, rotor.ndof))</span>
<span class="sd">        &gt;&gt;&gt; dof = 13</span>
<span class="sd">        &gt;&gt;&gt; response = rotor.run_time_response(speed, F, t, dof)</span>
<span class="sd">        &gt;&gt;&gt; response.yout[:, dof] # doctest: +ELLIPSIS</span>
<span class="sd">        array([ 0.00000000e+00,  1.06327334e-05,  1.54684988e-05, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t_</span><span class="p">,</span> <span class="n">yout</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_response</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">TimeResponseResults</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">yout</span><span class="p">,</span> <span class="n">xout</span><span class="p">,</span> <span class="n">dof</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.run_orbit_response"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.run_orbit_response">[docs]</a>    <span class="k">def</span> <span class="nf">run_orbit_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the orbit for a given node.</span>

<span class="sd">        This function will take a rotor object and plot the orbit for a single</span>
<span class="sd">        (2D graph) or all nodes (3D graph).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed: float</span>
<span class="sd">            Rotor speed</span>
<span class="sd">        F: array</span>
<span class="sd">            Force array (needs to have the same number of rows as time array).</span>
<span class="sd">            Each column corresponds to a dof and each row to a time.</span>
<span class="sd">        t: array</span>
<span class="sd">            Time array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : array</span>
<span class="sd">            Array containing the time array, the system response, and the</span>
<span class="sd">            time evolution of the state vector.</span>
<span class="sd">            It will be returned if plot=False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = 500.0</span>
<span class="sd">        &gt;&gt;&gt; size = 1000</span>
<span class="sd">        &gt;&gt;&gt; node = 3</span>
<span class="sd">        &gt;&gt;&gt; t = np.linspace(0, 10, size)</span>
<span class="sd">        &gt;&gt;&gt; F = np.zeros((size, rotor.ndof))</span>
<span class="sd">        &gt;&gt;&gt; F[:, 4 * node] = 10 * np.cos(2 * t)</span>
<span class="sd">        &gt;&gt;&gt; F[:, 4 * node + 1] = 10 * np.sin(2 * t)</span>
<span class="sd">        &gt;&gt;&gt; response = rotor.run_orbit_response(speed, F, t)</span>
<span class="sd">        &gt;&gt;&gt; response.yout[:, 4 * node] # doctest: +ELLIPSIS</span>
<span class="sd">        array([ 0.00000000e+00,  6.94968863e-06,  2.13014440e-05, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t_</span><span class="p">,</span> <span class="n">yout</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_response</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">OrbitResponseResults</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">yout</span><span class="p">,</span> <span class="n">xout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.save_mat"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.save_mat">[docs]</a>    <span class="k">def</span> <span class="nf">save_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save matrices and rotor model to a .mat file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str</span>

<span class="sd">        speed: float</span>
<span class="sd">            Rotor speed.</span>
<span class="sd">        frequency: float, optional</span>
<span class="sd">            Excitation frequency.</span>
<span class="sd">            Default is rotor speed.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.save_mat(&#39;new_matrices.mat&#39;, speed=0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frequency</span> <span class="o">=</span> <span class="n">speed</span>

        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">frequency</span><span class="p">),</span>
            <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">(</span><span class="n">frequency</span><span class="p">),</span>
            <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">(),</span>
            <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">sio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.mat&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file_path</span><span class="p">),</span> <span class="n">dic</span><span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.save"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotor_name</span><span class="o">=</span><span class="s2">&quot;rotor&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Save rotor to toml file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.save(&#39;new_rotor&#39;)</span>
<span class="sd">        &gt;&gt;&gt; Rotor.remove(&#39;new_rotor&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_rotor</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path_rotor</span> <span class="o">/</span> <span class="n">rotor_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span>
                <span class="nb">input</span><span class="p">(</span>
                    <span class="s2">&quot;There is a rotor with this file_path, do you want to overwrite it? (1 for yes and 0 for no)&quot;</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path_rotor</span> <span class="o">/</span> <span class="n">rotor_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;The rotor was not saved.&quot;</span>

        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_rotor</span> <span class="o">/</span> <span class="n">rotor_name</span><span class="p">)</span>
        <span class="n">rotor_folder</span> <span class="o">=</span> <span class="n">path_rotor</span> <span class="o">/</span> <span class="n">rotor_name</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">rotor_folder</span> <span class="o">/</span> <span class="s2">&quot;results&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">rotor_folder</span> <span class="o">/</span> <span class="s2">&quot;elements&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rotor_folder</span> <span class="o">/</span> <span class="s2">&quot;properties.toml&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">toml</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">},</span> <span class="n">f</span><span class="p">)</span>

        <span class="n">elements_folder</span> <span class="o">=</span> <span class="n">rotor_folder</span> <span class="o">/</span> <span class="s2">&quot;elements&quot;</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">elements_folder</span><span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.load"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.load">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load rotor from toml file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rotor : ross.rotor.Rotor</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; rotor1 = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor1.save(Path(&#39;.&#39;)/&#39;new_rotor1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; rotor2 = Rotor.load(Path(&#39;.&#39;)/&#39;new_rotor1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; rotor1 == rotor2</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; Rotor.remove(&#39;new_rotor1&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rotor_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">rotor_path</span> <span class="o">/</span> <span class="s2">&quot;elements&quot;</span><span class="p">):</span>
            <span class="n">elements_path</span> <span class="o">=</span> <span class="n">rotor_path</span> <span class="o">/</span> <span class="s2">&quot;elements&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Elements folder not found.&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rotor_path</span> <span class="o">/</span> <span class="s2">&quot;properties.toml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>

        <span class="n">global_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">elements_path</span><span class="p">):</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s2">&quot;.toml&quot;</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">elements_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">el</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">el_dict</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="n">element_class</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">el_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">el_number</span> <span class="ow">in</span> <span class="n">el_dict</span><span class="p">[</span><span class="n">element_class</span><span class="p">]:</span>
                        <span class="n">element</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">element_class</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;(**</span><span class="si">{el_dict[element_class][el_number]}</span><span class="s2">)&quot;</span>
                        <span class="p">)</span>
                        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">element</span><span class="p">))</span>
            <span class="n">global_elements</span><span class="p">[</span><span class="n">convert</span><span class="p">(</span><span class="n">element_class</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">elements</span>

        <span class="k">return</span> <span class="n">Rotor</span><span class="p">(</span><span class="o">**</span><span class="n">global_elements</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.remove"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.remove">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a previously saved rotor in rotors folder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.save(&#39;new_rotor2&#39;)</span>
<span class="sd">        &gt;&gt;&gt; Rotor.remove(&#39;new_rotor2&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Rotor</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;This is not a valid rotor.&quot;</span></div>

<div class="viewcode-block" id="Rotor.run_static"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.run_static">[docs]</a>    <span class="k">def</span> <span class="nf">run_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rotor static analysis.</span>
<span class="sd">        Static analysis calculates free-body diagram, deformed shaft, shearing</span>
<span class="sd">        force diagram and bending moment diagram.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        shaft_weight: float</span>
<span class="sd">            Shaft total weight</span>
<span class="sd">        disk_weigth_force: list</span>
<span class="sd">            Weight forces of each disk</span>
<span class="sd">        bearing_reaction_force: list</span>
<span class="sd">            The static reaction forces on each bearing</span>
<span class="sd">        disp_y: array</span>
<span class="sd">            The shaft static displacement vector,</span>
<span class="sd">        Vx: array</span>
<span class="sd">            Shearing force vector</span>
<span class="sd">        Bm: array</span>
<span class="sd">            Bending moment vector</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results: object</span>
<span class="sd">            An instance of StaticResult class, which is used to create plots.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; static = rotor.run_static()</span>
<span class="sd">        &gt;&gt;&gt; rotor.bearing_reaction_forces</span>
<span class="sd">        [432.4, 432.4]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Rotor has no bearings&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># gravity aceleration vector</span>
            <span class="n">grav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">()),</span> <span class="mi">1</span><span class="p">))</span>

            <span class="c1"># place gravity effect on shaft and disks nodes</span>
            <span class="k">for</span> <span class="n">node_y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">())</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)):</span>
                <span class="n">grav</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">node_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.8065</span>

            <span class="n">aux_brg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]:</span>
                <span class="n">aux_brg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BearingElement</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="mf">1e14</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

            <span class="n">aux_rotor</span> <span class="o">=</span> <span class="n">Rotor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span> <span class="n">aux_brg</span><span class="p">)</span>
            <span class="n">aux_K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">aux_rotor</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;SealElement&quot;</span><span class="p">:</span>
                    <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>
                    <span class="n">n0</span> <span class="o">=</span> <span class="n">dofs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">n1</span> <span class="o">=</span> <span class="n">dofs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># +1 to include this dof in the slice</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">aux_K</span><span class="p">[</span><span class="n">n0</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="n">n0</span><span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="n">aux_K</span><span class="p">[</span><span class="n">n0</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="n">n0</span><span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">K</span><span class="p">()</span>

            <span class="c1"># calculates x, for [K]*(x) = [M]*(g)</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="p">(</span><span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">aux_K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">()</span> <span class="o">@</span> <span class="n">grav</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="c1"># calculates displacement values in gravity&#39;s direction</span>
            <span class="c1"># dof = degree of freedom</span>
            <span class="n">disp_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">node_dof</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)):</span>
                <span class="n">disp_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disp_y</span><span class="p">,</span> <span class="n">disp</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">node_dof</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disp_y</span> <span class="o">=</span> <span class="n">disp_y</span>

            <span class="c1"># Shearing Force</span>
            <span class="n">BrgForce</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)</span>
            <span class="n">DskForce</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)</span>
            <span class="n">SchForce</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)</span>

            <span class="c1"># Bearing Forces</span>
            <span class="n">BrgForceToReturn</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]):</span>
                <span class="n">BrgForce</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="o">-</span><span class="n">disp_y</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">*</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">df_bearings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;kyy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coefficient</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">BrgForceToReturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span>
                        <span class="o">-</span><span class="n">disp_y</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                        <span class="o">*</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">df_bearings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;kyy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coefficient</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># Disk Forces</span>
            <span class="n">DskForceToReturn</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]):</span>
                    <span class="n">DskForce</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mf">9.8065</span>
                    <span class="n">DskForceToReturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mf">9.8065</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="p">)</span>

            <span class="c1"># Shaft Weight Forces</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;_n&quot;</span><span class="p">]):</span>
                <span class="n">SchForce</span><span class="p">[</span><span class="n">node</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mf">9.8065</span>

            <span class="c1"># Shearing Force vector</span>
            <span class="n">Vx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">))</span>
            <span class="n">Vx_axis</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">))):</span>
                <span class="n">Vx_axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">Vx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vx</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">BrgForce</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DskForce</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">SchForce</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vx</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">DskForce</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Vx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Vx</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">SchForce</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">DskForce</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">SchForce</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">BrgForce</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">Vx_axis</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Vx_axis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">BrgForce</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Vx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Vx</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">SchForce</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">BrgForce</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">DskForce</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">SchForce</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">Vx_axis</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Vx_axis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vx</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Vx</span><span class="p">]</span>
            <span class="n">Vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vx</span><span class="p">)</span>

            <span class="c1"># Bending Moment vector</span>
            <span class="n">Mx</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">Vx_axis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">Vx_axis</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="p">(</span><span class="n">Vx_axis</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Vx</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                            <span class="o">+</span> <span class="p">(</span><span class="n">Vx_axis</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Vx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="o">-</span> <span class="p">(</span><span class="n">Vx_axis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Vx</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                            <span class="o">-</span> <span class="p">(</span><span class="n">Vx_axis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Vx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="p">)</span>
                        <span class="o">/</span> <span class="mi">2</span>
                    <span class="p">)</span>

            <span class="n">Bm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Mx</span><span class="p">)):</span>
                <span class="n">Bm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bm</span><span class="p">,</span> <span class="n">Bm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Mx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bm</span> <span class="o">=</span> <span class="n">Bm</span>

            <span class="n">sh_weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mf">9.8065</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">shaft_weight</span> <span class="o">=</span> <span class="n">sh_weight</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disk_forces</span> <span class="o">=</span> <span class="n">DskForceToReturn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_reaction_forces</span> <span class="o">=</span> <span class="n">BrgForceToReturn</span>

            <span class="n">results</span> <span class="o">=</span> <span class="n">StaticResults</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disp_y</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Vx</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bm</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span><span class="p">,</span>
                <span class="n">aux_rotor</span><span class="o">.</span><span class="n">df_bearings</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">,</span>
                <span class="n">Vx_axis</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.summary"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rotor summary.</span>

<span class="sd">        This creates a summary of the main parameters and attributes from the</span>
<span class="sd">        rotor model. The data is presented in a table format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : class instance</span>
<span class="sd">            An instance of SumarryResults class to build the summary table</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; table = rotor.summary().plot()</span>
<span class="sd">        &gt;&gt;&gt; # to display the plot use the command:</span>
<span class="sd">        &gt;&gt;&gt; # show(table)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_static</span><span class="p">()</span>
        <span class="n">forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_reaction_forces</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">SummaryResults</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">,</span>
            <span class="n">forces</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CG</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.from_section"><a class="viewcode-back" href="../../generated/results/ross.Rotor.html#ross.Rotor.from_section">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_section</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">leng_data</span><span class="p">,</span>
        <span class="n">idl_data</span><span class="p">,</span>
        <span class="n">odl_data</span><span class="p">,</span>
        <span class="n">idr_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">odr_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">material_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">disk_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">brg_seal_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">min_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rated_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">n_eigen</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">nel_r</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This class is an alternative to build rotors from separated</span>
<span class="sd">        sections. Each section has the same number (n) of shaft elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        leng_data : list</span>
<span class="sd">            List with the lengths of rotor regions.</span>
<span class="sd">        idl_data : list</span>
<span class="sd">            List with the inner diameters of rotor regions (Left Station).</span>
<span class="sd">        odl_data : list</span>
<span class="sd">            List with the outer diameters of rotor regions (Left Station).</span>
<span class="sd">        idr_data : list, optional</span>
<span class="sd">            List with the inner diameters of rotor regions (Right Station).</span>
<span class="sd">            Default is equal to idl_data (cylindrical element).</span>
<span class="sd">        odr_data : list, optional</span>
<span class="sd">            List with the outer diameters of rotor regions (Right Station).</span>
<span class="sd">            Default is equal to odl_data (cylindrical element).</span>
<span class="sd">        material_data : ross.material or list of ross.material</span>
<span class="sd">            Defines a single material for all sections or each section can be</span>
<span class="sd">            defined by a material individually.</span>
<span class="sd">        disk_data : dict, optional</span>
<span class="sd">            Dict holding disks datas.</span>
<span class="sd">            Example : disk_data=DiskElement.from_geometry(n=2,</span>
<span class="sd">                                                          material=steel,</span>
<span class="sd">                                                          width=0.07,</span>
<span class="sd">                                                          i_d=0,</span>
<span class="sd">                                                          o_d=0.28</span>
<span class="sd">                                                          )</span>
<span class="sd">            ***See &#39;disk_element.py&#39; docstring for more information***</span>
<span class="sd">        brg_seal_data : dict, optional</span>
<span class="sd">            Dict holding lists of bearings and seals datas.</span>
<span class="sd">            Example : brg_seal_data=BearingElement(n=1, kxx=1e6, cxx=0,</span>
<span class="sd">                                                   kyy=1e6, cyy=0, kxy=0,</span>
<span class="sd">                                                   cxy=0, kyx=0, cyx=0)</span>
<span class="sd">            ***See &#39;bearing_seal_element.py&#39; docstring for more information***</span>
<span class="sd">        nel_r : int, optional</span>
<span class="sd">            Number or elements per shaft region.</span>
<span class="sd">            Default is 1.</span>
<span class="sd">        n_eigen : int, optional</span>
<span class="sd">            Number of eigenvalues calculated by arpack.</span>
<span class="sd">            Default is 12.</span>
<span class="sd">        tag : str</span>
<span class="sd">            A tag for the rotor</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A rotor object</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; from ross.materials import steel</span>
<span class="sd">        &gt;&gt;&gt; rotor = Rotor.from_section(leng_data=[0.5,0.5,0.5],</span>
<span class="sd">        ...             odl_data=[0.05,0.05,0.05],</span>
<span class="sd">        ...             idl_data=[0,0,0],</span>
<span class="sd">        ...             material_data=steel,</span>
<span class="sd">        ...             disk_data=[DiskElement.from_geometry(n=1, material=steel, width=0.07, i_d=0, o_d=0.28),</span>
<span class="sd">        ...                        DiskElement.from_geometry(n=2, material=steel, width=0.07, i_d=0, o_d=0.35)],</span>
<span class="sd">        ...             brg_seal_data=[BearingElement(n=0, kxx=1e6, cxx=0, kyy=1e6, cyy=0, kxy=0, cxy=0, kyx=0, cyx=0),</span>
<span class="sd">        ...                            BearingElement(n=3, kxx=1e6, cxx=0, kyy=1e6, cyy=0, kxy=0, cxy=0, kyx=0, cyx=0)],</span>
<span class="sd">        ...             nel_r=1)</span>
<span class="sd">        &gt;&gt;&gt; modal = rotor.run_modal(speed=0)</span>
<span class="sd">        &gt;&gt;&gt; modal.wn.round(4)</span>
<span class="sd">        array([ 85.7634,  85.7634, 271.9326, 271.9326, 718.58  , 718.58  ])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">odl_data</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idl_data</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The lists size do not match (leng_data, odl_data and idl_data).&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">material_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Please define a material or a list of materials&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">idr_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idr_data</span> <span class="o">=</span> <span class="n">idl_data</span>
        <span class="k">if</span> <span class="n">odr_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">odr_data</span> <span class="o">=</span> <span class="n">odl_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">odr_data</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idr_data</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The lists size do not match (leng_data, odr_data and idr_data).&quot;</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rotor_regions</span><span class="p">(</span><span class="n">nel_r</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            A subroutine to discretize each rotor region into n elements</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            nel_r : int</span>
<span class="sd">                Number of elements per region</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            regions : list</span>
<span class="sd">                List with elements</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">shaft_elements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">disk_elements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bearing_elements</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">material_data</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                        <span class="s2">&quot;material_data size does not match size of other lists&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># loop through rotor regions</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">leng</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leng_data</span><span class="p">):</span>
                    <span class="n">le</span> <span class="o">=</span> <span class="n">leng</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nel_r</span><span class="p">):</span>
                        <span class="n">idl</span> <span class="o">=</span> <span class="p">(</span><span class="n">idr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">odl</span> <span class="o">=</span> <span class="p">(</span><span class="n">odr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">idr</span> <span class="o">=</span> <span class="p">(</span><span class="n">idr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">odr</span> <span class="o">=</span> <span class="p">(</span><span class="n">odr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">shaft_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ShaftElement</span><span class="p">(</span>
                                <span class="n">le</span><span class="p">,</span>
                                <span class="n">idl</span><span class="p">,</span>
                                <span class="n">odl</span><span class="p">,</span>
                                <span class="n">idr</span><span class="p">,</span>
                                <span class="n">odr</span><span class="p">,</span>
                                <span class="n">material</span><span class="o">=</span><span class="n">material_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">shear_effects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">rotary_inertia</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">gyroscopic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">leng</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leng_data</span><span class="p">):</span>
                    <span class="n">le</span> <span class="o">=</span> <span class="n">leng</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nel_r</span><span class="p">):</span>
                        <span class="n">idl</span> <span class="o">=</span> <span class="p">(</span><span class="n">idr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">odl</span> <span class="o">=</span> <span class="p">(</span><span class="n">odr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">idr</span> <span class="o">=</span> <span class="p">(</span><span class="n">idr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">odr</span> <span class="o">=</span> <span class="p">(</span><span class="n">odr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">shaft_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ShaftElement</span><span class="p">(</span>
                                <span class="n">le</span><span class="p">,</span>
                                <span class="n">idl</span><span class="p">,</span>
                                <span class="n">odl</span><span class="p">,</span>
                                <span class="n">idr</span><span class="p">,</span>
                                <span class="n">odr</span><span class="p">,</span>
                                <span class="n">material</span><span class="o">=</span><span class="n">material_data</span><span class="p">,</span>
                                <span class="n">shear_effects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">rotary_inertia</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">gyroscopic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

            <span class="n">regions</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">shaft_elements</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">DiskEl</span> <span class="ow">in</span> <span class="n">disk_data</span><span class="p">:</span>
                <span class="n">aux_DiskEl</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">DiskEl</span><span class="p">)</span>
                <span class="n">aux_DiskEl</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">DiskEl</span><span class="o">.</span><span class="n">n</span>
                <span class="n">aux_DiskEl</span><span class="o">.</span><span class="n">n_l</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">DiskEl</span><span class="o">.</span><span class="n">n_l</span>
                <span class="n">aux_DiskEl</span><span class="o">.</span><span class="n">n_r</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">DiskEl</span><span class="o">.</span><span class="n">n_r</span>
                <span class="n">disk_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_DiskEl</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">Brg_SealEl</span> <span class="ow">in</span> <span class="n">brg_seal_data</span><span class="p">:</span>
                <span class="n">aux_Brg_SealEl</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">Brg_SealEl</span><span class="p">)</span>
                <span class="n">aux_Brg_SealEl</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">Brg_SealEl</span><span class="o">.</span><span class="n">n</span>
                <span class="n">aux_Brg_SealEl</span><span class="o">.</span><span class="n">n_l</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">Brg_SealEl</span><span class="o">.</span><span class="n">n_l</span>
                <span class="n">aux_Brg_SealEl</span><span class="o">.</span><span class="n">n_r</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">Brg_SealEl</span><span class="o">.</span><span class="n">n_r</span>
                <span class="n">bearing_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_Brg_SealEl</span><span class="p">)</span>

            <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_elements</span><span class="p">)</span>
            <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">regions</span>

        <span class="n">regions</span> <span class="o">=</span> <span class="n">rotor_regions</span><span class="p">(</span><span class="n">nel_r</span><span class="p">)</span>
        <span class="n">shaft_elements</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">disk_elements</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bearing_elements</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">shaft_elements</span><span class="p">,</span>
            <span class="n">disk_elements</span><span class="p">,</span>
            <span class="n">bearing_elements</span><span class="p">,</span>
            <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">,</span>
            <span class="n">n_eigen</span><span class="o">=</span><span class="n">n_eigen</span><span class="p">,</span>
            <span class="n">min_w</span><span class="o">=</span><span class="n">min_w</span><span class="p">,</span>
            <span class="n">max_w</span><span class="o">=</span><span class="n">max_w</span><span class="p">,</span>
            <span class="n">rated_w</span><span class="o">=</span><span class="n">rated_w</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">CoAxialRotor</span><span class="p">(</span><span class="n">Rotor</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A rotor object.</span>

<span class="sd">    This class will create a system of co-axial rotors with the shaft,</span>
<span class="sd">    disk, bearing and seal elements provided.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shafts : list of lists</span>
<span class="sd">        Each list of shaft elements builds a different shaft. The number of</span>
<span class="sd">        lists sets the number of shafts.</span>
<span class="sd">    disk_elements : list</span>
<span class="sd">        List with the disk elements</span>
<span class="sd">    bearing_elements : list</span>
<span class="sd">        List with the bearing elements</span>
<span class="sd">    point_mass_elements: list</span>
<span class="sd">        List with the point mass elements</span>
<span class="sd">    shaft_start_pos : list</span>
<span class="sd">        List indicating the initial node position for each shaft.</span>
<span class="sd">        Default is zero for each shaft created.</span>
<span class="sd">    sparse : bool, optional</span>
<span class="sd">        If sparse, eigenvalues will be calculated with arpack.</span>
<span class="sd">        Default is True.</span>
<span class="sd">    n_eigen : int, optional</span>
<span class="sd">        Number of eigenvalues calculated by arpack.</span>
<span class="sd">        Default is 12.</span>
<span class="sd">    tag : str</span>
<span class="sd">        A tag for the rotor</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A rotor object.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nodes : list</span>
<span class="sd">        List of the model&#39;s nodes.</span>
<span class="sd">    nodes_pos : list</span>
<span class="sd">        List with nodal spatial location.</span>
<span class="sd">    CG : float</span>
<span class="sd">        Center of gravity</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import ross as rs</span>
<span class="sd">    &gt;&gt;&gt; steel = rs.materials.steel</span>
<span class="sd">    &gt;&gt;&gt; i_d = 0</span>
<span class="sd">    &gt;&gt;&gt; o_d = 0.05</span>
<span class="sd">    &gt;&gt;&gt; n = 10</span>
<span class="sd">    &gt;&gt;&gt; L = [0.25 for _ in range(n)]</span>
<span class="sd">    &gt;&gt;&gt; axial_shaft = [rs.ShaftElement(l, i_d, o_d, material=steel) for l in L]</span>
<span class="sd">    &gt;&gt;&gt; i_d = 0.15</span>
<span class="sd">    &gt;&gt;&gt; o_d = 0.20</span>
<span class="sd">    &gt;&gt;&gt; n = 6</span>
<span class="sd">    &gt;&gt;&gt; L = [0.25 for _ in range(n)]</span>
<span class="sd">    &gt;&gt;&gt; coaxial_shaft = [rs.ShaftElement(l, i_d, o_d, material=steel) for l in L]</span>
<span class="sd">    &gt;&gt;&gt; shaft = [axial_shaft, coaxial_shaft]</span>
<span class="sd">    &gt;&gt;&gt; disk0 = rs.DiskElement.from_geometry(n=1,</span>
<span class="sd">    ...                                     material=steel,</span>
<span class="sd">    ...                                     width=0.07,</span>
<span class="sd">    ...                                     i_d=0.05,</span>
<span class="sd">    ...                                     o_d=0.28)</span>
<span class="sd">    &gt;&gt;&gt; disk1 = rs.DiskElement.from_geometry(n=9,</span>
<span class="sd">    ...                                     material=steel,</span>
<span class="sd">    ...                                     width=0.07,</span>
<span class="sd">    ...                                     i_d=0.05,</span>
<span class="sd">    ...                                     o_d=0.28)</span>
<span class="sd">    &gt;&gt;&gt; disk2 = rs.DiskElement.from_geometry(n=13,</span>
<span class="sd">    ...                                      material=steel,</span>
<span class="sd">    ...                                      width=0.07,</span>
<span class="sd">    ...                                      i_d=0.20,</span>
<span class="sd">    ...                                      o_d=0.48)</span>
<span class="sd">    &gt;&gt;&gt; disk3 = rs.DiskElement.from_geometry(n=15,</span>
<span class="sd">    ...                                      material=steel,</span>
<span class="sd">    ...                                      width=0.07,</span>
<span class="sd">    ...                                      i_d=0.20,</span>
<span class="sd">    ...                                      o_d=0.48)</span>
<span class="sd">    &gt;&gt;&gt; disks = [disk0, disk1, disk2, disk3]</span>
<span class="sd">    &gt;&gt;&gt; stfx = 1e6</span>
<span class="sd">    &gt;&gt;&gt; stfy = 0.8e6</span>
<span class="sd">    &gt;&gt;&gt; bearing0 = rs.BearingElement(0, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearing1 = rs.BearingElement(10, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearing2 = rs.BearingElement(11, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearing3 = rs.BearingElement(8, n_link=17, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearings = [bearing0, bearing1, bearing2, bearing3]</span>
<span class="sd">    &gt;&gt;&gt; rotor = rs.CoAxialRotor(shaft, disks, bearings)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">shafts</span><span class="p">,</span>
        <span class="n">disk_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">bearing_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">point_mass_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">n_eigen</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">min_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rated_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;sparse&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;n_eigen&quot;</span><span class="p">:</span> <span class="n">n_eigen</span><span class="p">,</span>
            <span class="s2">&quot;min_w&quot;</span><span class="p">:</span> <span class="n">min_w</span><span class="p">,</span>
            <span class="s2">&quot;max_w&quot;</span><span class="p">:</span> <span class="n">max_w</span><span class="p">,</span>
            <span class="s2">&quot;rated_w&quot;</span><span class="p">:</span> <span class="n">rated_w</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Rotor 0&quot;</span>

        <span class="c1">####################################################</span>
        <span class="c1"># Config attributes</span>
        <span class="c1">####################################################</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span> <span class="o">=</span> <span class="n">sparse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_eigen</span> <span class="o">=</span> <span class="n">n_eigen</span>
        <span class="c1"># operational speeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_w</span> <span class="o">=</span> <span class="n">min_w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_w</span> <span class="o">=</span> <span class="n">max_w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span> <span class="o">=</span> <span class="n">rated_w</span>

        <span class="c1">####################################################</span>

        <span class="c1"># set n for each shaft element</span>
        <span class="n">aux_n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">aux_n_tag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shafts</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shaft</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">aux_n</span>
                <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sh</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">aux_n_tag</span><span class="p">)</span>
            <span class="n">aux_n</span> <span class="o">=</span> <span class="n">shaft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n_r</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">aux_n_tag</span> <span class="o">=</span> <span class="n">aux_n</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">j</span>

        <span class="c1"># flatten and make a copy for shaft elements to avoid altering</span>
        <span class="c1"># attributes for elements that might be used in different rotors</span>
        <span class="c1"># e.g. altering shaft_element.n</span>
        <span class="n">shafts</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">shafts</span><span class="p">]</span>
        <span class="n">shaft_elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">shafts</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">disk_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">disk_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">bearing_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bearing_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">point_mass_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">point_mass_elements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">disk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disk_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">disk</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Disk &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">brg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">brg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span> <span class="ow">and</span> <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Bearing &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">brg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;SealElement&quot;</span> <span class="ow">and</span> <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Seal &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p_mass</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">point_mass_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Point Mass &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shafts</span> <span class="o">=</span> <span class="n">shafts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span> <span class="o">=</span> <span class="n">disk_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span> <span class="o">=</span> <span class="n">point_mass_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">chain</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1">####################################################</span>
        <span class="c1"># Rotor summary</span>
        <span class="c1">####################################################</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_link&quot;</span><span class="p">,</span>
            <span class="s2">&quot;L&quot;</span><span class="p">,</span>
            <span class="s2">&quot;node_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;node_pos_r&quot;</span><span class="p">,</span>
            <span class="s2">&quot;idl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;odl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;idr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;odr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;i_d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;o_d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;beam_cg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axial_cg_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;y_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;material&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rho&quot;</span><span class="p">,</span>
            <span class="s2">&quot;volume&quot;</span><span class="p">,</span>
            <span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">df_shaft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="n">df_disks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="n">df_bearings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_seals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_point_mass</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">])</span>

        <span class="n">nodes_pos_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">nodes_pos_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">shaft_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shafts</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">sh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shaft</span><span class="p">):</span>
                <span class="n">shaft_number</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>
                    <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">+</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;n_l&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;n_l&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="ow">in</span> <span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;n_link&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">df_bearings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_bearings</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span> <span class="ow">in</span> <span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;n_link&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">df_bearings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_bearings</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">+</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shaft_number</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;axial_cg_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axial_cg_pos</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">df_shaft</span><span class="p">,</span> <span class="n">df_disks</span><span class="p">,</span> <span class="n">df_bearings</span><span class="p">,</span> <span class="n">df_point_mass</span><span class="p">,</span> <span class="n">df_seals</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;n_l&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># check consistence for disks and bearings location</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_point_mass</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_loc_point_mass</span> <span class="o">=</span> <span class="n">df_point_mass</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_loc_point_mass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_location</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">max_loc_point_mass</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">n_l</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_location</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trying to set disk or bearing outside shaft&quot;</span><span class="p">)</span>

        <span class="c1"># nodes axial position and diameter</span>
        <span class="n">nodes_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">nodes_i_d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">nodes_o_d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shafts</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">shaft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n_r</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shafts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nodes_pos</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">nodes_i_d</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">nodes_o_d</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nodes_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">nodes_i_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">nodes_o_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span> <span class="o">=</span> <span class="n">nodes_pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_i_d</span> <span class="o">=</span> <span class="n">nodes_i_d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_o_d</span> <span class="o">=</span> <span class="n">nodes_o_d</span>

        <span class="n">shaft_elements_length</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;L&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements_length</span> <span class="o">=</span> <span class="n">shaft_elements_length</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># rotor mass can also be calculated with self.M()[::4, ::4].sum()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_disks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">disk</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_shaft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sh_el</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">sh_el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_disks</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_shaft</span>

        <span class="c1"># rotor center of mass and total inertia</span>
        <span class="n">CG_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">sh</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">CG_dsk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CG</span> <span class="o">=</span> <span class="n">CG_sh</span> <span class="o">+</span> <span class="n">CG_dsk</span>

        <span class="n">Ip_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sh</span><span class="o">.</span><span class="n">Im</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="n">Ip_dsk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">disk</span><span class="o">.</span><span class="n">Ip</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span> <span class="o">=</span> <span class="n">Ip_sh</span> <span class="o">+</span> <span class="n">Ip_dsk</span>

        <span class="c1"># values for evalues and evectors will be calculated by self.run_modal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evalues</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evectors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lti</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_v0</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># used to call eigs</span>

        <span class="c1"># number of dofs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">n</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">shaft_elements</span><span class="p">])</span>
            <span class="o">+</span> <span class="mi">8</span>
            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">([</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">point_mass_elements</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">elm_no_shaft_id</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">elm</span>
            <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;shaft_number&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">elm_no_shaft_id</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">elm_no_shaft_id</span><span class="p">:</span>
                    <span class="n">shnum_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
                    <span class="p">]</span>
                    <span class="n">shnum_r</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
                    <span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shnum_l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shnum_r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">shnum_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
                        <span class="p">]</span>
                        <span class="n">shnum_r</span> <span class="o">=</span> <span class="n">shnum_l</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shnum_l</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shnum_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">elm_no_shaft_id</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">elm</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shnum_r</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shnum_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">elm_no_shaft_id</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">elm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">df_disks</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;DiskElement&quot;</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">df_seals</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;SealElement&quot;</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">df_point_mass</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;PointMass&quot;</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span> <span class="o">=</span> <span class="n">df_disks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span> <span class="o">=</span> <span class="n">df_bearings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span> <span class="o">=</span> <span class="n">df_shaft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_point_mass</span> <span class="o">=</span> <span class="n">df_point_mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_seals</span> <span class="o">=</span> <span class="n">df_seals</span>

        <span class="c1"># global indexes for dofs</span>
        <span class="n">n_last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dof_mapping</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_mapping</span><span class="p">()</span>
            <span class="n">global_dof_mapping</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">dof_letter</span><span class="p">,</span> <span class="n">dof_number</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">dof_letter</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dof_number</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>

            <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">global_dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">global_dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">v</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="s2">&quot;n_link&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">&lt;=</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x_</span><span class="si">{elm.n_link}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;y_</span><span class="si">{elm.n_link}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x_</span><span class="si">{elm.n_link}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="p">)</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;y_</span><span class="si">{elm.n_link}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">5</span>
                    <span class="p">)</span>

            <span class="n">dof_tuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;GlobalIndex&quot;</span><span class="p">,</span> <span class="n">global_dof_mapping</span><span class="p">)</span>
            <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span> <span class="o">=</span> <span class="n">dof_tuple</span><span class="p">(</span><span class="o">**</span><span class="n">global_dof_mapping</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;dof_global_index&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>

        <span class="c1">#  values for static analysis will be calculated by def static</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_y</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># define positions for disks</span>
        <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">disk_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">nodes_o_d</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>

        <span class="c1"># define positions for bearings</span>
        <span class="c1"># check if there are bearings without location</span>
        <span class="n">bearings_no_zloc</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">b</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearing_elements</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># cycle while there are bearings without a z location</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bearings_no_zloc</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearings_no_zloc</span><span class="p">:</span>
                    <span class="c1"># first check if b.n is on list, if not, check for n_link</span>
                    <span class="n">node_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span>
                    <span class="n">node_r</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">node_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_l&quot;</span>
                        <span class="p">]</span>
                        <span class="n">node_r</span> <span class="o">=</span> <span class="n">node_l</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_l</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bearings_no_zloc</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_r</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bearings_no_zloc</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">dfb</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">z_positions</span><span class="p">))</span>
        <span class="n">mean_od</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">nodes_o_d</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z_pos</span> <span class="ow">in</span> <span class="n">dfb</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]:</span>
            <span class="n">dfb_z_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">nodes_pos_l</span> <span class="o">==</span> <span class="n">z_pos</span><span class="p">]</span>
            <span class="n">dfb_z_pos</span> <span class="o">=</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;n_l&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">nlink</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">n_link</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                            <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                            <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                                    <span class="p">[</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                                            <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                                        <span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                                            <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                                        <span class="p">),</span>
                                    <span class="p">]</span>
                                <span class="p">)</span>
                                <span class="o">/</span> <span class="mi">2</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y_pos</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mean_od</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">nlink</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                                    <span class="p">[</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                                            <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                                        <span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                                            <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idr&quot;</span><span class="p">][</span>
                                                <span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span> <span class="o">-</span> <span class="mi">1</span>
                                            <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                                        <span class="p">),</span>
                                    <span class="p">]</span>
                                <span class="p">)</span>
                                <span class="o">/</span> <span class="mi">2</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">y_pos</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mean_od</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;y_pos_sup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos_sup</span>

        <span class="c1"># define position for point mass elements</span>
        <span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">point_mass_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">rotor_example</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This function returns an instance of a simple rotor with</span>
<span class="sd">    two shaft elements, one disk and two simple bearings.</span>
<span class="sd">    The purpose of this is to make available a simple model</span>
<span class="sd">    so that doctest can be written using this.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    An instance of a rotor object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">    &gt;&gt;&gt; modal = rotor.run_modal(speed=0)</span>
<span class="sd">    &gt;&gt;&gt; np.round(modal.wd[:4])</span>
<span class="sd">    array([ 92.,  96., 275., 297.])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#  Rotor without damping with 6 shaft elements 2 disks and 2 bearings</span>
    <span class="n">i_d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">o_d</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">shaft_elem</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ShaftElement</span><span class="p">(</span>
            <span class="n">l</span><span class="p">,</span>
            <span class="n">i_d</span><span class="p">,</span>
            <span class="n">o_d</span><span class="p">,</span>
            <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span>
            <span class="n">shear_effects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">rotary_inertia</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">gyroscopic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">L</span>
    <span class="p">]</span>

    <span class="n">disk0</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span>
    <span class="p">)</span>
    <span class="n">disk1</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span>
    <span class="p">)</span>

    <span class="n">stfx</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">stfy</span> <span class="o">=</span> <span class="mf">0.8e6</span>
    <span class="n">bearing0</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bearing1</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Rotor</span><span class="p">(</span><span class="n">shaft_elem</span><span class="p">,</span> <span class="p">[</span><span class="n">disk0</span><span class="p">,</span> <span class="n">disk1</span><span class="p">],</span> <span class="p">[</span><span class="n">bearing0</span><span class="p">,</span> <span class="n">bearing1</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">coaxrotor_example</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This function returns an instance of a simple rotor with</span>
<span class="sd">    two shafts, four disk and four bearings.</span>
<span class="sd">    The purpose of this is to make available a simple model for co-axial rotors</span>
<span class="sd">    so that doctest can be written using this.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    An instance of a rotor object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; rotor = coaxrotor_example()</span>
<span class="sd">    &gt;&gt;&gt; modal = rotor.run_modal(speed=0)</span>
<span class="sd">    &gt;&gt;&gt; np.round(modal.wd[:4])</span>
<span class="sd">    array([39., 39., 99., 99.])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i_d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">o_d</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">axial_shaft</span> <span class="o">=</span> <span class="p">[</span><span class="n">ShaftElement</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i_d</span><span class="p">,</span> <span class="n">o_d</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>

    <span class="n">i_d</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">o_d</span> <span class="o">=</span> <span class="mf">0.30</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">coaxial_shaft</span> <span class="o">=</span> <span class="p">[</span><span class="n">ShaftElement</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i_d</span><span class="p">,</span> <span class="n">o_d</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>

    <span class="n">disk0</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span>
    <span class="p">)</span>
    <span class="n">disk1</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span>
    <span class="p">)</span>
    <span class="n">disk2</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.48</span>
    <span class="p">)</span>
    <span class="n">disk3</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.48</span>
    <span class="p">)</span>

    <span class="n">shaft</span> <span class="o">=</span> <span class="p">[</span><span class="n">axial_shaft</span><span class="p">,</span> <span class="n">coaxial_shaft</span><span class="p">]</span>
    <span class="n">disks</span> <span class="o">=</span> <span class="p">[</span><span class="n">disk0</span><span class="p">,</span> <span class="n">disk1</span><span class="p">,</span> <span class="n">disk2</span><span class="p">,</span> <span class="n">disk3</span><span class="p">]</span>

    <span class="n">stfx</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">stfy</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">bearing0</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bearing1</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bearing2</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bearing3</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_link</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bearings</span> <span class="o">=</span> <span class="p">[</span><span class="n">bearing0</span><span class="p">,</span> <span class="n">bearing1</span><span class="p">,</span> <span class="n">bearing2</span><span class="p">,</span> <span class="n">bearing3</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">CoAxialRotor</span><span class="p">(</span><span class="n">shaft</span><span class="p">,</span> <span class="n">disks</span><span class="p">,</span> <span class="n">bearings</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MAC</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAC - Modal Assurance Criterion</span>

<span class="sd">    MAC for a single pair of vectors.</span>
<span class="sd">    The Modal Assurance Criterion (MAC) analysis is used to determine</span>
<span class="sd">    the similarity of two mode shapes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    u : array</span>
<span class="sd">        complex modal vector</span>
<span class="sd">    v : array</span>
<span class="sd">        complex modal vector</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    MAC from &#39;u&#39; and &#39;v&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">H</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">((</span><span class="n">H</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">@</span> <span class="n">v</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">((</span><span class="n">H</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">@</span> <span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">@</span> <span class="n">v</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">MAC_modes</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAC - Modal Assurance Criterion</span>

<span class="sd">    MAC for multiple vectors</span>
<span class="sd">    The Modal Assurance Criterion (MAC) analysis is used to determine</span>
<span class="sd">    the similarity of two mode shapes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    U : matrix</span>
<span class="sd">        complex modal matrix</span>
<span class="sd">    V : matrix</span>
<span class="sd">        complex modal matrix</span>
<span class="sd">    n : int</span>
<span class="sd">        number of vectors to be analyzed</span>
<span class="sd">    plot : bool</span>
<span class="sd">        if True, returns a plot</span>
<span class="sd">        if False, returns the macs values</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The macs values from &#39;U&#39; and &#39;V&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># n is the number of modes to be evaluated</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">macs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="n">n</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="n">n</span><span class="p">]):</span>
            <span class="n">macs</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MAC</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">macs</span>

    <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">xpos</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">ypos</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">zpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xpos</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xpos</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xpos</span><span class="p">)</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">macs</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="c1"># fig.suptitle(&#39;MAC - %s vs %s&#39; % (U.name, V.name), fontsize=12)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar3d</span><span class="p">(</span>
        <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">zpos</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">dz</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">zsort</span><span class="o">=</span><span class="s2">&quot;max&quot;</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># ax.set_xlabel(&#39;%s  modes&#39; % U.name)</span>
    <span class="c1"># ax.set_ylabel(&#39;%s  modes&#39; % V.name)</span>

    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># fake up the array of the scalar mappable</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;MAC&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">macs</span>
</pre></div>

    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, Team ROSS.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.3.<br/>
    </p>
  </div>
</footer>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-157532410-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-157532410-1');
</script>

  </body>
</html>