<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ross.rotor_assembly &#8212; ross 0.4.1 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/ross-logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/ross-logo.svg"></span>
          ROSS</a>
        <span class="navbar-text navbar-version pull-left"><b>0.4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../tutorials.html">Tutorial</a></li>
                <li><a href="../../examples.html">Examples</a></li>
                <li><a href="../../api.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#install-python">Install Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#install-ross">Install ROSS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial_part_1.html">Tutorial - Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial_part_2.html">Tutorial - Running Analyzes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/tutorial_part_3.html">Tutorial - Stochastic ROSS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#ross-examples">ROSS Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#fluidflow-examples">FluidFlow Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#stochastic-ross-examples">Stochastic ROSS Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../download.html">Download notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api.html#material">Material</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html#elements">Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html#rotor-and-results">Rotor and Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html#results">Results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#feedback-and-contribution">Feedback and Contribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#version-control-system-git">Version-control system: Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#code-style-black">Code style: Black</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#how-to-contribute-to-ross-using-git">How to contribute to ROSS using git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#making-new-releases">Making new releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes.html#version-0-4-0">Version 0.4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes.html#version-0-3-0">Version 0.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes.html#version-0-2-0-beta-release">Version 0.2.0 (beta release)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes.html#version-0-1-0-alpha-release">Version 0.1.0 (alpha release)</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for ross.rotor_assembly</h1><div class="highlight"><pre>
<span></span><span class="c1"># fmt: off</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span><span class="p">,</span> <span class="n">cycle</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">toml</span>
<span class="kn">from</span> <span class="nn">plotly</span> <span class="kn">import</span> <span class="n">express</span> <span class="k">as</span> <span class="n">px</span>
<span class="kn">from</span> <span class="nn">plotly</span> <span class="kn">import</span> <span class="n">graph_objects</span> <span class="k">as</span> <span class="n">go</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span> <span class="k">as</span> <span class="n">sio</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">la</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span> <span class="k">as</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">newton</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">las</span>

<span class="kn">from</span> <span class="nn">ross.bearing_seal_element</span> <span class="kn">import</span> <span class="p">(</span><span class="n">BallBearingElement</span><span class="p">,</span> <span class="n">BearingElement</span><span class="p">,</span>
                                       <span class="n">BearingElement6DoF</span><span class="p">,</span>
                                       <span class="n">MagneticBearingElement</span><span class="p">,</span>
                                       <span class="n">RollerBearingElement</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">ross.defects</span> <span class="kn">import</span> <span class="n">Crack</span><span class="p">,</span> <span class="n">MisalignmentFlex</span><span class="p">,</span> <span class="n">MisalignmentRigid</span><span class="p">,</span> <span class="n">Rubbing</span>
<span class="kn">from</span> <span class="nn">ross.disk_element</span> <span class="kn">import</span> <span class="n">DiskElement</span><span class="p">,</span> <span class="n">DiskElement6DoF</span>
<span class="kn">from</span> <span class="nn">ross.materials</span> <span class="kn">import</span> <span class="n">steel</span>
<span class="kn">from</span> <span class="nn">ross.point_mass</span> <span class="kn">import</span> <span class="n">PointMass</span>
<span class="kn">from</span> <span class="nn">ross.results</span> <span class="kn">import</span> <span class="p">(</span><span class="n">CampbellResults</span><span class="p">,</span> <span class="n">ConvergenceResults</span><span class="p">,</span>
                          <span class="n">CriticalSpeedResults</span><span class="p">,</span> <span class="n">ForcedResponseResults</span><span class="p">,</span>
                          <span class="n">FrequencyResponseResults</span><span class="p">,</span> <span class="n">Level1Results</span><span class="p">,</span>
                          <span class="n">ModalResults</span><span class="p">,</span> <span class="n">StaticResults</span><span class="p">,</span> <span class="n">SummaryResults</span><span class="p">,</span>
                          <span class="n">TimeResponseResults</span><span class="p">,</span> <span class="n">UCSResults</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">ross.shaft_element</span> <span class="kn">import</span> <span class="n">ShaftElement</span><span class="p">,</span> <span class="n">ShaftElement6DoF</span>
<span class="kn">from</span> <span class="nn">ross.units</span> <span class="kn">import</span> <span class="n">Q_</span><span class="p">,</span> <span class="n">check_units</span>
<span class="kn">from</span> <span class="nn">ross.utils</span> <span class="kn">import</span> <span class="n">intersection</span>

<span class="c1"># fmt: on</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Rotor&quot;</span><span class="p">,</span> <span class="s2">&quot;CoAxialRotor&quot;</span><span class="p">,</span> <span class="s2">&quot;rotor_example&quot;</span><span class="p">,</span> <span class="s2">&quot;coaxrotor_example&quot;</span><span class="p">]</span>

<span class="c1"># set Plotly palette of colors</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">qualitative</span><span class="o">.</span><span class="n">Dark24</span>


<div class="viewcode-block" id="Rotor"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor">[docs]</a><span class="k">class</span> <span class="nc">Rotor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A rotor object.</span>

<span class="sd">    This class will create a rotor with the shaft,</span>
<span class="sd">    disk, bearing and seal elements provided.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shaft_elements : list</span>
<span class="sd">        List with the shaft elements</span>
<span class="sd">    disk_elements : list</span>
<span class="sd">        List with the disk elements</span>
<span class="sd">    bearing_elements : list</span>
<span class="sd">        List with the bearing elements</span>
<span class="sd">    point_mass_elements: list</span>
<span class="sd">        List with the point mass elements</span>
<span class="sd">    tag : str</span>
<span class="sd">        A tag for the rotor</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A rotor object.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    evalues : array</span>
<span class="sd">        Rotor&#39;s eigenvalues.</span>
<span class="sd">    evectors : array</span>
<span class="sd">        Rotor&#39;s eigenvectors.</span>
<span class="sd">    wn : array</span>
<span class="sd">        Rotor&#39;s natural frequencies in rad/s.</span>
<span class="sd">    wd : array</span>
<span class="sd">        Rotor&#39;s damped natural frequencies in rad/s.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #  Rotor without damping with 2 shaft elements 1 disk and 2 bearings</span>
<span class="sd">    &gt;&gt;&gt; import ross as rs</span>
<span class="sd">    &gt;&gt;&gt; steel = rs.materials.steel</span>
<span class="sd">    &gt;&gt;&gt; z = 0</span>
<span class="sd">    &gt;&gt;&gt; le = 0.25</span>
<span class="sd">    &gt;&gt;&gt; i_d = 0</span>
<span class="sd">    &gt;&gt;&gt; o_d = 0.05</span>
<span class="sd">    &gt;&gt;&gt; tim0 = rs.ShaftElement(le, i_d, o_d,</span>
<span class="sd">    ...                        material=steel,</span>
<span class="sd">    ...                        shear_effects=True,</span>
<span class="sd">    ...                        rotary_inertia=True,</span>
<span class="sd">    ...                        gyroscopic=True)</span>
<span class="sd">    &gt;&gt;&gt; tim1 = rs.ShaftElement(le, i_d, o_d,</span>
<span class="sd">    ...                        material=steel,</span>
<span class="sd">    ...                        shear_effects=True,</span>
<span class="sd">    ...                        rotary_inertia=True,</span>
<span class="sd">    ...                        gyroscopic=True)</span>
<span class="sd">    &gt;&gt;&gt; shaft_elm = [tim0, tim1]</span>
<span class="sd">    &gt;&gt;&gt; disk0 = rs.DiskElement.from_geometry(1, steel, 0.07, 0.05, 0.28)</span>
<span class="sd">    &gt;&gt;&gt; stf = 1e6</span>
<span class="sd">    &gt;&gt;&gt; bearing0 = rs.BearingElement(0, kxx=stf, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearing1 = rs.BearingElement(2, kxx=stf, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; rotor = rs.Rotor(shaft_elm, [disk0], [bearing0, bearing1])</span>
<span class="sd">    &gt;&gt;&gt; modal = rotor.run_modal(speed=0)</span>
<span class="sd">    &gt;&gt;&gt; modal.wd[0] # doctest: +ELLIPSIS</span>
<span class="sd">    215.3707...</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Rotor.__init__"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">shaft_elements</span><span class="p">,</span>
        <span class="n">disk_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">bearing_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">point_mass_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">min_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rated_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;min_w&quot;</span><span class="p">:</span> <span class="n">min_w</span><span class="p">,</span> <span class="s2">&quot;max_w&quot;</span><span class="p">:</span> <span class="n">max_w</span><span class="p">,</span> <span class="s2">&quot;rated_w&quot;</span><span class="p">:</span> <span class="n">rated_w</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Rotor 0&quot;</span> <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tag</span>

        <span class="c1">####################################################</span>
        <span class="c1"># Config attributes</span>
        <span class="c1">####################################################</span>

        <span class="c1"># operational speeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_w</span> <span class="o">=</span> <span class="n">min_w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_w</span> <span class="o">=</span> <span class="n">max_w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span> <span class="o">=</span> <span class="n">rated_w</span>

        <span class="c1">####################################################</span>

        <span class="c1"># flatten shaft_elements</span>
        <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
                    <span class="k">yield from</span> <span class="n">flatten</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">el</span>

        <span class="c1"># flatten and make a copy for shaft elements to avoid altering</span>
        <span class="c1"># attributes for elements that might be used in different rotors</span>
        <span class="c1"># e.g. altering shaft_element.n</span>
        <span class="n">shaft_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">flatten</span><span class="p">(</span><span class="n">shaft_elements</span><span class="p">)]</span>

        <span class="c1"># set n for each shaft element</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shaft_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">disk_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">disk_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">bearing_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bearing_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">point_mass_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">point_mass_elements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">disk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disk_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">disk</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Disk &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">brg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">brg</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">)</span> <span class="ow">and</span> <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Bearing &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">brg</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">)</span> <span class="ow">and</span> <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Seal &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p_mass</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">point_mass_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Point Mass &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span> <span class="o">=</span> <span class="n">disk_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span> <span class="o">=</span> <span class="n">point_mass_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">el</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">flatten</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># check if tags are unique</span>
        <span class="n">tags_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">tag</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tags_list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Tags should be unique.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_number_dof</span><span class="p">()</span>

        <span class="c1">####################################################</span>
        <span class="c1"># Rotor summary</span>
        <span class="c1">####################################################</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_link&quot;</span><span class="p">,</span>
            <span class="s2">&quot;L&quot;</span><span class="p">,</span>
            <span class="s2">&quot;node_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;node_pos_r&quot;</span><span class="p">,</span>
            <span class="s2">&quot;idl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;odl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;idr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;odr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;i_d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;o_d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;beam_cg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axial_cg_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;y_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;material&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rho&quot;</span><span class="p">,</span>
            <span class="s2">&quot;volume&quot;</span><span class="p">,</span>
            <span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">df_shaft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="n">df_disks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="n">df_bearings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_seals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_point_mass</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">])</span>

        <span class="n">nodes_pos_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">nodes_pos_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>
                <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">+</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;n_l&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;n_l&quot;</span><span class="p">]:</span>
                <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>
            <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">+</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;axial_cg_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axial_cg_pos</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">df_shaft</span><span class="p">,</span> <span class="n">df_disks</span><span class="p">,</span> <span class="n">df_bearings</span><span class="p">,</span> <span class="n">df_point_mass</span><span class="p">,</span> <span class="n">df_seals</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;n_l&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>

        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">))</span>
        <span class="n">df_disks</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_disks</span><span class="p">))</span>
        <span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_bearings</span><span class="p">))</span>
        <span class="n">df_seals</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_seals</span><span class="p">))</span>
        <span class="n">df_point_mass</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_point_mass</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span> <span class="o">=</span> <span class="n">df_disks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span> <span class="o">=</span> <span class="n">df_bearings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span> <span class="o">=</span> <span class="n">df_shaft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_point_mass</span> <span class="o">=</span> <span class="n">df_point_mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_seals</span> <span class="o">=</span> <span class="n">df_seals</span>

        <span class="c1"># check consistence for disks and bearings location</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_point_mass</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_loc_point_mass</span> <span class="o">=</span> <span class="n">df_point_mass</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_loc_point_mass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_location</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">max_loc_point_mass</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">n_l</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_location</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trying to set disk or bearing outside shaft&quot;</span><span class="p">)</span>

        <span class="c1"># nodes axial position and diameter</span>
        <span class="n">nodes_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">nodes_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span> <span class="o">=</span> <span class="n">nodes_pos</span>

        <span class="n">nodes_i_d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">nodes_i_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_i_d</span> <span class="o">=</span> <span class="n">nodes_i_d</span>

        <span class="n">nodes_o_d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">nodes_o_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_o_d</span> <span class="o">=</span> <span class="n">nodes_o_d</span>

        <span class="n">shaft_elements_length</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;L&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements_length</span> <span class="o">=</span> <span class="n">shaft_elements_length</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;n_link&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;n_link&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_nodes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># rotor mass can also be calculated with self.M()[::4, ::4].sum()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_disks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">disk</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_shaft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sh_el</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">sh_el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_disks</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_shaft</span>

        <span class="c1"># rotor center of mass and total inertia</span>
        <span class="n">CG_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">sh</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">CG_dsk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CG</span> <span class="o">=</span> <span class="n">CG_sh</span> <span class="o">+</span> <span class="n">CG_dsk</span>

        <span class="n">Ip_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sh</span><span class="o">.</span><span class="n">Im</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="n">Ip_dsk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">disk</span><span class="o">.</span><span class="n">Ip</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span> <span class="o">=</span> <span class="n">Ip_sh</span> <span class="o">+</span> <span class="n">Ip_dsk</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_v0</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># used to call eigs</span>

        <span class="c1"># number of dofs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">*</span> <span class="nb">max</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">n</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">shaft_elements</span><span class="p">])</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">([</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">point_mass_elements</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># global indexes for dofs</span>
        <span class="n">n_last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dof_mapping</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_mapping</span><span class="p">()</span>
            <span class="n">global_dof_mapping</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">dof_letter</span><span class="p">,</span> <span class="n">dof_number</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="n">global_dof_mapping</span><span class="p">[</span>
                    <span class="n">dof_letter</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dof_number</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">dof_tuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;GlobalIndex&quot;</span><span class="p">,</span> <span class="n">global_dof_mapping</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">global_dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">global_dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">+</span> <span class="n">v</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="s2">&quot;n_link&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">&lt;=</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x_</span><span class="si">{</span><span class="n">elm</span><span class="o">.</span><span class="n">n_link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span>
                    <span class="p">)</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;y_</span><span class="si">{</span><span class="n">elm</span><span class="o">.</span><span class="n">n_link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x_</span><span class="si">{</span><span class="n">elm</span><span class="o">.</span><span class="n">n_link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span>
                    <span class="p">)</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;y_</span><span class="si">{</span><span class="n">elm</span><span class="o">.</span><span class="n">n_link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>

            <span class="n">dof_tuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;GlobalIndex&quot;</span><span class="p">,</span> <span class="n">global_dof_mapping</span><span class="p">)</span>
            <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span> <span class="o">=</span> <span class="n">dof_tuple</span><span class="p">(</span><span class="o">**</span><span class="n">global_dof_mapping</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;dof_global_index&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>

        <span class="c1"># define positions for disks</span>
        <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">disk_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">nodes_o_d</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>

        <span class="c1"># define positions for bearings</span>
        <span class="c1"># check if there are bearings without location</span>
        <span class="n">bearings_no_zloc</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">b</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearing_elements</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="c1"># cycle while there are bearings without a z location</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bearings_no_zloc</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearings_no_zloc</span><span class="p">:</span>
                    <span class="c1"># first check if b.n is on list, if not, check for n_link</span>
                    <span class="n">node_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span>
                    <span class="n">node_r</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">node_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_l&quot;</span>
                        <span class="p">]</span>
                        <span class="n">node_r</span> <span class="o">=</span> <span class="n">node_l</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_l</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bearings_no_zloc</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_r</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bearings_no_zloc</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement6DoF&quot;</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;SealElement&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">dfb</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">z_positions</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">z_pos</span> <span class="ow">in</span> <span class="n">z_positions</span><span class="p">:</span>
            <span class="n">dfb_z_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">nodes_pos_l</span> <span class="o">==</span> <span class="n">z_pos</span><span class="p">]</span>
            <span class="n">dfb_z_pos</span> <span class="o">=</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;n_l&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span>
                            <span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;n_l&quot;</span><span class="p">])</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span>
                            <span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;n_r&quot;</span><span class="p">])</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="nb">max</span><span class="p">(</span>
                                <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span>
                                    <span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;n_l&quot;</span><span class="p">])</span>
                                <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                            <span class="p">),</span>
                            <span class="nb">max</span><span class="p">(</span>
                                <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span>
                                    <span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;n_l&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                                <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="n">mean_od</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">nodes_o_d</span><span class="p">)</span>
            <span class="n">scale_size</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">mean_od</span>
            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="n">y_pos</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scale_size</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;y_pos_sup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos_sup</span>
                <span class="n">y_pos</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mean_od</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_pos_sup</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mean_od</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># define position for point mass elements</span>
        <span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement6DoF&quot;</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;SealElement&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">point_mass_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span></div>

    <span class="k">def</span> <span class="nf">_check_number_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify the consistency of degrees of freedom.</span>

<span class="sd">        This method loops for all the elements, checking if the number of degrees of</span>
<span class="sd">        freedom is consistent.</span>
<span class="sd">        E.g.: inputting 2 shaft elements, one with 4 dof and one with 6, will raise</span>
<span class="sd">        an error.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            Error pointing out difference between the number of DoF&#39;s from each element</span>
<span class="sd">            type.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        number_dof : int</span>
<span class="sd">            Number of degrees of freedom from the adopted shaft element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">number_dof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dof_mapping</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">dof_mapping</span><span class="p">())</span> <span class="o">!=</span> <span class="n">number_dof</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;The number of degrees o freedom of all elements must be the same! There are SHAFT elements with discrepant DoFs.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">dof_mapping</span><span class="p">())</span> <span class="o">!=</span> <span class="n">number_dof</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;The number of degrees o freedom of all elements must be the same! There are DISK elements with discrepant DoFs.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">brg</span><span class="o">.</span><span class="n">dof_mapping</span><span class="p">())</span> <span class="o">!=</span> <span class="n">number_dof</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">brg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;The number of degrees o freedom of all elements must be the same! There are BEARING elements with discrepant DoFs.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">number_dof</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Equality method for comparasions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : obj</span>
<span class="sd">            parameter for comparasion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        True if other is equal to the reference parameter.</span>
<span class="sd">        False if not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">elements</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Rotor.run_modal"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_modal.html#ross.Rotor.run_modal">[docs]</a>    <span class="k">def</span> <span class="nf">run_modal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">num_modes</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run modal analysis.</span>

<span class="sd">        Method to calculate eigenvalues and eigvectors for a given rotor system.</span>
<span class="sd">        Tthe natural frequencies and dampings ratios are calculated for a given</span>
<span class="sd">        rotor speed. It means that for each speed input there&#39;s a different set of</span>
<span class="sd">        eigenvalues and eigenvectors, hence, different natural frequencies and damping</span>
<span class="sd">        ratios are returned.</span>
<span class="sd">        This method will return a ModalResults object which stores all data generated</span>
<span class="sd">        and also provides so methods for plotting.</span>

<span class="sd">        Available plotting methods:</span>
<span class="sd">            .plot_mode_2d()</span>
<span class="sd">            .plot_mode_3d()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed : float</span>
<span class="sd">            Speed at which the eigenvalues and eigenvectors will be calculated.</span>
<span class="sd">        num_modes : int, optional</span>
<span class="sd">            The number of eigenvalues and eigenvectors to be calculated using ARPACK.</span>
<span class="sd">            If sparse=True, it determines the number of eigenvalues and eigenvectors</span>
<span class="sd">            to be calculated. It must be smaller than Rotor.ndof - 1. It is not</span>
<span class="sd">            possible to compute all eigenvectors of a matrix with ARPACK.</span>
<span class="sd">            If sparse=False, num_modes does not have any effect over the method.</span>
<span class="sd">            Default is 12.</span>
<span class="sd">        sparse : bool, optional</span>
<span class="sd">            If True, ARPACK is used to calculate a desired number (according to</span>
<span class="sd">            num_modes) or eigenvalues and eigenvectors.</span>
<span class="sd">            If False, scipy.linalg.eig() is used to calculate all the eigenvalues and</span>
<span class="sd">            eigenvectors.</span>
<span class="sd">            Default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : ross.ModalResults</span>
<span class="sd">            For more information on attributes and methods available see:</span>
<span class="sd">            :py:class:`ross.ModalResults`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; modal = rotor.run_modal(speed=0, sparse=False)</span>
<span class="sd">        &gt;&gt;&gt; modal.wn[:2]</span>
<span class="sd">        array([91.79655318, 96.28899977])</span>
<span class="sd">        &gt;&gt;&gt; modal.wd[:2]</span>
<span class="sd">        array([91.79655318, 96.28899977])</span>
<span class="sd">        &gt;&gt;&gt; # Plotting 3D mode shape</span>
<span class="sd">        &gt;&gt;&gt; mode1 = 0  # First mode</span>
<span class="sd">        &gt;&gt;&gt; fig = modal.plot_mode_3d(mode1)</span>
<span class="sd">        &gt;&gt;&gt; # Plotting 2D mode shape</span>
<span class="sd">        &gt;&gt;&gt; mode2 = 1  # Second mode</span>
<span class="sd">        &gt;&gt;&gt; fig = modal.plot_mode_2d(mode2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigen</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">num_modes</span><span class="o">=</span><span class="n">num_modes</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="n">sparse</span><span class="p">)</span>
        <span class="n">wn_len</span> <span class="o">=</span> <span class="n">num_modes</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">wn</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">evalues</span><span class="p">))[:</span><span class="n">wn_len</span><span class="p">]</span>
        <span class="n">wd</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">evalues</span><span class="p">))[:</span><span class="n">wn_len</span><span class="p">]</span>
        <span class="n">damping_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">evalues</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">evalues</span><span class="p">))[:</span><span class="n">wn_len</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">log_dec</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">damping_ratio</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">damping_ratio</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">modal_results</span> <span class="o">=</span> <span class="n">ModalResults</span><span class="p">(</span>
            <span class="n">speed</span><span class="p">,</span>
            <span class="n">evalues</span><span class="p">,</span>
            <span class="n">evectors</span><span class="p">,</span>
            <span class="n">wn</span><span class="p">,</span>
            <span class="n">wd</span><span class="p">,</span>
            <span class="n">damping_ratio</span><span class="p">,</span>
            <span class="n">log_dec</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements_length</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">modal_results</span></div>

<div class="viewcode-block" id="Rotor.run_critical_speed"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_critical_speed.html#ross.Rotor.run_critical_speed">[docs]</a>    <span class="k">def</span> <span class="nf">run_critical_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_modes</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.005</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the critical speeds and damping ratios for the rotor model.</span>

<span class="sd">        This function runs an iterative method over &quot;run_modal()&quot; to minimize</span>
<span class="sd">        (using scipy.optimize.newton) the error between the rotor speed and the rotor</span>
<span class="sd">        critical speeds (rotor speed - critical speed).</span>

<span class="sd">        Differently from run_modal(), this function doesn&#39;t take a speed input because</span>
<span class="sd">        it iterates over the natural frequencies calculated in the last iteration.</span>
<span class="sd">        The initial value is considered to be the undamped natural frequecies for</span>
<span class="sd">        speed = 0 (no gyroscopic effect).</span>

<span class="sd">        Once the error is within an acceptable range defined by &quot;rtol&quot;, it returns the</span>
<span class="sd">        approximated critical speed.</span>

<span class="sd">        With the critical speeds calculated, the function uses the results to</span>
<span class="sd">        calculate the log dec and damping ratios for each critical speed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed_range : tuple</span>
<span class="sd">            Tuple (start, end) with the desired range of frequencies (rad/s).</span>
<span class="sd">            The function returns all eigenvalues within this range.</span>
<span class="sd">        num_modes : int, optional</span>
<span class="sd">            The number of eigenvalues and eigenvectors to be calculated using ARPACK.</span>
<span class="sd">            If sparse=True, it determines the number of eigenvalues and eigenvectors</span>
<span class="sd">            to be calculated. It must be smaller than Rotor.ndof - 1. It is not</span>
<span class="sd">            possible to compute all eigenvectors of a matrix with ARPACK.</span>
<span class="sd">            If speed_range is not None, num_modes is overrided.</span>
<span class="sd">            Default is 12.</span>
<span class="sd">        rtol : float, optional</span>
<span class="sd">            Tolerance (relative) for termination. Applied to scipy.optimize.newton.</span>
<span class="sd">            Default is 0.005 (0.5%).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CriticalSpeedResults : An instance of CriticalSpeedResults class, which is</span>
<span class="sd">        used to post-process results. Attributes stored:</span>
<span class="sd">            CriticalSpeedResults.wn() : undamped critical speeds.</span>
<span class="sd">            CriticalSpeedResults.wd(): damped critical speeds.</span>
<span class="sd">            CriticalSpeedResults.log_dec : log_dec for each critical speed.</span>
<span class="sd">            CriticalSpeedResults.damping_ratio : damping ratio for each critical speed.</span>
<span class="sd">            CriticalSpeedResults.whirl_direction : whirl dir. for each critical speed.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>

<span class="sd">        Finding the first Nth critical speeds</span>
<span class="sd">        &gt;&gt;&gt; results = rotor.run_critical_speed(num_modes=8)</span>
<span class="sd">        &gt;&gt;&gt; np.round(results.wd())</span>
<span class="sd">        array([ 92.,  96., 271., 300.])</span>
<span class="sd">        &gt;&gt;&gt; np.round(results.wn())</span>
<span class="sd">        array([ 92.,  96., 271., 300.])</span>

<span class="sd">        Finding the first critical speeds within a speed range</span>
<span class="sd">        &gt;&gt;&gt; results = rotor.run_critical_speed(speed_range=(100, 1000))</span>
<span class="sd">        &gt;&gt;&gt; np.round(results.wd())</span>
<span class="sd">        array([271., 300., 636., 867.])</span>

<span class="sd">        Changing output units</span>
<span class="sd">        &gt;&gt;&gt; np.round(results.wd(&quot;rpm&quot;))</span>
<span class="sd">        array([2590., 2868., 6074., 8278.])</span>

<span class="sd">        Retrieving whirl directions</span>
<span class="sd">        &gt;&gt;&gt; results.whirl_direction # doctest: +ELLIPSIS</span>
<span class="sd">        array([...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_modes</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">speed_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">num_modes</span>

        <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">)</span>
        <span class="n">_wn</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span>
        <span class="n">_wd</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wd</span>
        <span class="n">wn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">_wn</span><span class="p">)</span>
        <span class="n">wd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">_wd</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wn</span><span class="p">)):</span>
            <span class="n">wn_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">)</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">wn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">wn_func</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">_wn</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wd</span><span class="p">)):</span>
            <span class="n">wd_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">)</span><span class="o">.</span><span class="n">wd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">wd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">wd_func</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">_wd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">)</span>

        <span class="n">log_dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wn</span><span class="p">)</span>
        <span class="n">damping_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wn</span><span class="p">)</span>
        <span class="n">whirl_direction</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wn</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wd</span><span class="p">):</span>
            <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">)</span>
            <span class="n">log_dec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">log_dec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">damping_ratio</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">damping_ratio</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">whirl_direction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">whirl_direction</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">whirl_direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">whirl_direction</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">speed_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">speed_range</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">wd</span> <span class="o">&gt;=</span> <span class="n">vmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wd</span> <span class="o">&lt;=</span> <span class="n">vmax</span><span class="p">))</span>
            <span class="n">wn</span> <span class="o">=</span> <span class="n">wn</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="n">wd</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">log_dec</span> <span class="o">=</span> <span class="n">log_dec</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">damping_ratio</span> <span class="o">=</span> <span class="n">damping_ratio</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">whirl_direction</span> <span class="o">=</span> <span class="n">whirl_direction</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">CriticalSpeedResults</span><span class="p">(</span><span class="n">wn</span><span class="p">,</span> <span class="n">wd</span><span class="p">,</span> <span class="n">log_dec</span><span class="p">,</span> <span class="n">damping_ratio</span><span class="p">,</span> <span class="n">whirl_direction</span><span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.convergence"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.convergence">[docs]</a>    <span class="k">def</span> <span class="nf">convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_eigval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">err_max</span><span class="o">=</span><span class="mf">1e-02</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run convergence analysis.</span>

<span class="sd">        Function to analyze the eigenvalues convergence through the number of</span>
<span class="sd">        shaft elements. Every new run doubles the number os shaft elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_eigval : int</span>
<span class="sd">            The nth eigenvalue which the convergence analysis will run.</span>
<span class="sd">            Default is 0 (the first eigenvalue).</span>
<span class="sd">        err_max : float</span>
<span class="sd">            Maximum allowable convergence error.</span>
<span class="sd">            Default is 1e-02</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : An instance of ConvergenceResults class, which is used to post-process</span>
<span class="sd">        results. Attributes stored:</span>
<span class="sd">            el_num : array</span>
<span class="sd">                Array with number of elements in each iteraction</span>
<span class="sd">            eigv_arr : array</span>
<span class="sd">                Array with the n&#39;th natural frequency in each iteraction</span>
<span class="sd">            error_arr : array</span>
<span class="sd">                Array with the relative error in each iteraction</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; i_d = 0</span>
<span class="sd">        &gt;&gt;&gt; o_d = 0.05</span>
<span class="sd">        &gt;&gt;&gt; n = 6</span>
<span class="sd">        &gt;&gt;&gt; L = [0.25 for _ in range(n)]</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; shaft_elem = [rs.ShaftElement(l, i_d, o_d, material=steel,</span>
<span class="sd">        ... shear_effects=True, rotary_inertia=True, gyroscopic=True) for l in L]</span>
<span class="sd">        &gt;&gt;&gt; disk0 = DiskElement.from_geometry(2, steel, 0.07, 0.05, 0.28)</span>
<span class="sd">        &gt;&gt;&gt; disk1 = DiskElement.from_geometry(4, steel, 0.07, 0.05, 0.35)</span>
<span class="sd">        &gt;&gt;&gt; bearing0 = BearingElement(0, kxx=1e6, kyy=8e5, cxx=2e3)</span>
<span class="sd">        &gt;&gt;&gt; bearing1 = BearingElement(6, kxx=1e6, kyy=8e5, cxx=2e3)</span>
<span class="sd">        &gt;&gt;&gt; rotor0 = Rotor(shaft_elem, [disk0, disk1], [bearing0, bearing1])</span>
<span class="sd">        &gt;&gt;&gt; len(rotor0.shaft_elements)</span>
<span class="sd">        6</span>
<span class="sd">        &gt;&gt;&gt; convergence = rotor0.convergence(n_eigval=0, err_max=1e-08)</span>
<span class="sd">        &gt;&gt;&gt; len(rotor0.shaft_elements)</span>
<span class="sd">        96</span>

<span class="sd">        Plotting convergence graphics</span>
<span class="sd">        &gt;&gt;&gt; fig = convergence.plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">el_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">)])</span>
        <span class="n">eigv_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">error_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eigv_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eigv_arr</span><span class="p">,</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="n">n_eigval</span><span class="p">])</span>

        <span class="c1"># this value is up to start the loop while</span>
        <span class="n">error</span> <span class="o">=</span> <span class="mf">1.0e10</span>
        <span class="n">nel_r</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="k">while</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="n">err_max</span><span class="p">:</span>
            <span class="n">shaft_elem</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">disk_elem</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">brgs_elem</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">:</span>
                <span class="n">le</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">L</span> <span class="o">/</span> <span class="n">nel_r</span>
                <span class="n">odl</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">odl</span>
                <span class="n">odr</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">odr</span>
                <span class="n">idl</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">idl</span>
                <span class="n">idr</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">.</span><span class="n">idr</span>

                <span class="c1"># loop to double the number of element</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nel_r</span><span class="p">):</span>
                    <span class="n">odr</span> <span class="o">=</span> <span class="p">((</span><span class="n">nel_r</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">odl</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">odr</span><span class="p">)</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="n">idr</span> <span class="o">=</span> <span class="p">((</span><span class="n">nel_r</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">idl</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">idr</span><span class="p">)</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="n">odl</span> <span class="o">=</span> <span class="p">((</span><span class="n">nel_r</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">odl</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">odr</span><span class="p">)</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="n">idl</span> <span class="o">=</span> <span class="p">((</span><span class="n">nel_r</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">idl</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">idr</span><span class="p">)</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="n">shaft_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">ShaftElement</span><span class="p">(</span>
                            <span class="n">L</span><span class="o">=</span><span class="n">le</span><span class="p">,</span>
                            <span class="n">idl</span><span class="o">=</span><span class="n">idl</span><span class="p">,</span>
                            <span class="n">odl</span><span class="o">=</span><span class="n">odl</span><span class="p">,</span>
                            <span class="n">idr</span><span class="o">=</span><span class="n">idr</span><span class="p">,</span>
                            <span class="n">odr</span><span class="o">=</span><span class="n">odr</span><span class="p">,</span>
                            <span class="n">material</span><span class="o">=</span><span class="n">shaft</span><span class="o">.</span><span class="n">material</span><span class="p">,</span>
                            <span class="n">shear_effects</span><span class="o">=</span><span class="n">shaft</span><span class="o">.</span><span class="n">shear_effects</span><span class="p">,</span>
                            <span class="n">rotary_inertia</span><span class="o">=</span><span class="n">shaft</span><span class="o">.</span><span class="n">rotary_inertia</span><span class="p">,</span>
                            <span class="n">gyroscopic</span><span class="o">=</span><span class="n">shaft</span><span class="o">.</span><span class="n">gyroscopic</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">for</span> <span class="n">DiskEl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">:</span>
                <span class="n">aux_DiskEl</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">DiskEl</span><span class="p">)</span>
                <span class="n">aux_DiskEl</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">DiskEl</span><span class="o">.</span><span class="n">n</span>
                <span class="n">disk_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_DiskEl</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">Brg_SealEl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
                <span class="n">aux_Brg_SealEl</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">Brg_SealEl</span><span class="p">)</span>
                <span class="n">aux_Brg_SealEl</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">Brg_SealEl</span><span class="o">.</span><span class="n">n</span>
                <span class="n">brgs_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_Brg_SealEl</span><span class="p">)</span>

            <span class="n">aux_rotor</span> <span class="o">=</span> <span class="n">Rotor</span><span class="p">(</span><span class="n">shaft_elem</span><span class="p">,</span> <span class="n">disk_elem</span><span class="p">,</span> <span class="n">brgs_elem</span><span class="p">)</span>
            <span class="n">aux_modal</span> <span class="o">=</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">eigv_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eigv_arr</span><span class="p">,</span> <span class="n">aux_modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="n">n_eigval</span><span class="p">])</span>
            <span class="n">el_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el_num</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shaft_elem</span><span class="p">))</span>

            <span class="n">error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eigv_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">eigv_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

            <span class="n">error_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_arr</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">error</span><span class="p">)</span>
            <span class="n">nel_r</span> <span class="o">*=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_arr</span> <span class="o">=</span> <span class="n">error_arr</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">ConvergenceResults</span><span class="p">(</span><span class="n">el_num</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">eigv_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">error_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.M"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.M">[docs]</a>    <span class="k">def</span> <span class="nf">M</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mass matrix for an instance of a rotor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        M0 : np.ndarray</span>
<span class="sd">            Mass matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.M()[:4, :4]</span>
<span class="sd">        array([[ 1.42050794,  0.        ,  0.        ,  0.04931719],</span>
<span class="sd">               [ 0.        ,  1.42050794, -0.04931719,  0.        ],</span>
<span class="sd">               [ 0.        , -0.04931719,  0.00231392,  0.        ],</span>
<span class="sd">               [ 0.04931719,  0.        ,  0.        ,  0.00231392]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">M0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>
            <span class="n">M0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">M</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">M0</span></div>

<div class="viewcode-block" id="Rotor.K"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.K">[docs]</a>    <span class="k">def</span> <span class="nf">K</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stiffness matrix for an instance of a rotor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frequency : float, optional</span>
<span class="sd">            Excitation frequency.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        K0 : np.ndarray</span>
<span class="sd">            Stiffness matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; np.round(rotor.K(0)[:4, :4]/1e6)</span>
<span class="sd">        array([[47.,  0.,  0.,  6.],</span>
<span class="sd">               [ 0., 46., -6.,  0.],</span>
<span class="sd">               [ 0., -6.,  1.,  0.],</span>
<span class="sd">               [ 6.,  0.,  0.,  1.]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">K0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">K0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">K0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">K</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">K0</span></div>

<div class="viewcode-block" id="Rotor.Kst"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.Kst">[docs]</a>    <span class="k">def</span> <span class="nf">Kst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dynamic stiffness matrix for an instance of a rotor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Kst0 : np.ndarray</span>
<span class="sd">            Dynamic stiffness matrix for the rotor.</span>
<span class="sd">            This matris IS OMEGA dependent</span>
<span class="sd">            Only useable to the 6 DoF model.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example_6dof()</span>
<span class="sd">        &gt;&gt;&gt; np.round(rotor.Kst()[:6, :6]*1e6)</span>
<span class="sd">        array([[     0., -23002.,      0.,   -479.,      0.,      0.],</span>
<span class="sd">               [     0.,      0.,      0.,      0.,      0.,      0.],</span>
<span class="sd">               [     0.,      0.,      0.,      0.,      0.,      0.],</span>
<span class="sd">               [     0.,      0.,      0.,      0.,      0.,      0.],</span>
<span class="sd">               [     0.,    479.,      0.,    160.,      0.,      0.],</span>
<span class="sd">               [     0.,      0.,      0.,      0.,      0.,      0.]])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Kst0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">:</span>
                <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">Kst0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">Kst</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">Kst0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">Kst</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">Kst0</span></div>

<div class="viewcode-block" id="Rotor.C"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.C">[docs]</a>    <span class="k">def</span> <span class="nf">C</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Damping matrix for an instance of a rotor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frequency : float</span>
<span class="sd">            Excitation frequency.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        C0 : np.ndarray</span>
<span class="sd">            Damping matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.C(0)[:4, :4]</span>
<span class="sd">        array([[0., 0., 0., 0.],</span>
<span class="sd">               [0., 0., 0., 0.],</span>
<span class="sd">               [0., 0., 0., 0.],</span>
<span class="sd">               [0., 0., 0., 0.]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">C0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">C</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">C0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">C</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">C0</span></div>

<div class="viewcode-block" id="Rotor.G"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.G">[docs]</a>    <span class="k">def</span> <span class="nf">G</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gyroscopic matrix for an instance of a rotor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        G0 : np.ndarray</span>
<span class="sd">            Gyroscopic matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.G()[:4, :4]</span>
<span class="sd">        array([[ 0.        ,  0.01943344, -0.00022681,  0.        ],</span>
<span class="sd">               [-0.01943344,  0.        ,  0.        , -0.00022681],</span>
<span class="sd">               [ 0.00022681,  0.        ,  0.        ,  0.0001524 ],</span>
<span class="sd">               [ 0.        ,  0.00022681, -0.0001524 ,  0.        ]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">G0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>
            <span class="n">G0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">elm</span><span class="o">.</span><span class="n">G</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">G0</span></div>

<div class="viewcode-block" id="Rotor.A"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.A">[docs]</a>    <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;State space matrix for an instance of a rotor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed: float, optional</span>
<span class="sd">            Rotor speed.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        frequency : float, optional</span>
<span class="sd">            Excitation frequency. Default is rotor speed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A : np.ndarray</span>
<span class="sd">            State space matrix for the rotor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; np.round(rotor.A()[50:56, :2])</span>
<span class="sd">        array([[     0.,  10927.],</span>
<span class="sd">               [-10924.,     -0.],</span>
<span class="sd">               [  -174.,      0.],</span>
<span class="sd">               [    -0.,   -174.],</span>
<span class="sd">               [    -0.,  10723.],</span>
<span class="sd">               [-10719.,     -0.]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frequency</span> <span class="o">=</span> <span class="n">speed</span>

        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">)</span>

        <span class="c1"># fmt: off</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Z</span><span class="p">,</span> <span class="n">I</span><span class="p">]),</span>
             <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kst</span><span class="p">()</span><span class="o">*</span><span class="n">speed</span><span class="p">),</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">()</span> <span class="o">*</span> <span class="n">speed</span><span class="p">))])])</span>
        <span class="c1"># fmt: on</span>

        <span class="k">return</span> <span class="n">A</span></div>

    <span class="k">def</span> <span class="nf">_check_frequency_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_range</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify if bearing elements coefficients are extrapolated.</span>

<span class="sd">        This method takes the frequency / speed range array applied to a particular</span>
<span class="sd">        method (run_campbell, run_freq_response) and checks if it&#39;s extrapolating the</span>
<span class="sd">        bearing rotordynamics coefficients.</span>

<span class="sd">        If any value of frequency_range argument is out of any bearing frequency</span>
<span class="sd">        parameter, the warning is raised.</span>
<span class="sd">        If none of the bearings has a frequency argument assinged, no warning will be</span>
<span class="sd">        raised.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frequency_range : array</span>
<span class="sd">            The array of frequencies or speeds used in particular method.</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>
<span class="sd">            It warns the user if the frequency_range causes the bearing coefficients</span>
<span class="sd">            to be extrapolated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># fmt: off</span>
        <span class="k">for</span> <span class="n">bearing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bearing</span><span class="o">.</span><span class="n">kxx</span><span class="o">.</span><span class="n">frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frequency_range</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">bearing</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frequency_range</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">bearing</span><span class="o">.</span><span class="n">frequency</span><span class="p">)):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;Extrapolating bearing coefficients. Be careful when post-processing the results.&quot;</span>
                    <span class="p">)</span>
                    <span class="k">break</span>
        <span class="c1"># fmt: on</span>

    <span class="k">def</span> <span class="nf">_clustering_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_modes</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.005</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an array with points clustered close to the natural frequencies.</span>

<span class="sd">        This method generates an automatic array to run frequency response analyses.</span>
<span class="sd">        The frequency points are calculated based on the damped natural frequencies and</span>
<span class="sd">        their respective damping ratios. The greater the damping ratio, the more spread</span>
<span class="sd">        the points are. If the damping ratio, for a given critical speed, is smaller</span>
<span class="sd">        than 0.005, it is redefined to be 0.005 (for this method only).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_modes : int, optional</span>
<span class="sd">            The number of eigenvalues and eigenvectors to be calculated using ARPACK.</span>
<span class="sd">            It also defines the range for the output array, since the method generates</span>
<span class="sd">            points only for the critical speed calculated by run_critical_speed().</span>
<span class="sd">            Default is 12.</span>
<span class="sd">        num_points : int, optional</span>
<span class="sd">            The number of points generated for each critical speed.</span>
<span class="sd">            The method set the same number of points for slightly less and slightly</span>
<span class="sd">            higher than the natural circular frequency. It means there&#39;ll be num_points</span>
<span class="sd">            greater and num_points smaller than a given critical speed.</span>
<span class="sd">            num_points may be between 2 and 12. Anything above this range defaults</span>
<span class="sd">            to 10 and anything below this range defaults to 4.</span>
<span class="sd">            The default is 10.</span>
<span class="sd">        modes : list, optional</span>
<span class="sd">            Modes that will be used to calculate the frequency response.</span>
<span class="sd">            The possibilities are limited by the num_modes argument.</span>
<span class="sd">            (all modes will be used if a list is not given).</span>
<span class="sd">        rtol : float, optional</span>
<span class="sd">            Tolerance (relative) for termination. Applied to scipy.optimize.newton in</span>
<span class="sd">            run_critical_speed() method.</span>
<span class="sd">            Default is 0.005 (0.5%).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        speed_range : array</span>
<span class="sd">            Range of frequencies (or speed).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed_range = rotor._clustering_points(num_modes=12, num_points=5)</span>
<span class="sd">        &gt;&gt;&gt; speed_range.shape</span>
<span class="sd">        (61,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">critical_speeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_critical_speed</span><span class="p">(</span><span class="n">num_modes</span><span class="o">=</span><span class="n">num_modes</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">)</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="n">critical_speeds</span><span class="o">.</span><span class="n">_wd</span>
        <span class="n">damping</span> <span class="o">=</span> <span class="n">critical_speeds</span><span class="o">.</span><span class="n">damping_ratio</span>
        <span class="n">damping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span> <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="mf">0.005</span> <span class="k">else</span> <span class="mf">0.005</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">damping</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">num_points</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">num_points</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">elif</span> <span class="n">num_points</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">num_points</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="n">modes</span><span class="p">]</span>
            <span class="n">damping</span> <span class="o">=</span> <span class="n">damping</span><span class="p">[</span><span class="n">modes</span><span class="p">]</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">),</span> <span class="n">num_points</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
                <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_points</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">damping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="n">b</span>

        <span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">speed_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">omega</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">a</span><span class="p">))))</span>
        <span class="n">speed_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">speed_range</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">speed_range</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate indexes to sort eigenvalues and eigenvectors.</span>

<span class="sd">        Function used to generate an index that will sort</span>
<span class="sd">        eigenvalues and eigenvectors based on the imaginary (wd)</span>
<span class="sd">        part of the eigenvalues. Positive eigenvalues will be</span>
<span class="sd">        positioned at the first half of the array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        eigenvalues: array</span>
<span class="sd">            Array with the eigenvalues.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        idx:</span>
<span class="sd">            An array with indices that will sort the</span>
<span class="sd">            eigenvalues and eigenvectors.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; evalues, evectors = rotor._eigen(0, sorted_=True)</span>
<span class="sd">        &gt;&gt;&gt; idx = rotor._index(evalues)</span>
<span class="sd">        &gt;&gt;&gt; idx[:6] # doctest: +ELLIPSIS</span>
<span class="sd">        array([0, 1, 2, 3, 4, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># avoid float point errors when sorting</span>
        <span class="n">evals_truncated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">evals_truncated</span><span class="p">)</span>  <span class="c1"># First column</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">evals_truncated</span><span class="p">)</span>  <span class="c1"># Second column</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>  <span class="c1"># Sort by imag (wd), then by absolute (wn)</span>
        <span class="c1"># Positive eigenvalues first</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]]</span>
        <span class="n">negative</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]]</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">positive</span><span class="p">,</span> <span class="n">negative</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">idx</span>

    <span class="k">def</span> <span class="nf">_eigen</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">num_modes</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sorted_</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate eigenvalues and eigenvectors.</span>

<span class="sd">        This method will return the eigenvalues and eigenvectors of the</span>
<span class="sd">        state space matrix A, sorted by the index method which considers</span>
<span class="sd">        the imaginary part (wd) of the eigenvalues for sorting.</span>
<span class="sd">        To avoid sorting use sorted_=False</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed : float</span>
<span class="sd">            Rotor speed.</span>
<span class="sd">        frequency: float</span>
<span class="sd">            Excitation frequency.</span>
<span class="sd">        sorted_ : bool, optional</span>
<span class="sd">            Sort considering the imaginary part (wd)</span>
<span class="sd">            Default is True</span>
<span class="sd">        A : np.array, optional</span>
<span class="sd">            Matrix for which eig will be calculated.</span>
<span class="sd">            Defaul is the rotor A matrix.</span>
<span class="sd">        sparse : bool, optional</span>
<span class="sd">            If sparse, eigenvalues will be calculated with arpack.</span>
<span class="sd">            Default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        evalues: array</span>
<span class="sd">            An array with the eigenvalues</span>
<span class="sd">        evectors array</span>
<span class="sd">            An array with the eigenvectors</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; evalues, evectors = rotor._eigen(0)</span>
<span class="sd">        &gt;&gt;&gt; evalues[0].imag # doctest: +ELLIPSIS</span>
<span class="sd">        91.796...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sparse</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span> <span class="o">=</span> <span class="n">las</span><span class="o">.</span><span class="n">eigs</span><span class="p">(</span>
                    <span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">num_modes</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncv</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_modes</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;LM&quot;</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_v0</span>
                <span class="p">)</span>
                <span class="c1"># store v0 as a linear combination of the previously</span>
                <span class="c1"># calculated eigenvectors to use in the next call to eigs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">evectors</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">las</span><span class="o">.</span><span class="n">ArpackError</span><span class="p">:</span>
                <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sorted_</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">evalues</span><span class="p">,</span> <span class="n">evectors</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span><span class="n">evalues</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">evalues</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">evectors</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_lti</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Continuous-time linear time invariant system.</span>

<span class="sd">        This method is used to create a Continuous-time linear</span>
<span class="sd">        time invariant system for the mdof system.</span>
<span class="sd">        From this system we can obtain poles, impulse response,</span>
<span class="sd">        generate a bode, etc.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed: float</span>
<span class="sd">            Rotor speed.</span>
<span class="sd">        frequency: float, optional</span>
<span class="sd">            Excitation frequency.</span>
<span class="sd">            Default is rotor speed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sys : StateSpaceContinuous</span>
<span class="sd">            Space State Continuos with A, B, C and D matrices</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; A = rotor._lti(speed=0).A</span>
<span class="sd">        &gt;&gt;&gt; B = rotor._lti(speed=0).B</span>
<span class="sd">        &gt;&gt;&gt; C = rotor._lti(speed=0).C</span>
<span class="sd">        &gt;&gt;&gt; D = rotor._lti(speed=0).D</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">))</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">)</span>

        <span class="c1"># x&#39; = Ax + Bu</span>
        <span class="n">B2</span> <span class="o">=</span> <span class="n">I</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frequency</span> <span class="o">=</span> <span class="n">speed</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">)</span>
        <span class="c1"># fmt: off</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">Z</span><span class="p">,</span>
                       <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="n">B2</span><span class="p">)])</span>
        <span class="c1"># fmt: on</span>

        <span class="c1"># y = Cx + Du</span>
        <span class="c1"># Observation matrices</span>
        <span class="n">Cd</span> <span class="o">=</span> <span class="n">I</span>
        <span class="n">Cv</span> <span class="o">=</span> <span class="n">Z</span>
        <span class="n">Ca</span> <span class="o">=</span> <span class="n">Z</span>

        <span class="c1"># fmt: off</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Cd</span> <span class="o">-</span> <span class="n">Ca</span> <span class="o">@</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">frequency</span><span class="p">)),</span> <span class="n">Cv</span> <span class="o">-</span> <span class="n">Ca</span> <span class="o">@</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">(</span><span class="n">frequency</span><span class="p">))))</span>
        <span class="c1"># fmt: on</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">Ca</span> <span class="o">@</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span> <span class="n">B2</span><span class="p">)</span>

        <span class="n">sys</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sys</span>

<div class="viewcode-block" id="Rotor.transfer_matrix"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.transfer_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the fer matrix for the frequency response function (FRF).</span>

<span class="sd">        Paramenters</span>
<span class="sd">        -----------</span>
<span class="sd">        frequency : float, optional</span>
<span class="sd">            Excitation frequency. Default is rotor speed.</span>
<span class="sd">        speed : float, optional</span>
<span class="sd">            Rotating speed. Default is rotor speed (frequency).</span>
<span class="sd">        modes : list, optional</span>
<span class="sd">            List with modes used to calculate the matrix.</span>
<span class="sd">            (all modes will be used if a list is not given).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        H : matrix</span>
<span class="sd">            System transfer matrix</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = 100.0</span>
<span class="sd">        &gt;&gt;&gt; H = rotor.transfer_matrix(speed=speed)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lti</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">lti</span><span class="o">.</span><span class="n">B</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">lti</span><span class="o">.</span><span class="n">C</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">lti</span><span class="o">.</span><span class="n">D</span>

        <span class="c1"># calculate eigenvalues and eigenvectors using la.eig to get</span>
        <span class="c1"># left and right eigenvectors.</span>

        <span class="n">evals</span><span class="p">,</span> <span class="n">psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigen</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">psi_inv</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span>  <span class="c1"># n dof -&gt; number of modes</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span>  <span class="c1"># -&gt; number of desired modes</span>
            <span class="c1"># idx to get each evalue/evector and its conjugate</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">modes</span>  <span class="c1"># modes</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">m</span><span class="p">:]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">)[</span><span class="o">-</span><span class="n">m</span><span class="p">:]</span>  <span class="c1"># conjugates (see how evalues are ordered)</span>
            <span class="n">evals</span> <span class="o">=</span> <span class="n">evals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">),</span> <span class="n">idx</span><span class="p">)]</span>
            <span class="n">psi_inv</span> <span class="o">=</span> <span class="n">psi_inv</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">))]</span>

        <span class="n">diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">-</span> <span class="n">lam</span><span class="p">)</span> <span class="k">for</span> <span class="n">lam</span> <span class="ow">in</span> <span class="n">evals</span><span class="p">])</span>

        <span class="n">H</span> <span class="o">=</span> <span class="n">C</span> <span class="o">@</span> <span class="n">psi</span> <span class="o">@</span> <span class="n">diag</span> <span class="o">@</span> <span class="n">psi_inv</span> <span class="o">@</span> <span class="n">B</span> <span class="o">+</span> <span class="n">D</span>

        <span class="k">return</span> <span class="n">H</span></div>

<div class="viewcode-block" id="Rotor.run_freq_response"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_freq_response.html#ross.Rotor.run_freq_response">[docs]</a>    <span class="k">def</span> <span class="nf">run_freq_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">speed_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cluster_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">num_modes</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">num_points</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Frequency response for a mdof system.</span>

<span class="sd">        This method returns the frequency response for a mdof system given a range of</span>
<span class="sd">        frequencies and the modes that will be used.</span>

<span class="sd">        Available plotting methods:</span>
<span class="sd">            .plot()</span>
<span class="sd">            .plot_magnitude()</span>
<span class="sd">            .plot_phase()</span>
<span class="sd">            .plot_polar_bode()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed_range : array, optional</span>
<span class="sd">            Array with the desired range of frequencies.</span>
<span class="sd">            Default is 0 to 1.5 x highest damped natural frequency.</span>
<span class="sd">        modes : list, optional</span>
<span class="sd">            Modes that will be used to calculate the frequency response</span>
<span class="sd">            (all modes will be used if a list is not given).</span>
<span class="sd">        cluster_points : bool, optional</span>
<span class="sd">            boolean to activate the automatic frequency spacing method. If True, the</span>
<span class="sd">            method uses _clustering_points() to create an speed_range.</span>
<span class="sd">            Default is False</span>
<span class="sd">        num_points : int, optional</span>
<span class="sd">            The number of points generated per critical speed.</span>
<span class="sd">            The method set the same number of points for slightly less and slightly</span>
<span class="sd">            higher than the natural circular frequency. It means there&#39;ll be num_points</span>
<span class="sd">            greater and num_points smaller than a given critical speed.</span>
<span class="sd">            num_points may be between 2 and 12. Anything above this range defaults</span>
<span class="sd">            to 10 and anything below this range defaults to 4.</span>
<span class="sd">            The default is 10.</span>
<span class="sd">        num_modes</span>
<span class="sd">            The number of eigenvalues and eigenvectors to be calculated using ARPACK.</span>
<span class="sd">            It also defines the range for the output array, since the method generates</span>
<span class="sd">            points only for the critical speed calculated by run_critical_speed().</span>
<span class="sd">            Default is 12.</span>
<span class="sd">        rtol : float, optional</span>
<span class="sd">            Tolerance (relative) for termination. Applied to scipy.optimize.newton to</span>
<span class="sd">            calculate the approximated critical speeds.</span>
<span class="sd">            Default is 0.005 (0.5%).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : object</span>
<span class="sd">            An instance of ForcedResponseResult class, which is used to post-process</span>
<span class="sd">            results. Attributes stored:</span>
<span class="sd">            freq_resp : array</span>
<span class="sd">                Array with the frequency response for each node for each pair</span>
<span class="sd">                input/output.</span>
<span class="sd">            speed_range : array</span>
<span class="sd">                Array with the frequencies.</span>
<span class="sd">            velc_resp : array</span>
<span class="sd">                Array with the velocity response for each node for each pair</span>
<span class="sd">                input/output.</span>
<span class="sd">            accl_resp : array</span>
<span class="sd">                Array with the acceleration response for each node for each pair</span>
<span class="sd">                input/output.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 1000, 101)</span>
<span class="sd">        &gt;&gt;&gt; response = rotor.run_freq_response(speed_range=speed)</span>

<span class="sd">        Return the response amplitude</span>
<span class="sd">        &gt;&gt;&gt; abs(response.freq_resp) # doctest: +ELLIPSIS</span>
<span class="sd">        array([[[1.00000000e-06, 1.00261725e-06, 1.01076952e-06, ...</span>

<span class="sd">        Return the response phase</span>
<span class="sd">        &gt;&gt;&gt; np.angle(response.freq_resp) # doctest: +ELLIPSIS</span>
<span class="sd">        array([[[...</span>

<span class="sd">        Using clustered points option.</span>
<span class="sd">        Set `cluster_points=True` and choose how many modes the method must search and</span>
<span class="sd">        how many points to add just before and after each critical speed.</span>

<span class="sd">        &gt;&gt;&gt; response = rotor.run_freq_response(cluster_points=True, num_points=5)</span>
<span class="sd">        &gt;&gt;&gt; response.speed_range.shape</span>
<span class="sd">        (61,)</span>

<span class="sd">        Selecting the disirable modes, if you want a reduced model:</span>
<span class="sd">        &gt;&gt;&gt; response = rotor.run_freq_response(speed_range=speed, modes=[0, 1, 2])</span>
<span class="sd">        &gt;&gt;&gt; abs(response.freq_resp) # doctest: +ELLIPSIS</span>
<span class="sd">        array([[[2.00154633e-07, 2.02422522e-07, 2.09522044e-07, ...</span>

<span class="sd">        Plotting frequency response function:</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot(inp=13, out=13)</span>

<span class="sd">        To plot velocity and acceleration responses, you must change amplitude_units</span>
<span class="sd">        from &quot;[length]/[force]&quot; units to &quot;[speed]/[force]&quot; or &quot;[acceleration]/[force]&quot;</span>
<span class="sd">        respectively</span>

<span class="sd">        Plotting velocity response</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot(inp=13, out=13, amplitude_units=&quot;m/s/N&quot;)</span>

<span class="sd">        Plotting acceleration response</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot(inp=13, out=13, amplitude_units=&quot;m/s**2/N&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">speed_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cluster_points</span><span class="p">:</span>
                <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">speed_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">modal</span><span class="o">.</span><span class="n">evalues</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">speed_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clustering_points</span><span class="p">(</span>
                    <span class="n">num_modes</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">rtol</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_frequency_array</span><span class="p">(</span><span class="n">speed_range</span><span class="p">)</span>

        <span class="n">freq_resp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">speed_range</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
        <span class="n">velc_resp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">speed_range</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
        <span class="n">accl_resp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">speed_range</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">speed_range</span><span class="p">):</span>
            <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer_matrix</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">)</span>
            <span class="n">freq_resp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span>
            <span class="n">velc_resp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">H</span>
            <span class="n">accl_resp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">speed</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">H</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">FrequencyResponseResults</span><span class="p">(</span>
            <span class="n">freq_resp</span><span class="o">=</span><span class="n">freq_resp</span><span class="p">,</span>
            <span class="n">velc_resp</span><span class="o">=</span><span class="n">velc_resp</span><span class="p">,</span>
            <span class="n">accl_resp</span><span class="o">=</span><span class="n">accl_resp</span><span class="p">,</span>
            <span class="n">speed_range</span><span class="o">=</span><span class="n">speed_range</span><span class="p">,</span>
            <span class="n">number_dof</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.run_forced_response"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_forced_response.html#ross.Rotor.run_forced_response">[docs]</a>    <span class="k">def</span> <span class="nf">run_forced_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">speed_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cluster_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">num_modes</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">num_points</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span>
        <span class="n">unbalance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Forced response for a mdof system.</span>

<span class="sd">        This method returns the unbalanced response for a mdof system</span>
<span class="sd">        given magnitude and phase of the unbalance, the node where it&#39;s</span>
<span class="sd">        applied and a frequency range.</span>

<span class="sd">        Available plotting methods:</span>
<span class="sd">            .plot()</span>
<span class="sd">            .plot_magnitude()</span>
<span class="sd">            .plot_phase()</span>
<span class="sd">            .plot_polar_bode()</span>
<span class="sd">            .plot_deflected_shape()</span>
<span class="sd">            .plot_bending_moment()</span>
<span class="sd">            .plot_deflected_shape_3d()</span>
<span class="sd">            .plot_deflected_shape_2d()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        force : list, array</span>
<span class="sd">            Unbalance force in each degree of freedom for each value in omega</span>
<span class="sd">        speed_range : list, array</span>
<span class="sd">            Array with the desired range of frequencies</span>
<span class="sd">        modes : list, optional</span>
<span class="sd">            Modes that will be used to calculate the frequency response</span>
<span class="sd">            (all modes will be used if a list is not given).</span>
<span class="sd">        unbalance : array, optional</span>
<span class="sd">            Array with the unbalance data (node, magnitude and phase) to be plotted</span>
<span class="sd">            with deflected shape. This argument is set only if running an unbalance</span>
<span class="sd">            response analysis.</span>
<span class="sd">            Default is None.</span>
<span class="sd">        cluster_points : bool, optional</span>
<span class="sd">            boolean to activate the automatic frequency spacing method. If True, the</span>
<span class="sd">            method uses _clustering_points() to create an speed_range.</span>
<span class="sd">            Default is False</span>
<span class="sd">        num_points : int, optional</span>
<span class="sd">            The number of points generated per critical speed.</span>
<span class="sd">            The method set the same number of points for slightly less and slightly</span>
<span class="sd">            higher than the natural circular frequency. It means there&#39;ll be num_points</span>
<span class="sd">            greater and num_points smaller than a given critical speed.</span>
<span class="sd">            num_points may be between 2 and 12. Anything above this range defaults</span>
<span class="sd">            to 10 and anything below this range defaults to 4.</span>
<span class="sd">            The default is 10.</span>
<span class="sd">        num_modes</span>
<span class="sd">            The number of eigenvalues and eigenvectors to be calculated using ARPACK.</span>
<span class="sd">            It also defines the range for the output array, since the method generates</span>
<span class="sd">            points only for the critical speed calculated by run_critical_speed().</span>
<span class="sd">            Default is 12.</span>
<span class="sd">        rtol : float, optional</span>
<span class="sd">            Tolerance (relative) for termination. Applied to scipy.optimize.newton to</span>
<span class="sd">            calculate the approximated critical speeds.</span>
<span class="sd">            Default is 0.005 (0.5%).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        forced_resp : object</span>
<span class="sd">            An instance of ForcedResponseResult class, which is used to post-process</span>
<span class="sd">            results. Attributes stored:</span>
<span class="sd">            forced_resp : array</span>
<span class="sd">                Array with the forced response for each node for each frequency.</span>
<span class="sd">            speed_range : array</span>
<span class="sd">                Array with the frequencies.</span>
<span class="sd">            velc_resp : array</span>
<span class="sd">                Array with the velocity response for each node for each frequency.</span>
<span class="sd">            accl_resp : array</span>
<span class="sd">                Array with the acceleration response for each node for each frequency.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 1000, 101)</span>
<span class="sd">        &gt;&gt;&gt; force = rotor._unbalance_force(3, 10.0, 0.0, speed)</span>
<span class="sd">        &gt;&gt;&gt; resp = rotor.run_forced_response(force=force, speed_range=speed)</span>
<span class="sd">        &gt;&gt;&gt; abs(resp.forced_resp) # doctest: +ELLIPSIS</span>
<span class="sd">        array([[0.00000000e+00, 5.06073311e-04, 2.10044826e-03, ...</span>

<span class="sd">        Using clustered points option.</span>
<span class="sd">        Set `cluster_points=True` and choose how many modes the method must search and</span>
<span class="sd">        how many points to add just before and after each critical speed.</span>

<span class="sd">        &gt;&gt;&gt; response = rotor.run_forced_response(</span>
<span class="sd">        ...     force=force, cluster_points=True, num_modes=12, num_points=5</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; response.speed_range.shape</span>
<span class="sd">        (61,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">speed_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cluster_points</span><span class="p">:</span>
                <span class="n">speed_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clustering_points</span><span class="p">(</span>
                    <span class="n">num_modes</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">rtol</span>
                <span class="p">)</span>

        <span class="n">freq_resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_response</span><span class="p">(</span>
            <span class="n">speed_range</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">cluster_points</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">rtol</span>
        <span class="p">)</span>

        <span class="n">forced_resp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_resp</span><span class="o">.</span><span class="n">speed_range</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span>
        <span class="p">)</span>
        <span class="n">velc_resp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_resp</span><span class="o">.</span><span class="n">speed_range</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
        <span class="n">accl_resp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_resp</span><span class="o">.</span><span class="n">speed_range</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq_resp</span><span class="o">.</span><span class="n">speed_range</span><span class="p">)):</span>
            <span class="n">forced_resp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_resp</span><span class="o">.</span><span class="n">freq_resp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">force</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">velc_resp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_resp</span><span class="o">.</span><span class="n">velc_resp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">force</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">accl_resp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_resp</span><span class="o">.</span><span class="n">accl_resp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">force</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>

        <span class="n">forced_resp</span> <span class="o">=</span> <span class="n">ForcedResponseResults</span><span class="p">(</span>
            <span class="n">rotor</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">forced_resp</span><span class="o">=</span><span class="n">forced_resp</span><span class="p">,</span>
            <span class="n">velc_resp</span><span class="o">=</span><span class="n">velc_resp</span><span class="p">,</span>
            <span class="n">accl_resp</span><span class="o">=</span><span class="n">accl_resp</span><span class="p">,</span>
            <span class="n">speed_range</span><span class="o">=</span><span class="n">speed_range</span><span class="p">,</span>
            <span class="n">unbalance</span><span class="o">=</span><span class="n">unbalance</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">forced_resp</span></div>

    <span class="k">def</span> <span class="nf">_unbalance_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">omega</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate unbalance forces.</span>

<span class="sd">        This is an auxiliary function the calculate unbalance forces. It takes the</span>
<span class="sd">        force magnitude and phase and generate an array with complex values of forces</span>
<span class="sd">        on each degree degree of freedom of the given node.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node : int</span>
<span class="sd">            Node where the unbalance is applied.</span>
<span class="sd">        magnitude : float</span>
<span class="sd">            Unbalance magnitude (kg.m)</span>
<span class="sd">        phase : float</span>
<span class="sd">            Unbalance phase (rad)</span>
<span class="sd">        omega : list, float</span>
<span class="sd">            Array with the desired range of frequencies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        F0 : list</span>
<span class="sd">            Unbalance force in each degree of freedom for each value in omega</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 1000, 101)</span>
<span class="sd">        &gt;&gt;&gt; rotor._unbalance_force(3, 10.0, 0.0, speed)[12] # doctest: +ELLIPSIS</span>
<span class="sd">        array([0.000e+00+0.j, 1.000e+03+0.j, 4.000e+03+0.j, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

        <span class="n">b0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">b0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">magnitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">b0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">magnitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
        <span class="c1"># b0[2] 1j*(Id - Ip)*beta*np.exp(1j*gamma)</span>

        <span class="n">n0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">*</span> <span class="n">node</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">n0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">omega</span><span class="p">):</span>
            <span class="n">F0</span><span class="p">[</span><span class="n">n0</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b0</span>

        <span class="k">return</span> <span class="n">F0</span>

<div class="viewcode-block" id="Rotor.run_unbalance_response"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_unbalance_response.html#ross.Rotor.run_unbalance_response">[docs]</a>    <span class="nd">@check_units</span>
    <span class="k">def</span> <span class="nf">run_unbalance_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node</span><span class="p">,</span>
        <span class="n">unbalance_magnitude</span><span class="p">,</span>
        <span class="n">unbalance_phase</span><span class="p">,</span>
        <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cluster_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">num_modes</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">num_points</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unbalanced response for a mdof system.</span>

<span class="sd">        This method returns the unbalanced response for a mdof system</span>
<span class="sd">        given magnitide and phase of the unbalance, the node where it&#39;s</span>
<span class="sd">        applied and a frequency range.</span>

<span class="sd">        Available plotting methods:</span>
<span class="sd">            .plot()</span>
<span class="sd">            .plot_magnitude()</span>
<span class="sd">            .plot_phase()</span>
<span class="sd">            .plot_polar_bode()</span>
<span class="sd">            .plot_deflected_shape()</span>
<span class="sd">            .plot_bending_moment()</span>
<span class="sd">            .plot_deflected_shape_3d()</span>
<span class="sd">            .plot_deflected_shape_2d()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node : list, int</span>
<span class="sd">            Node where the unbalance is applied.</span>
<span class="sd">        unbalance_magnitude : list, float, pint.Quantity</span>
<span class="sd">            Unbalance magnitude (kg.m).</span>
<span class="sd">        unbalance_phase : list, float, pint.Quantity</span>
<span class="sd">            Unbalance phase (rad).</span>
<span class="sd">        frequency : list, float, pint.Quantity</span>
<span class="sd">            Array with the desired range of frequencies (rad/s).</span>
<span class="sd">        modes : list, optional</span>
<span class="sd">            Modes that will be used to calculate the frequency response</span>
<span class="sd">            (all modes will be used if a list is not given).</span>
<span class="sd">        cluster_points : bool, optional</span>
<span class="sd">            boolean to activate the automatic frequency spacing method. If True, the</span>
<span class="sd">            method uses _clustering_points() to create an speed_range.</span>
<span class="sd">            Default is False</span>
<span class="sd">        num_points : int, optional</span>
<span class="sd">            The number of points generated per critical speed.</span>
<span class="sd">            The method set the same number of points for slightly less and slightly</span>
<span class="sd">            higher than the natural circular frequency. It means there&#39;ll be num_points</span>
<span class="sd">            greater and num_points smaller than a given critical speed.</span>
<span class="sd">            num_points may be between 2 and 12. Anything above this range defaults</span>
<span class="sd">            to 10 and anything below this range defaults to 4.</span>
<span class="sd">            The default is 10.</span>
<span class="sd">        num_modes</span>
<span class="sd">            The number of eigenvalues and eigenvectors to be calculated using ARPACK.</span>
<span class="sd">            It also defines the range for the output array, since the method generates</span>
<span class="sd">            points only for the critical speed calculated by run_critical_speed().</span>
<span class="sd">            Default is 12.</span>
<span class="sd">        rtol : float, optional</span>
<span class="sd">            Tolerance (relative) for termination. Applied to scipy.optimize.newton to</span>
<span class="sd">            calculate the approximated critical speeds.</span>
<span class="sd">            Default is 0.005 (0.5%).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        forced_response : object</span>
<span class="sd">            An instance of ForcedResponseResult class, which is used to post-process</span>
<span class="sd">            results. Attributes stored:</span>
<span class="sd">            forced_resp : array</span>
<span class="sd">                Array with the forced response for each node for each frequency.</span>
<span class="sd">            speed_range : array</span>
<span class="sd">                Array with the frequencies.</span>
<span class="sd">            velc_resp : array</span>
<span class="sd">                Array with the velocity response for each node for each frequency.</span>
<span class="sd">            accl_resp : array</span>
<span class="sd">                Array with the acceleration response for each node for each frequency.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 1000, 101)</span>
<span class="sd">        &gt;&gt;&gt; response = rotor.run_unbalance_response(node=3,</span>
<span class="sd">        ...                                         unbalance_magnitude=10.0,</span>
<span class="sd">        ...                                         unbalance_phase=0.0,</span>
<span class="sd">        ...                                         frequency=speed)</span>

<span class="sd">        Return the response amplitude</span>
<span class="sd">        &gt;&gt;&gt; abs(response.forced_resp) # doctest: +ELLIPSIS</span>
<span class="sd">        array([[0.00000000e+00, 5.06073311e-04, 2.10044826e-03, ...</span>

<span class="sd">        Return the response phase</span>
<span class="sd">        &gt;&gt;&gt; np.angle(response.forced_resp) # doctest: +ELLIPSIS</span>
<span class="sd">        array([[ 0.00000000e+00, ...</span>

<span class="sd">        Using clustered points option.</span>
<span class="sd">        Set `cluster_points=True` and choose how many modes the method must search and</span>
<span class="sd">        how many points to add just before and after each critical speed.</span>

<span class="sd">        &gt;&gt;&gt; response2 = rotor.run_unbalance_response(</span>
<span class="sd">        ...     node=3, unbalance_magnitude=0.01, unbalance_phase=0.0, cluster_points=True, num_points=5</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; response2.speed_range.shape</span>
<span class="sd">        (61,)</span>

<span class="sd">        plot unbalance response:</span>
<span class="sd">        &gt;&gt;&gt; probe_node = 3</span>
<span class="sd">        &gt;&gt;&gt; probe_angle = np.pi / 2</span>
<span class="sd">        &gt;&gt;&gt; probe_tag = &quot;my_probe&quot;  # optional</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot(probe=[(probe_node, probe_angle, probe_tag)])</span>

<span class="sd">        plot response for major or minor axis:</span>
<span class="sd">        &gt;&gt;&gt; probe_node = 3</span>
<span class="sd">        &gt;&gt;&gt; probe_angle = &quot;major&quot;   # for major axis</span>
<span class="sd">        &gt;&gt;&gt; # probe_angle = &quot;minor&quot; # for minor axis</span>
<span class="sd">        &gt;&gt;&gt; probe_tag = &quot;my_probe&quot;  # optional</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot(probe=[(probe_node, probe_angle, probe_tag)])</span>

<span class="sd">        To plot velocity and acceleration responses, you must change amplitude_units</span>
<span class="sd">        from &quot;[length]&quot; units to &quot;[length]/[time]&quot; or &quot;[length]/[time] ** 2&quot; respectively</span>
<span class="sd">        Plotting velocity response</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot(</span>
<span class="sd">        ...     probe=[(probe_node, probe_angle)],</span>
<span class="sd">        ...     amplitude_units=&quot;m/s&quot;</span>
<span class="sd">        ... )</span>

<span class="sd">        Plotting acceleration response</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot(</span>
<span class="sd">        ...     probe=[(probe_node, probe_angle)],</span>
<span class="sd">        ...     amplitude_units=&quot;m/s**2&quot;</span>
<span class="sd">        ... )</span>

<span class="sd">        Plotting deflected shape configuration</span>
<span class="sd">        Speed value must be in speed_range.</span>
<span class="sd">        &gt;&gt;&gt; value = 600</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot_deflected_shape(speed=value)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cluster_points</span><span class="p">:</span>
                <span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clustering_points</span><span class="p">(</span><span class="n">num_modes</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">rtol</span><span class="p">)</span>

        <span class="n">force</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ndof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequency</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">unbalance_magnitude</span><span class="p">,</span> <span class="n">unbalance_phase</span><span class="p">):</span>
                <span class="n">force</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unbalance_force</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unbalance_force</span><span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="n">unbalance_magnitude</span><span class="p">,</span> <span class="n">unbalance_phase</span><span class="p">,</span> <span class="n">frequency</span>
            <span class="p">)</span>

        <span class="c1"># fmt: off</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">unbalance_magnitude</span><span class="p">,</span> <span class="n">unbalance_phase</span><span class="p">))</span>
        <span class="n">forced_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_forced_response</span><span class="p">(</span>
            <span class="n">force</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">cluster_points</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">rtol</span><span class="p">,</span> <span class="n">ub</span>
        <span class="p">)</span>
        <span class="c1"># fmt: on</span>

        <span class="k">return</span> <span class="n">forced_response</span></div>

<div class="viewcode-block" id="Rotor.time_response"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.time_response">[docs]</a>    <span class="k">def</span> <span class="nf">time_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Time response for a rotor.</span>

<span class="sd">        This method returns the time response for a rotor</span>
<span class="sd">        given a force, time and initial conditions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        F : array</span>
<span class="sd">            Force array (needs to have the same length as time array).</span>
<span class="sd">        t : array</span>
<span class="sd">            Time array. (must have the same length than lti.B matrix)</span>
<span class="sd">        ic : array, optional</span>
<span class="sd">            The initial conditions on the state vector (zero by default).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        t : array</span>
<span class="sd">            Time values for the output.</span>
<span class="sd">        yout : array</span>
<span class="sd">            System response.</span>
<span class="sd">        xout : array</span>
<span class="sd">            Time evolution of the state vector.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = 0</span>
<span class="sd">        &gt;&gt;&gt; size = 28</span>
<span class="sd">        &gt;&gt;&gt; t = np.linspace(0, 5, size)</span>
<span class="sd">        &gt;&gt;&gt; F = np.ones((size, rotor.ndof))</span>
<span class="sd">        &gt;&gt;&gt; rotor.time_response(speed, F, t) # doctest: +ELLIPSIS</span>
<span class="sd">        (array([0.        , 0.18518519, 0.37037037, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lti</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">signal</span><span class="o">.</span><span class="n">lsim</span><span class="p">(</span><span class="n">lti</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">X0</span><span class="o">=</span><span class="n">ic</span><span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.plot_rotor"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.plot_rotor">[docs]</a>    <span class="k">def</span> <span class="nf">plot_rotor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">check_sld</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">length_units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot a rotor object.</span>

<span class="sd">        This function will take a rotor object and plot its elements representation</span>
<span class="sd">        using Plotly.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : int, optional</span>
<span class="sd">            Increment that will be used to plot nodes label.</span>
<span class="sd">        check_sld : bool</span>
<span class="sd">            If True, checks the slenderness ratio for each element.</span>
<span class="sd">            The shaft elements which has a slenderness ratio &lt; 1.6 will be displayed in</span>
<span class="sd">            yellow color.</span>
<span class="sd">        length_units : str, optional</span>
<span class="sd">            length units to length and diameter.</span>
<span class="sd">            Default is &#39;m&#39;.</span>
<span class="sd">        kwargs : optional</span>
<span class="sd">            Additional key word arguments can be passed to change the plot layout only</span>
<span class="sd">            (e.g. width=1000, height=800, ...).</span>
<span class="sd">            *See Plotly Python Figure Reference for more information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : plotly.graph_objects.Figure</span>
<span class="sd">            The figure object with the rotor representation.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; figure = rotor.plot_rotor()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SR</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">shaft</span><span class="o">.</span><span class="n">slenderness_ratio</span>
            <span class="k">for</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span>
            <span class="k">if</span> <span class="n">shaft</span><span class="o">.</span><span class="n">slenderness_ratio</span> <span class="o">&lt;</span> <span class="mf">1.6</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">check_sld</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SR</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;The beam elements &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">SR</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot; have slenderness ratio (G*A*L^2 / EI) of less than 1.6.&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; Results may not converge correctly&quot;</span>
                <span class="p">)</span>

        <span class="n">nodes_pos</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">length_units</span><span class="p">)</span><span class="o">.</span><span class="n">m</span>
        <span class="n">nodes_o_d</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_o_d</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">length_units</span><span class="p">)</span><span class="o">.</span><span class="n">m</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="c1"># plot shaft centerline</span>
        <span class="n">shaft_end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nodes_pos</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dashdot&quot;</span><span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># plot nodes icons</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_pos</span><span class="p">[::</span><span class="n">nodes</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes_pos</span><span class="p">[::</span><span class="n">nodes</span><span class="p">]):</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">))</span>
            <span class="n">x_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x_pos</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y_pos</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers+text&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                    <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#ffcc99&quot;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># plot shaft elements</span>
        <span class="k">for</span> <span class="n">sh_elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">sh_elm</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">sh_elm</span><span class="o">.</span><span class="n">_patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">check_sld</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">length_units</span><span class="p">)</span>

        <span class="n">mean_od</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">nodes_o_d</span><span class="p">)</span>
        <span class="c1"># plot disk elements</span>
        <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">disk</span><span class="o">.</span><span class="n">scale_factor</span> <span class="o">*</span> <span class="n">mean_od</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">],</span> <span class="n">nodes_o_d</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">disk</span><span class="o">.</span><span class="n">_patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

        <span class="c1"># plot bearings</span>
        <span class="k">for</span> <span class="n">bearing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">bearing</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">length_units</span><span class="p">)</span>
                <span class="o">.</span><span class="n">m</span>
            <span class="p">)</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">bearing</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">length_units</span><span class="p">)</span>
                <span class="o">.</span><span class="n">m</span>
            <span class="p">)</span>
            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">bearing</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;y_pos_sup&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">length_units</span><span class="p">)</span>
                <span class="o">.</span><span class="n">m</span>
            <span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">y_pos_sup</span><span class="p">)</span>
            <span class="n">bearing</span><span class="o">.</span><span class="n">_patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

        <span class="c1"># plot point mass</span>
        <span class="k">for</span> <span class="n">p_mass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">length_units</span><span class="p">)</span>
                <span class="o">.</span><span class="n">m</span>
            <span class="p">)</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">length_units</span><span class="p">)</span>
                <span class="o">.</span><span class="n">m</span>
            <span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">_patch</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
            <span class="n">title_text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Axial location (</span><span class="si">{</span><span class="n">length_units</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">],</span>
            <span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
            <span class="n">title_text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Shaft radius (</span><span class="si">{</span><span class="n">length_units</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">shaft_end</span><span class="p">],</span>
            <span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Rotor Model&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Rotor.run_campbell"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_campbell.html#ross.Rotor.run_campbell">[docs]</a>    <span class="k">def</span> <span class="nf">run_campbell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed_range</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">frequency_type</span><span class="o">=</span><span class="s2">&quot;wd&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the Campbell diagram.</span>

<span class="sd">        This function will calculate the damped natural frequencies</span>
<span class="sd">        for a speed range.</span>

<span class="sd">        Available plotting methods:</span>
<span class="sd">            .plot()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed_range : array</span>
<span class="sd">            Array with the speed range in rad/s.</span>
<span class="sd">        frequencies : int, optional</span>
<span class="sd">            Number of frequencies that will be calculated.</span>
<span class="sd">            Default is 6.</span>
<span class="sd">        frequency_type : str, optional</span>
<span class="sd">            Choose between displaying results related to the undamped natural</span>
<span class="sd">            frequencies (&quot;wn&quot;) or damped natural frequencies (&quot;wd&quot;).</span>
<span class="sd">            The default is &quot;wd&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : array</span>
<span class="sd">            Array with the damped natural frequencies, log dec and precessions</span>
<span class="sd">            corresponding to each speed of the speed_rad array.</span>
<span class="sd">            It will be returned if plot=False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor1 = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = np.linspace(0, 400, 101)</span>

<span class="sd">        Diagram with undamped natural frequencies</span>
<span class="sd">        &gt;&gt;&gt; camp = rotor1.run_campbell(speed, frequency_type=&quot;wn&quot;)</span>

<span class="sd">        Diagram with damped natural frequencies</span>
<span class="sd">        &gt;&gt;&gt; camp = rotor1.run_campbell(speed)</span>

<span class="sd">        Plotting Campbell Diagram</span>
<span class="sd">        &gt;&gt;&gt; fig = camp.plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># store in results [speeds(x axis), frequencies[0] or logdec[1] or</span>
        <span class="c1"># whirl[2](y axis), 3]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_frequency_array</span><span class="p">(</span><span class="n">speed_range</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">speed_range</span><span class="p">),</span> <span class="n">frequencies</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">speed_range</span><span class="p">):</span>
            <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">num_modes</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">frequencies</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">frequency_type</span> <span class="o">==</span> <span class="s2">&quot;wd&quot;</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wd</span><span class="p">[:</span><span class="n">frequencies</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">log_dec</span><span class="p">[:</span><span class="n">frequencies</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">whirl_values</span><span class="p">()[:</span><span class="n">frequencies</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span><span class="n">frequencies</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">log_dec</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span><span class="n">frequencies</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">whirl_values</span><span class="p">()[</span><span class="n">idx</span><span class="p">][:</span><span class="n">frequencies</span><span class="p">]</span>

            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[:</span><span class="n">frequencies</span><span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">CampbellResults</span><span class="p">(</span>
            <span class="n">speed_range</span><span class="o">=</span><span class="n">speed_range</span><span class="p">,</span>
            <span class="n">wd</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">log_dec</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">whirl_values</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.run_ucs"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_ucs.html#ross.Rotor.run_ucs">[docs]</a>    <span class="k">def</span> <span class="nf">run_ucs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">stiffness_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">num_modes</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">num</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">synchronous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run Undamped Critical Speeds analyzes.</span>

<span class="sd">        This method will run the undamped critical speed analyzes for a given range</span>
<span class="sd">        of stiffness values. If the range is not provided, the bearing</span>
<span class="sd">        stiffness at rated speed will be used to create a range.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stiffness_range : tuple, optional</span>
<span class="sd">            Tuple with (start, end) for stiffness range.</span>
<span class="sd">        num : int</span>
<span class="sd">            Number of steps in the range.</span>
<span class="sd">            Default is 20.</span>
<span class="sd">        num_modes : int, optional</span>
<span class="sd">            Number of modes to be calculated. This uses scipy.sparse.eigs method.</span>
<span class="sd">            Default is 16.</span>
<span class="sd">        synchronous : bool</span>
<span class="sd">            If True a synchronous analysis is carried out and the frequency of</span>
<span class="sd">            the first forward model will be equal to the speed.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stiffness_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">bearing</span><span class="o">.</span><span class="n">kxx</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                <span class="n">stiffness_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stiffness_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

        <span class="n">stiffness_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">*</span><span class="n">stiffness_range</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">)</span>
        <span class="n">rotor_wn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stiffness_log</span><span class="p">)))</span>

        <span class="n">bearings_elements</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># exclude the seals</span>
        <span class="k">for</span> <span class="n">bearing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bearing</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">):</span>
                <span class="n">bearings_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bearing</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stiffness_log</span><span class="p">):</span>
            <span class="n">bearings</span> <span class="o">=</span> <span class="p">[</span><span class="n">BearingElement</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearings_elements</span><span class="p">]</span>
            <span class="n">rotor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span> <span class="n">bearings</span><span class="p">)</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">synchronous</span><span class="p">:</span>

                <span class="k">def</span> <span class="nf">wn_diff</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                    <span class="sd">&quot;&quot;&quot;Function to evaluate difference between speed and</span>
<span class="sd">                    natural frequency for the first mode.&quot;&quot;&quot;</span>
                    <span class="n">modal</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">num_modes</span><span class="o">=</span><span class="n">num_modes</span><span class="p">)</span>
                    <span class="c1"># get first forward mode</span>
                    <span class="k">if</span> <span class="n">modal</span><span class="o">.</span><span class="n">whirl_direction</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Forward&quot;</span><span class="p">:</span>
                        <span class="n">wn0</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">wn0</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">return</span> <span class="n">wn0</span> <span class="o">-</span> <span class="n">x</span>

                <span class="n">speed</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="n">wn_diff</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">modal</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">num_modes</span><span class="o">=</span><span class="n">num_modes</span><span class="p">)</span>

            <span class="c1"># if sync, select only forward modes</span>
            <span class="k">if</span> <span class="n">synchronous</span><span class="p">:</span>
                <span class="n">rotor_wn</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span><span class="n">modal</span><span class="o">.</span><span class="n">whirl_direction</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Forward&quot;</span><span class="p">]</span>
            <span class="c1"># if not sync, with speed=0 whirl direction can be confusing, with</span>
            <span class="c1"># two close modes being forward or backward, so we select on mode in</span>
            <span class="c1"># each 2 modes.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rotor_wn</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">wn</span><span class="p">[</span>
                    <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="p">]</span>

        <span class="n">bearing0</span> <span class="o">=</span> <span class="n">bearings_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># calculate interception points</span>
        <span class="n">intersection_points</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># if bearing does not have constant coefficient, check intersection points</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rotor_wn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kxx&quot;</span><span class="p">,</span> <span class="s2">&quot;kyy&quot;</span><span class="p">]:</span>
                    <span class="n">x1</span> <span class="o">=</span> <span class="n">rotor_wn</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="n">stiffness_log</span>
                    <span class="n">x2</span> <span class="o">=</span> <span class="n">bearing0</span><span class="o">.</span><span class="n">frequency</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bearing0</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span><span class="o">.</span><span class="n">coefficient</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">intersection_points</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                        <span class="n">intersection_points</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="c1"># pass if x/y is empty</span>
                        <span class="k">pass</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">UCSResults</span><span class="p">(</span>
            <span class="n">stiffness_range</span><span class="p">,</span> <span class="n">stiffness_log</span><span class="p">,</span> <span class="n">rotor_wn</span><span class="p">,</span> <span class="n">bearing0</span><span class="p">,</span> <span class="n">intersection_points</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.run_level1"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_level1.html#ross.Rotor.run_level1">[docs]</a>    <span class="k">def</span> <span class="nf">run_level1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">stiffness_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot level 1 stability analysis.</span>

<span class="sd">        This method will plot the stability 1 analysis for a</span>
<span class="sd">        given stiffness range.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            Number of steps in the range.</span>
<span class="sd">            Default is 5.</span>
<span class="sd">        stiffness_range : tuple, optional</span>
<span class="sd">            Tuple with (start, end) for stiffness range.</span>
<span class="sd">            This will be used to create an evenly numbers spaced evenly on a log scale</span>
<span class="sd">            to create a better visualization (see np.logspace).</span>
<span class="sd">        kwargs : optional</span>
<span class="sd">            Additional key word arguments can be passed to change the plot layout only</span>
<span class="sd">            (e.g. width=1000, height=800, ...).</span>
<span class="sd">            *See Plotly Python Figure Reference for more information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : Plotly graph_objects.Figure()</span>
<span class="sd">            The figure object with the plot.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; i_d = 0</span>
<span class="sd">        &gt;&gt;&gt; o_d = 0.05</span>
<span class="sd">        &gt;&gt;&gt; n = 6</span>
<span class="sd">        &gt;&gt;&gt; L = [0.25 for _ in range(n)]</span>
<span class="sd">        &gt;&gt;&gt; shaft_elem = [</span>
<span class="sd">        ...     ShaftElement(</span>
<span class="sd">        ...         l, i_d, o_d, material=steel, shear_effects=True,</span>
<span class="sd">        ...         rotary_inertia=True, gyroscopic=True</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     for l in L</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; disk0 = DiskElement.from_geometry(</span>
<span class="sd">        ...     n=2, material=steel, width=0.07, i_d=0.05, o_d=0.28</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; disk1 = DiskElement.from_geometry(</span>
<span class="sd">        ...     n=4, material=steel, width=0.07, i_d=0.05, o_d=0.28</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; stfx = 1e6</span>
<span class="sd">        &gt;&gt;&gt; stfy = 0.8e6</span>
<span class="sd">        &gt;&gt;&gt; bearing0 = BearingElement(0, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">        &gt;&gt;&gt; bearing1 = BearingElement(6, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">        &gt;&gt;&gt; rotor = Rotor(shaft_elem, [disk0, disk1], [bearing0, bearing1], rated_w=0)</span>
<span class="sd">        &gt;&gt;&gt; level1 = rotor.run_level1(n=0, stiffness_range=(1e6, 1e11))</span>
<span class="sd">        &gt;&gt;&gt; fig = level1.plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stiffness_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">bearing</span><span class="o">.</span><span class="n">kxx</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                <span class="n">stiffness_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stiffness_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

        <span class="n">stiffness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">stiffness_range</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="n">log_dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stiffness</span><span class="p">))</span>

        <span class="c1"># set rotor speed to mcs</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span>
        <span class="n">modal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stiffness</span><span class="p">):</span>
            <span class="n">bearings</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">]</span>
            <span class="n">cross_coupling</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kxy</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span> <span class="n">kyx</span><span class="o">=-</span><span class="n">Q</span><span class="p">)</span>
            <span class="n">bearings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cross_coupling</span><span class="p">)</span>

            <span class="n">rotor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span> <span class="n">bearings</span><span class="p">)</span>

            <span class="n">modal</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">run_modal</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">)</span>
            <span class="n">non_backward</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">whirl_direction</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;Backward&quot;</span>
            <span class="n">log_dec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">log_dec</span><span class="p">[</span><span class="n">non_backward</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">Level1Results</span><span class="p">(</span><span class="n">stiffness</span><span class="p">,</span> <span class="n">log_dec</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.run_time_response"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_time_response.html#ross.Rotor.run_time_response">[docs]</a>    <span class="k">def</span> <span class="nf">run_time_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the time response.</span>

<span class="sd">        This function will take a rotor object and calculate its time response</span>
<span class="sd">        given a force and a time.</span>

<span class="sd">        Available plotting methods:</span>
<span class="sd">            .plot_1d()</span>
<span class="sd">            .plot_2d()</span>
<span class="sd">            .plot_3d()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed : float</span>
<span class="sd">            Rotor speed.</span>
<span class="sd">        F : array</span>
<span class="sd">            Force array (needs to have the same number of rows as time array).</span>
<span class="sd">            Each column corresponds to a dof and each row to a time.</span>
<span class="sd">        t : array</span>
<span class="sd">            Time array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : array</span>
<span class="sd">            Array containing the time array, the system response, and the</span>
<span class="sd">            time evolution of the state vector.</span>
<span class="sd">            It will be returned if plot=False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; speed = 500.0</span>
<span class="sd">        &gt;&gt;&gt; size = 1000</span>
<span class="sd">        &gt;&gt;&gt; node = 3</span>
<span class="sd">        &gt;&gt;&gt; probe1 = (3, 0)</span>
<span class="sd">        &gt;&gt;&gt; t = np.linspace(0, 10, size)</span>
<span class="sd">        &gt;&gt;&gt; F = np.zeros((size, rotor.ndof))</span>
<span class="sd">        &gt;&gt;&gt; F[:, 4 * node] = 10 * np.cos(2 * t)</span>
<span class="sd">        &gt;&gt;&gt; F[:, 4 * node + 1] = 10 * np.sin(2 * t)</span>
<span class="sd">        &gt;&gt;&gt; response = rotor.run_time_response(speed, F, t)</span>
<span class="sd">        &gt;&gt;&gt; dof = 13</span>
<span class="sd">        &gt;&gt;&gt; response.yout[:, dof] # doctest: +ELLIPSIS</span>
<span class="sd">        array([ 0.00000000e+00,  1.86686693e-07,  8.39130663e-07, ...</span>

<span class="sd">        # plot time response for a given probe:</span>
<span class="sd">        &gt;&gt;&gt; fig1 = response.plot_1d(probe=[probe1])</span>

<span class="sd">        # plot orbit response - plotting 2D nodal orbit:</span>
<span class="sd">        &gt;&gt;&gt; fig2 = response.plot_2d(node=node)</span>

<span class="sd">        # plot orbit response - plotting 3D orbits - full rotor model:</span>
<span class="sd">        &gt;&gt;&gt; fig3 = response.plot_3d()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t_</span><span class="p">,</span> <span class="n">yout</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_response</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">TimeResponseResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">yout</span><span class="p">,</span> <span class="n">xout</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.run_misalignment"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_misalignment.html#ross.Rotor.run_misalignment">[docs]</a>    <span class="k">def</span> <span class="nf">run_misalignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coupling</span><span class="o">=</span><span class="s2">&quot;flex&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the misalignment defect and generates the misalignment object on the back-end. There are two types of coupling, flexible (flex) and rigid, which have different entries. These entries are provided via **kwargs to the specific method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coupling : str</span>
<span class="sd">            Coupling type. The avaible types are: flex, by default; and rigid.</span>

<span class="sd">        **kwargs: dictionary</span>

<span class="sd">            In the case of coupling = &quot;flex&quot;, **kwargs receives:</span>
<span class="sd">                dt : float</span>
<span class="sd">                    Time step.</span>
<span class="sd">                tI : float</span>
<span class="sd">                    Initial time.</span>
<span class="sd">                tF : float</span>
<span class="sd">                    Final time.</span>
<span class="sd">                kd : float</span>
<span class="sd">                    Radial stiffness of flexible coupling.</span>
<span class="sd">                ks : float</span>
<span class="sd">                    Bending stiffness of flexible coupling.</span>
<span class="sd">                eCOUPx : float</span>
<span class="sd">                    Parallel misalignment offset between driving rotor and driven rotor along X direction.</span>
<span class="sd">                eCOUPy : float</span>
<span class="sd">                    Parallel misalignment offset between driving rotor and driven rotor along Y direction.</span>
<span class="sd">                misalignment_angle : float</span>
<span class="sd">                    Angular misalignment angle.</span>
<span class="sd">                TD : float</span>
<span class="sd">                    Driving torque.</span>
<span class="sd">                TL : float</span>
<span class="sd">                    Driven torque.</span>
<span class="sd">                n1 : float</span>
<span class="sd">                    Node where the misalignment is ocurring.</span>
<span class="sd">                speed : float</span>
<span class="sd">                    Operational speed of the machine.</span>
<span class="sd">                massunb : array</span>
<span class="sd">                    Array with the unbalance magnitude. The unit is kg.m.</span>
<span class="sd">                phaseunb : array</span>
<span class="sd">                    Array with the unbalance phase. The unit is rad.</span>
<span class="sd">                mis_type: string</span>
<span class="sd">                    String containing the misalignment type choosed. The avaible types are: parallel, by default; angular; combined.</span>
<span class="sd">                print_progress : bool</span>
<span class="sd">                    Set it True, to print the time iterations and the total time spent.</span>
<span class="sd">                    False by default.</span>

<span class="sd">            In the case of coupling = &quot;rigid&quot;, **kwargs receives:</span>
<span class="sd">                dt : float</span>
<span class="sd">                    Time step.</span>
<span class="sd">                tI : float</span>
<span class="sd">                    Initial time.</span>
<span class="sd">                tF : float</span>
<span class="sd">                    Final time.</span>
<span class="sd">                eCOUP : float</span>
<span class="sd">                    Parallel misalignment offset between driving rotor and driven rotor along X direction.</span>
<span class="sd">                TD : float</span>
<span class="sd">                    Driving torque.</span>
<span class="sd">                TL : float</span>
<span class="sd">                    Driven torque.</span>
<span class="sd">                n1 : float</span>
<span class="sd">                    Node where the misalignment is ocurring.</span>
<span class="sd">                speed : float</span>
<span class="sd">                    Operational speed of the machine.</span>
<span class="sd">                massunb : array</span>
<span class="sd">                    Array with the unbalance magnitude. The unit is kg.m.</span>
<span class="sd">                phaseunb : array</span>
<span class="sd">                    Array with the unbalance phase. The unit is rad.</span>
<span class="sd">                print_progress : bool</span>
<span class="sd">                    Set it True, to print the time iterations and the total time spent.</span>
<span class="sd">                    False by default.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ross.defects.misalignment import misalignment_flex_parallel_example</span>
<span class="sd">        &gt;&gt;&gt; probe1 = (14, 0)</span>
<span class="sd">        &gt;&gt;&gt; probe2 = (22, 0)</span>
<span class="sd">        &gt;&gt;&gt; response = misalignment_flex_parallel_example()</span>
<span class="sd">        &gt;&gt;&gt; results = response.run_time_response()</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot_dfft(probe=[probe1, probe2], range_freq=[0, 100], yaxis_type=&quot;log&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # fig.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">coupling</span> <span class="o">==</span> <span class="s2">&quot;flex&quot;</span> <span class="ow">or</span> <span class="n">coupling</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">defect</span> <span class="o">=</span> <span class="n">MisalignmentFlex</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">coupling</span> <span class="o">==</span> <span class="s2">&quot;rigid&quot;</span><span class="p">:</span>
            <span class="n">defect</span> <span class="o">=</span> <span class="n">MisalignmentRigid</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Check the choosed coupling type!&quot;</span><span class="p">)</span>

        <span class="n">defect</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defect</span></div>

<div class="viewcode-block" id="Rotor.run_rubbing"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_rubbing.html#ross.Rotor.run_rubbing">[docs]</a>    <span class="k">def</span> <span class="nf">run_rubbing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the rubbing defect and generates the rubbing object on the back-end.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs: dictionary</span>

<span class="sd">            **kwargs receives:</span>
<span class="sd">                dt : float</span>
<span class="sd">                    Time step.</span>
<span class="sd">                tI : float</span>
<span class="sd">                    Initial time.</span>
<span class="sd">                tF : float</span>
<span class="sd">                    Final time.</span>
<span class="sd">                deltaRUB : float</span>
<span class="sd">                    Distance between the housing and shaft surface.</span>
<span class="sd">                kRUB : float</span>
<span class="sd">                    Contact stiffness.</span>
<span class="sd">                cRUB : float</span>
<span class="sd">                    Contact damping.</span>
<span class="sd">                miRUB : float</span>
<span class="sd">                    Friction coefficient.</span>
<span class="sd">                posRUB : int</span>
<span class="sd">                    Node where the rubbing is ocurring.</span>
<span class="sd">                speed : float</span>
<span class="sd">                    Operational speed of the machine.</span>
<span class="sd">                massunb : array</span>
<span class="sd">                    Array with the unbalance magnitude. The unit is kg.m.</span>
<span class="sd">                phaseunb : array</span>
<span class="sd">                    Array with the unbalance phase. The unit is rad.</span>
<span class="sd">                torque : bool</span>
<span class="sd">                    Set it as True to consider the torque provided by the rubbing, by default False.</span>
<span class="sd">                print_progress : bool</span>
<span class="sd">                    Set it True, to print the time iterations and the total time spent, by default False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ross.defects.rubbing import rubbing_example</span>
<span class="sd">        &gt;&gt;&gt; probe1 = (14, 0)</span>
<span class="sd">        &gt;&gt;&gt; probe2 = (22, 0)</span>
<span class="sd">        &gt;&gt;&gt; response = rubbing_example()</span>
<span class="sd">        &gt;&gt;&gt; results = response.run_time_response()</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot_dfft(probe=[probe1, probe2], range_freq=[0, 100], yaxis_type=&quot;log&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # fig.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defect</span> <span class="o">=</span> <span class="n">Rubbing</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">defect</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defect</span></div>

<div class="viewcode-block" id="Rotor.run_crack"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_crack.html#ross.Rotor.run_crack">[docs]</a>    <span class="k">def</span> <span class="nf">run_crack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the crack defect and generates the crack object on the back-end.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs: dictionary</span>

<span class="sd">            **kwargs receives:</span>
<span class="sd">                dt : float</span>
<span class="sd">                    Time step</span>
<span class="sd">                tI : float</span>
<span class="sd">                    Initial time</span>
<span class="sd">                tF : float</span>
<span class="sd">                    Final time</span>
<span class="sd">                cd : float</span>
<span class="sd">                    Crack depth</span>
<span class="sd">                n_crack : float</span>
<span class="sd">                    Element where the crack is located</span>
<span class="sd">                speed : float</span>
<span class="sd">                    Operational speed of the machine</span>
<span class="sd">                massunb : array</span>
<span class="sd">                    Array with the unbalance magnitude. The unit is kg.m.</span>
<span class="sd">                phaseunb : array</span>
<span class="sd">                    Array with the unbalance phase. The unit is rad.</span>
<span class="sd">                crack_type : string</span>
<span class="sd">                    String containing type of crack model chosed. The avaible types are: Mayes and Gasch.</span>
<span class="sd">                print_progress : bool</span>
<span class="sd">                    Set it True, to print the time iterations and the total time spent, by default False.</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ross.defects.crack import crack_example</span>
<span class="sd">        &gt;&gt;&gt; probe1 = (14, 0)</span>
<span class="sd">        &gt;&gt;&gt; probe2 = (22, 0)</span>
<span class="sd">        &gt;&gt;&gt; response = crack_example()</span>
<span class="sd">        &gt;&gt;&gt; results = response.run_time_response()</span>
<span class="sd">        &gt;&gt;&gt; fig = response.plot_dfft(probe=[probe1, probe2], range_freq=[0, 100], yaxis_type=&quot;log&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # fig.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defect</span> <span class="o">=</span> <span class="n">Crack</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">defect</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defect</span></div>

<div class="viewcode-block" id="Rotor.save_mat"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.save_mat">[docs]</a>    <span class="k">def</span> <span class="nf">save_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save matrices and rotor model to a .mat file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str, pathlib.Path</span>

<span class="sd">        speed: float</span>
<span class="sd">            Rotor speed.</span>
<span class="sd">        frequency: float, optional</span>
<span class="sd">            Excitation frequency.</span>
<span class="sd">            Default is rotor speed.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from tempfile import tempdir</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; # create path for temporary file</span>
<span class="sd">        &gt;&gt;&gt; file = Path(tempdir) / &#39;new_matrices&#39;</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.save_mat(file, speed=0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frequency</span> <span class="o">=</span> <span class="n">speed</span>

        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">(),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">frequency</span><span class="p">),</span>
            <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">(</span><span class="n">frequency</span><span class="p">),</span>
            <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">(),</span>
            <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">sio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dic</span><span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.save"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the rotor to a .toml file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str or pathlib.Path</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from tempfile import tempdir</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; # create path for temporary file</span>
<span class="sd">        &gt;&gt;&gt; file = Path(tempdir) / &#39;rotor.toml&#39;</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor.save(file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">toml</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">},</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.load"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.load">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load rotor from toml file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str or pathlib.Path</span>
<span class="sd">            String or Path for a .toml file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rotor : ross.rotor.Rotor</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; from tempfile import tempdir</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; # create path for temporary file</span>
<span class="sd">        &gt;&gt;&gt; file = Path(tempdir) / &#39;new_rotor1.toml&#39;</span>
<span class="sd">        &gt;&gt;&gt; rotor1 = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; rotor1.save(file)</span>
<span class="sd">        &gt;&gt;&gt; rotor2 = Rotor.load(file)</span>
<span class="sd">        &gt;&gt;&gt; rotor1 == rotor2</span>
<span class="sd">        True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el_name</span><span class="p">,</span> <span class="n">el_data</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">el_name</span> <span class="o">==</span> <span class="s2">&quot;parameters&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">el_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">class_name</span><span class="p">]</span><span class="o">.</span><span class="n">read_toml_data</span><span class="p">(</span><span class="n">el_data</span><span class="p">))</span>

        <span class="n">shaft_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">disk_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bearing_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">point_mass_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">ShaftElement</span><span class="p">):</span>
                <span class="n">shaft_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">DiskElement</span><span class="p">):</span>
                <span class="n">disk_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">BearingElement</span><span class="p">):</span>
                <span class="n">bearing_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">PointMass</span><span class="p">):</span>
                <span class="n">point_mass_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">shaft_elements</span><span class="o">=</span><span class="n">shaft_elements</span><span class="p">,</span>
            <span class="n">disk_elements</span><span class="o">=</span><span class="n">disk_elements</span><span class="p">,</span>
            <span class="n">bearing_elements</span><span class="o">=</span><span class="n">bearing_elements</span><span class="p">,</span>
            <span class="n">point_mass_elements</span><span class="o">=</span><span class="n">point_mass_elements</span><span class="p">,</span>
            <span class="o">**</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Rotor.run_static"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.run_static.html#ross.Rotor.run_static">[docs]</a>    <span class="k">def</span> <span class="nf">run_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run static analysis.</span>

<span class="sd">        Static analysis calculates free-body diagram, deformed shaft, shearing</span>
<span class="sd">        force diagram and bending moment diagram.</span>

<span class="sd">        Available plotting methods:</span>
<span class="sd">            .plot_deformation()</span>
<span class="sd">            .plot_bending_moment()</span>
<span class="sd">            .plot_shearing_force()</span>
<span class="sd">            .plot_free_body_diagram()</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        shaft_weight: float</span>
<span class="sd">            Shaft total weight</span>
<span class="sd">        disk_forces_nodal : dict</span>
<span class="sd">            Relates the static force at each node due to the weight of disks</span>
<span class="sd">        bearing_forces_nodal : dict</span>
<span class="sd">            Relates the static force at each node due to the bearing reaction forces.</span>
<span class="sd">        bearing_forces_tag : dict</span>
<span class="sd">            Indicates the reaction force exerted by each bearing.</span>
<span class="sd">        disk_forces_tag : dict</span>
<span class="sd">            Indicates the force exerted by each disk.</span>
<span class="sd">        disp_y: array</span>
<span class="sd">            The shaft static displacement vector,</span>
<span class="sd">        Vx: array</span>
<span class="sd">            Shearing force vector</span>
<span class="sd">        Bm: array</span>
<span class="sd">            Bending moment vector</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results: object</span>
<span class="sd">            An instance of StaticResult class, which is used to create plots.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Error raised if the rotor has no bearing elements.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ross as rs</span>
<span class="sd">        &gt;&gt;&gt; rotor = rs.rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; static = rotor.run_static()</span>
<span class="sd">        &gt;&gt;&gt; rotor.bearing_forces_nodal</span>
<span class="sd">        {&#39;node_0&#39;: 432.4, &#39;node_6&#39;: 432.4}</span>
<span class="sd">        &gt;&gt;&gt; rotor.bearing_forces_tag</span>
<span class="sd">        {&#39;Bearing 0&#39;: 432.4, &#39;Bearing 1&#39;: 432.4}</span>

<span class="sd">        Plotting static deformation</span>
<span class="sd">        &gt;&gt;&gt; fig = static.plot_deformation()</span>

<span class="sd">        Plotting bending moment</span>
<span class="sd">        &gt;&gt;&gt; fig = static.plot_bending_moment()</span>

<span class="sd">        Plotting shearing force</span>
<span class="sd">        &gt;&gt;&gt; fig = static.plot_shearing_force()</span>

<span class="sd">        Plotting free-body diagram</span>
<span class="sd">        &gt;&gt;&gt; fig = static.plot_free_body_diagram()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Rotor has no bearings&quot;</span><span class="p">)</span>

        <span class="n">aux_brg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="n">aux_brg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">BearingElement</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">n_link</span><span class="o">=</span><span class="n">elm</span><span class="o">.</span><span class="n">n_link</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="mf">1e14</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aux_brg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BearingElement</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="mf">1e14</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CoAxialRotor</span><span class="p">):</span>
            <span class="n">aux_rotor</span> <span class="o">=</span> <span class="n">CoAxialRotor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shafts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span> <span class="n">aux_brg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aux_rotor</span> <span class="o">=</span> <span class="n">Rotor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span> <span class="n">aux_brg</span><span class="p">)</span>

        <span class="n">aux_K</span> <span class="o">=</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">):</span>
                <span class="n">dofs</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">aux_K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">-=</span> <span class="n">elm</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">aux_K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">)]</span> <span class="o">-=</span> <span class="n">elm</span><span class="o">.</span><span class="n">K</span><span class="p">()</span>

        <span class="n">df_num</span> <span class="o">=</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">sh_num</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_num</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># gravity aceleration vector</span>
        <span class="n">g</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.8065</span>
        <span class="n">grav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux_rotor</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">grav</span><span class="p">[</span><span class="mi">1</span> <span class="p">::</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span>

        <span class="c1"># calculates u, for [K]*(u) = (F)</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="p">(</span><span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">aux_K</span><span class="p">,</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">M</span><span class="p">()</span> <span class="o">@</span> <span class="n">grav</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># calculates displacement values in gravity&#39;s direction</span>
        <span class="n">shafts_disp_y</span> <span class="o">=</span> <span class="n">disp</span><span class="p">[</span><span class="mi">1</span> <span class="p">::</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span><span class="p">]</span>

        <span class="n">disp_y</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># calculate forces</span>
        <span class="n">nodal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">@</span> <span class="n">disp</span>

        <span class="n">Vx_axis</span><span class="p">,</span> <span class="n">Vx</span><span class="p">,</span> <span class="n">Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">nodes</span><span class="p">,</span> <span class="n">nodes_pos</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">BrgForce_nodal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">DskForce_nodal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">BrgForce_tag</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">DskForce_tag</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sh_num</span><span class="p">:</span>
            <span class="c1"># get indexes for each shaft in the model</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">shaft_number</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;_n&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="n">n_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">shaft_number</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;n_l&quot;</span><span class="p">])</span>
            <span class="n">n_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">shaft_number</span> <span class="o">==</span> <span class="n">i</span><span class="p">),</span> <span class="s2">&quot;n_r&quot;</span><span class="p">])</span>
            <span class="n">nodes_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">n_min</span> <span class="p">:</span> <span class="n">n_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_min</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>

            <span class="n">elm_weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">nodal_shaft_weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

            <span class="c1"># displacements for a single shaft</span>
            <span class="n">shafts_disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">[</span><span class="n">n_min</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="p">:</span> <span class="p">(</span><span class="n">n_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span><span class="p">]</span>
            <span class="n">disp_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shafts_disp</span><span class="p">[</span><span class="mi">1</span> <span class="p">::</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span><span class="p">])</span>

            <span class="n">aux_Vx_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">elm_weight</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">)[</span><span class="n">index</span><span class="p">]:</span>
                <span class="n">aux_Vx_axis</span><span class="p">[</span><span class="n">sh</span><span class="o">.</span><span class="n">n_l</span> <span class="o">-</span> <span class="n">n_min</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">sh</span><span class="o">.</span><span class="n">n_l</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">[</span><span class="n">sh</span><span class="o">.</span><span class="n">n_r</span><span class="p">],</span>
                <span class="p">]</span>
                <span class="n">elm_weight</span><span class="p">[</span><span class="n">sh</span><span class="o">.</span><span class="n">n_l</span> <span class="o">-</span> <span class="n">n_min</span><span class="p">]</span> <span class="o">+=</span> <span class="n">g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">sh</span><span class="o">.</span><span class="n">m</span><span class="p">])</span>

                <span class="n">nodal_shaft_weight</span><span class="p">[</span><span class="n">sh</span><span class="o">.</span><span class="n">n_r</span> <span class="o">-</span> <span class="n">n_min</span><span class="p">]</span> <span class="o">+=</span> <span class="n">g</span> <span class="o">*</span> <span class="n">sh</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">/</span> <span class="n">sh</span><span class="o">.</span><span class="n">L</span>
                <span class="n">nodal_shaft_weight</span><span class="p">[</span><span class="n">sh</span><span class="o">.</span><span class="n">n_l</span> <span class="o">-</span> <span class="n">n_min</span><span class="p">]</span> <span class="o">+=</span> <span class="n">g</span> <span class="o">*</span> <span class="n">sh</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">/</span> <span class="n">sh</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>

            <span class="n">elm_weight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">aux_nodal_forces</span> <span class="o">=</span> <span class="n">nodal_forces</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">*</span> <span class="n">n_min</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">nodal_forces_y</span> <span class="o">=</span> <span class="n">aux_nodal_forces</span><span class="p">[</span><span class="mi">1</span> <span class="p">::</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodal_shaft_weight</span>
            <span class="n">elm_forces_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">elm_weight</span><span class="p">)</span>
            <span class="n">elm_forces_y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodal_forces_y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">elm_forces_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">nodal_forces_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">elm_forces_y</span> <span class="o">+=</span> <span class="n">elm_weight</span>

            <span class="c1"># locate and collect bearing and disk forces</span>
            <span class="n">aux_df</span> <span class="o">=</span> <span class="n">aux_rotor</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">(</span><span class="n">aux_rotor</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ShaftElement&quot;</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">aux_rotor</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">aux_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">n_max</span><span class="p">:</span>
                    <span class="n">force</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">elm_forces_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">force</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">elm_forces_y</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">n_min</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DiskElement&quot;</span><span class="p">:</span>
                    <span class="n">DskForce_nodal</span><span class="p">[</span><span class="s2">&quot;node_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]))]</span> <span class="o">=</span> <span class="n">force</span>
                    <span class="n">DskForce_tag</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">force</span>
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">:</span>
                    <span class="n">BrgForce_nodal</span><span class="p">[</span><span class="s2">&quot;node_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]))]</span> <span class="o">=</span> <span class="n">force</span>
                    <span class="n">BrgForce_tag</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">force</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;n_link&quot;</span><span class="p">]):</span>
                        <span class="n">BrgForce_nodal</span><span class="p">[</span><span class="s2">&quot;node_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;n_link&quot;</span><span class="p">]))]</span> <span class="o">=</span> <span class="o">-</span><span class="n">force</span>

            <span class="c1"># Calculate shearing force</span>
            <span class="c1"># Each line represents an element, each column a station from the element</span>
            <span class="n">aux_Vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">elm_weight</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">aux_Vx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">elm_forces_y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elm_forces_y</span><span class="p">[</span><span class="n">j</span><span class="p">])]</span>
                <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="n">aux_Vx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">elm_forces_y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">elm_forces_y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">elm_forces_y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">elm_forces_y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">aux_Vx</span> <span class="o">=</span> <span class="o">-</span><span class="n">aux_Vx</span>

            <span class="c1"># Calculate bending moment</span>
            <span class="c1"># Each line represents an element, each column a station from the element</span>
            <span class="n">aux_Mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">aux_Vx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">aux_Mx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">aux_Mx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">aux_Vx_axis</span><span class="p">[</span><span class="n">j</span><span class="p">])]</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">aux_Mx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">aux_Mx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">aux_Vx_axis</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">aux_Mx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux_Mx</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">aux_Mx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux_Mx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">aux_Vx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
                        <span class="n">aux_Vx_axis</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="p">)</span>

            <span class="c1"># flattening arrays</span>
            <span class="n">aux_Vx</span> <span class="o">=</span> <span class="n">aux_Vx</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">aux_Vx_axis</span> <span class="o">=</span> <span class="n">aux_Vx_axis</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">aux_Mx</span> <span class="o">=</span> <span class="n">aux_Mx</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="n">Vx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_Vx</span><span class="p">)</span>
            <span class="n">Vx_axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_Vx_axis</span><span class="p">)</span>
            <span class="n">Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_Mx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">disk_forces_nodal</span> <span class="o">=</span> <span class="n">DskForce_nodal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing_forces_nodal</span> <span class="o">=</span> <span class="n">BrgForce_nodal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing_forces_tag</span> <span class="o">=</span> <span class="n">BrgForce_tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_forces_tag</span> <span class="o">=</span> <span class="n">DskForce_tag</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">w_shaft</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">shaft_number</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">g</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sh_num</span>
        <span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">StaticResults</span><span class="p">(</span>
            <span class="n">disp_y</span><span class="p">,</span>
            <span class="n">Vx</span><span class="p">,</span>
            <span class="n">Mx</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_shaft</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disk_forces_nodal</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_forces_nodal</span><span class="p">,</span>
            <span class="n">nodes</span><span class="p">,</span>
            <span class="n">nodes_pos</span><span class="p">,</span>
            <span class="n">Vx_axis</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.summary"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the rotor summary.</span>

<span class="sd">        This functioncreates a summary of the main parameters and attributes of the</span>
<span class="sd">        rotor model. The data is presented in a table format.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : ross.SummaryResults class</span>
<span class="sd">            An instance of SumarryResults class to build the summary table</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">        &gt;&gt;&gt; table = rotor.summary().plot()</span>
<span class="sd">        &gt;&gt;&gt; # to display the plot use the command:</span>
<span class="sd">        &gt;&gt;&gt; # show(table)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_static</span><span class="p">()</span>
        <span class="n">forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_forces_tag</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">SummaryResults</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">,</span>
            <span class="n">forces</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CG</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Rotor.from_section"><a class="viewcode-back" href="../../generated/rotor/ross.Rotor.html#ross.Rotor.from_section">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_section</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">leng_data</span><span class="p">,</span>
        <span class="n">idl_data</span><span class="p">,</span>
        <span class="n">odl_data</span><span class="p">,</span>
        <span class="n">idr_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">odr_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">material_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">disk_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">brg_seal_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">min_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rated_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nel_r</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build rotor from sections.</span>

<span class="sd">        This class is an alternative to build rotors from separated</span>
<span class="sd">        sections. Each section has the same number (n) of shaft elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        leng_data : list</span>
<span class="sd">            List with the lengths of rotor regions.</span>
<span class="sd">        idl_data : list</span>
<span class="sd">            List with the inner diameters of rotor regions (Left Station).</span>
<span class="sd">        odl_data : list</span>
<span class="sd">            List with the outer diameters of rotor regions (Left Station).</span>
<span class="sd">        idr_data : list, optional</span>
<span class="sd">            List with the inner diameters of rotor regions (Right Station).</span>
<span class="sd">            Default is equal to idl_data (cylindrical element).</span>
<span class="sd">        odr_data : list, optional</span>
<span class="sd">            List with the outer diameters of rotor regions (Right Station).</span>
<span class="sd">            Default is equal to odl_data (cylindrical element).</span>
<span class="sd">        material_data : ross.material or list of ross.material</span>
<span class="sd">            Defines a single material for all sections or each section can be</span>
<span class="sd">            defined by a material individually.</span>
<span class="sd">        disk_data : dict, optional</span>
<span class="sd">            Dict holding disks datas.</span>
<span class="sd">            Example : disk_data=DiskElement.from_geometry(n=2,</span>
<span class="sd">                                                          material=steel,</span>
<span class="sd">                                                          width=0.07,</span>
<span class="sd">                                                          i_d=0,</span>
<span class="sd">                                                          o_d=0.28</span>
<span class="sd">                                                          )</span>
<span class="sd">            ***See &#39;disk_element.py&#39; docstring for more information***</span>
<span class="sd">        brg_seal_data : dict, optional</span>
<span class="sd">            Dict holding lists of bearings and seals datas.</span>
<span class="sd">            Example : brg_seal_data=BearingElement(n=1, kxx=1e6, cxx=0,</span>
<span class="sd">                                                   kyy=1e6, cyy=0, kxy=0,</span>
<span class="sd">                                                   cxy=0, kyx=0, cyx=0)</span>
<span class="sd">            ***See &#39;bearing_seal_element.py&#39; docstring for more information***</span>
<span class="sd">        nel_r : int, optional</span>
<span class="sd">            Number or elements per shaft region.</span>
<span class="sd">            Default is 1.</span>
<span class="sd">        tag : str</span>
<span class="sd">            A tag for the rotor</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Error raised if lists size do not match.</span>
<span class="sd">        AttributeError</span>
<span class="sd">            Error raised if the shaft material is not defined.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A rotor object</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; from ross.materials import steel</span>
<span class="sd">        &gt;&gt;&gt; rotor = Rotor.from_section(leng_data=[0.5,0.5,0.5],</span>
<span class="sd">        ...             odl_data=[0.05,0.05,0.05],</span>
<span class="sd">        ...             idl_data=[0,0,0],</span>
<span class="sd">        ...             material_data=steel,</span>
<span class="sd">        ...             disk_data=[DiskElement.from_geometry(n=1, material=steel, width=0.07, i_d=0, o_d=0.28),</span>
<span class="sd">        ...                        DiskElement.from_geometry(n=2, material=steel, width=0.07, i_d=0, o_d=0.35)],</span>
<span class="sd">        ...             brg_seal_data=[BearingElement(n=0, kxx=1e6, cxx=0, kyy=1e6, cyy=0, kxy=0, cxy=0, kyx=0, cyx=0),</span>
<span class="sd">        ...                            BearingElement(n=3, kxx=1e6, cxx=0, kyy=1e6, cyy=0, kxy=0, cxy=0, kyx=0, cyx=0)],</span>
<span class="sd">        ...             nel_r=1)</span>
<span class="sd">        &gt;&gt;&gt; modal = rotor.run_modal(speed=0)</span>
<span class="sd">        &gt;&gt;&gt; modal.wn.round(4)</span>
<span class="sd">        array([ 85.7634,  85.7634, 271.9326, 271.9326, 718.58  , 718.58  ])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">odl_data</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idl_data</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The lists size do not match (leng_data, odl_data and idl_data).&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">material_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Please define a material or a list of materials&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">idr_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idr_data</span> <span class="o">=</span> <span class="n">idl_data</span>
        <span class="k">if</span> <span class="n">odr_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">odr_data</span> <span class="o">=</span> <span class="n">odl_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">odr_data</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idr_data</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The lists size do not match (leng_data, odr_data and idr_data).&quot;</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rotor_regions</span><span class="p">(</span><span class="n">nel_r</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Subroutine to discretize each rotor region into n elements.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            nel_r : int</span>
<span class="sd">                Number of elements per region</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            regions : list</span>
<span class="sd">                List with elements</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">shaft_elements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">disk_elements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bearing_elements</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leng_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">material_data</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                        <span class="s2">&quot;material_data size does not match size of other lists&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># loop through rotor regions</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">leng</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leng_data</span><span class="p">):</span>
                    <span class="n">le</span> <span class="o">=</span> <span class="n">leng</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nel_r</span><span class="p">):</span>
                        <span class="n">idl</span> <span class="o">=</span> <span class="p">(</span><span class="n">idr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">odl</span> <span class="o">=</span> <span class="p">(</span><span class="n">odr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">idr</span> <span class="o">=</span> <span class="p">(</span><span class="n">idr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">odr</span> <span class="o">=</span> <span class="p">(</span><span class="n">odr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">shaft_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ShaftElement</span><span class="p">(</span>
                                <span class="n">le</span><span class="p">,</span>
                                <span class="n">idl</span><span class="p">,</span>
                                <span class="n">odl</span><span class="p">,</span>
                                <span class="n">idr</span><span class="p">,</span>
                                <span class="n">odr</span><span class="p">,</span>
                                <span class="n">material</span><span class="o">=</span><span class="n">material_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">shear_effects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">rotary_inertia</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">gyroscopic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">leng</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leng_data</span><span class="p">):</span>
                    <span class="n">le</span> <span class="o">=</span> <span class="n">leng</span> <span class="o">/</span> <span class="n">nel_r</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nel_r</span><span class="p">):</span>
                        <span class="n">idl</span> <span class="o">=</span> <span class="p">(</span><span class="n">idr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">odl</span> <span class="o">=</span> <span class="p">(</span><span class="n">odr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">idr</span> <span class="o">=</span> <span class="p">(</span><span class="n">idr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">idl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">odr</span> <span class="o">=</span> <span class="p">(</span><span class="n">odr_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">le</span> <span class="o">/</span> <span class="n">leng</span> <span class="o">+</span> <span class="n">odl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">shaft_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ShaftElement</span><span class="p">(</span>
                                <span class="n">le</span><span class="p">,</span>
                                <span class="n">idl</span><span class="p">,</span>
                                <span class="n">odl</span><span class="p">,</span>
                                <span class="n">idr</span><span class="p">,</span>
                                <span class="n">odr</span><span class="p">,</span>
                                <span class="n">material</span><span class="o">=</span><span class="n">material_data</span><span class="p">,</span>
                                <span class="n">shear_effects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">rotary_inertia</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">gyroscopic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

            <span class="n">regions</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">shaft_elements</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">DiskEl</span> <span class="ow">in</span> <span class="n">disk_data</span><span class="p">:</span>
                <span class="n">aux_DiskEl</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">DiskEl</span><span class="p">)</span>
                <span class="n">aux_DiskEl</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">DiskEl</span><span class="o">.</span><span class="n">n</span>
                <span class="n">aux_DiskEl</span><span class="o">.</span><span class="n">n_l</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">DiskEl</span><span class="o">.</span><span class="n">n_l</span>
                <span class="n">aux_DiskEl</span><span class="o">.</span><span class="n">n_r</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">DiskEl</span><span class="o">.</span><span class="n">n_r</span>
                <span class="n">disk_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_DiskEl</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">Brg_SealEl</span> <span class="ow">in</span> <span class="n">brg_seal_data</span><span class="p">:</span>
                <span class="n">aux_Brg_SealEl</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">Brg_SealEl</span><span class="p">)</span>
                <span class="n">aux_Brg_SealEl</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">Brg_SealEl</span><span class="o">.</span><span class="n">n</span>
                <span class="n">aux_Brg_SealEl</span><span class="o">.</span><span class="n">n_l</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">Brg_SealEl</span><span class="o">.</span><span class="n">n_l</span>
                <span class="n">aux_Brg_SealEl</span><span class="o">.</span><span class="n">n_r</span> <span class="o">=</span> <span class="n">nel_r</span> <span class="o">*</span> <span class="n">Brg_SealEl</span><span class="o">.</span><span class="n">n_r</span>
                <span class="n">bearing_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_Brg_SealEl</span><span class="p">)</span>

            <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_elements</span><span class="p">)</span>
            <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">regions</span>

        <span class="n">regions</span> <span class="o">=</span> <span class="n">rotor_regions</span><span class="p">(</span><span class="n">nel_r</span><span class="p">)</span>
        <span class="n">shaft_elements</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">disk_elements</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bearing_elements</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">shaft_elements</span><span class="p">,</span>
            <span class="n">disk_elements</span><span class="p">,</span>
            <span class="n">bearing_elements</span><span class="p">,</span>
            <span class="n">min_w</span><span class="o">=</span><span class="n">min_w</span><span class="p">,</span>
            <span class="n">max_w</span><span class="o">=</span><span class="n">max_w</span><span class="p">,</span>
            <span class="n">rated_w</span><span class="o">=</span><span class="n">rated_w</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">CoAxialRotor</span><span class="p">(</span><span class="n">Rotor</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A rotor object.</span>

<span class="sd">    This class will create a system of co-axial rotors with the shaft,</span>
<span class="sd">    disk, bearing and seal elements provided.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shafts : list of lists</span>
<span class="sd">        Each list of shaft elements builds a different shaft. The number of</span>
<span class="sd">        lists sets the number of shafts.</span>
<span class="sd">    disk_elements : list</span>
<span class="sd">        List with the disk elements</span>
<span class="sd">    bearing_elements : list</span>
<span class="sd">        List with the bearing elements</span>
<span class="sd">    point_mass_elements: list</span>
<span class="sd">        List with the point mass elements</span>
<span class="sd">    shaft_start_pos : list</span>
<span class="sd">        List indicating the initial node position for each shaft.</span>
<span class="sd">        Default is zero for each shaft created.</span>
<span class="sd">    tag : str</span>
<span class="sd">        A tag for the rotor</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A rotor object.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nodes : list</span>
<span class="sd">        List of the model&#39;s nodes.</span>
<span class="sd">    nodes_pos : list</span>
<span class="sd">        List with nodal spatial location.</span>
<span class="sd">    CG : float</span>
<span class="sd">        Center of gravity</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import ross as rs</span>
<span class="sd">    &gt;&gt;&gt; steel = rs.materials.steel</span>
<span class="sd">    &gt;&gt;&gt; i_d = 0</span>
<span class="sd">    &gt;&gt;&gt; o_d = 0.05</span>
<span class="sd">    &gt;&gt;&gt; n = 10</span>
<span class="sd">    &gt;&gt;&gt; L = [0.25 for _ in range(n)]</span>
<span class="sd">    &gt;&gt;&gt; axial_shaft = [rs.ShaftElement(l, i_d, o_d, material=steel) for l in L]</span>
<span class="sd">    &gt;&gt;&gt; i_d = 0.15</span>
<span class="sd">    &gt;&gt;&gt; o_d = 0.20</span>
<span class="sd">    &gt;&gt;&gt; n = 6</span>
<span class="sd">    &gt;&gt;&gt; L = [0.25 for _ in range(n)]</span>
<span class="sd">    &gt;&gt;&gt; coaxial_shaft = [rs.ShaftElement(l, i_d, o_d, material=steel) for l in L]</span>
<span class="sd">    &gt;&gt;&gt; shaft = [axial_shaft, coaxial_shaft]</span>
<span class="sd">    &gt;&gt;&gt; disk0 = rs.DiskElement.from_geometry(n=1,</span>
<span class="sd">    ...                                     material=steel,</span>
<span class="sd">    ...                                     width=0.07,</span>
<span class="sd">    ...                                     i_d=0.05,</span>
<span class="sd">    ...                                     o_d=0.28)</span>
<span class="sd">    &gt;&gt;&gt; disk1 = rs.DiskElement.from_geometry(n=9,</span>
<span class="sd">    ...                                     material=steel,</span>
<span class="sd">    ...                                     width=0.07,</span>
<span class="sd">    ...                                     i_d=0.05,</span>
<span class="sd">    ...                                     o_d=0.28)</span>
<span class="sd">    &gt;&gt;&gt; disk2 = rs.DiskElement.from_geometry(n=13,</span>
<span class="sd">    ...                                      material=steel,</span>
<span class="sd">    ...                                      width=0.07,</span>
<span class="sd">    ...                                      i_d=0.20,</span>
<span class="sd">    ...                                      o_d=0.48)</span>
<span class="sd">    &gt;&gt;&gt; disk3 = rs.DiskElement.from_geometry(n=15,</span>
<span class="sd">    ...                                      material=steel,</span>
<span class="sd">    ...                                      width=0.07,</span>
<span class="sd">    ...                                      i_d=0.20,</span>
<span class="sd">    ...                                      o_d=0.48)</span>
<span class="sd">    &gt;&gt;&gt; disks = [disk0, disk1, disk2, disk3]</span>
<span class="sd">    &gt;&gt;&gt; stfx = 1e6</span>
<span class="sd">    &gt;&gt;&gt; stfy = 0.8e6</span>
<span class="sd">    &gt;&gt;&gt; bearing0 = rs.BearingElement(0, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearing1 = rs.BearingElement(10, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearing2 = rs.BearingElement(11, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearing3 = rs.BearingElement(8, n_link=17, kxx=stfx, kyy=stfy, cxx=0)</span>
<span class="sd">    &gt;&gt;&gt; bearings = [bearing0, bearing1, bearing2, bearing3]</span>
<span class="sd">    &gt;&gt;&gt; rotor = rs.CoAxialRotor(shaft, disks, bearings)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">shafts</span><span class="p">,</span>
        <span class="n">disk_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">bearing_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">point_mass_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">min_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rated_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;min_w&quot;</span><span class="p">:</span> <span class="n">min_w</span><span class="p">,</span> <span class="s2">&quot;max_w&quot;</span><span class="p">:</span> <span class="n">max_w</span><span class="p">,</span> <span class="s2">&quot;rated_w&quot;</span><span class="p">:</span> <span class="n">rated_w</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Rotor 0&quot;</span>

        <span class="c1">####################################################</span>
        <span class="c1"># Config attributes</span>
        <span class="c1">####################################################</span>

        <span class="c1"># operational speeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_w</span> <span class="o">=</span> <span class="n">min_w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_w</span> <span class="o">=</span> <span class="n">max_w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rated_w</span> <span class="o">=</span> <span class="n">rated_w</span>

        <span class="c1">####################################################</span>

        <span class="c1"># set n for each shaft element</span>
        <span class="n">aux_n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">aux_n_tag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shafts</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shaft</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">aux_n</span>
                <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sh</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">aux_n_tag</span><span class="p">)</span>
            <span class="n">aux_n</span> <span class="o">=</span> <span class="n">shaft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n_r</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">aux_n_tag</span> <span class="o">=</span> <span class="n">aux_n</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">j</span>

        <span class="c1"># flatten and make a copy for shaft elements to avoid altering</span>
        <span class="c1"># attributes for elements that might be used in different rotors</span>
        <span class="c1"># e.g. altering shaft_element.n</span>
        <span class="n">shafts</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">shafts</span><span class="p">]</span>
        <span class="n">shaft_elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">shafts</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">disk_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">disk_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">bearing_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bearing_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">point_mass_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">point_mass_elements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">disk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disk_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">disk</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Disk &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">brg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">brg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span> <span class="ow">and</span> <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Bearing &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">brg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;SealElement&quot;</span> <span class="ow">and</span> <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">brg</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Seal &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p_mass</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">point_mass_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p_mass</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;Point Mass &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shafts</span> <span class="o">=</span> <span class="n">shafts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">shaft_elements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bearing_elements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span> <span class="o">=</span> <span class="n">disk_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span> <span class="o">=</span> <span class="n">point_mass_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">chain</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_number_dof</span><span class="p">()</span>

        <span class="c1">####################################################</span>
        <span class="c1"># Rotor summary</span>
        <span class="c1">####################################################</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_link&quot;</span><span class="p">,</span>
            <span class="s2">&quot;L&quot;</span><span class="p">,</span>
            <span class="s2">&quot;node_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;node_pos_r&quot;</span><span class="p">,</span>
            <span class="s2">&quot;idl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;odl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;idr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;odr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;i_d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;o_d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;beam_cg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axial_cg_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;y_pos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;material&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rho&quot;</span><span class="p">,</span>
            <span class="s2">&quot;volume&quot;</span><span class="p">,</span>
            <span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">df_shaft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="n">df_disks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="n">df_bearings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_seals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">SealElement</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df_point_mass</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mass_elements</span><span class="p">])</span>

        <span class="n">nodes_pos_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">nodes_pos_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>
        <span class="n">shaft_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span><span class="p">))</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shafts</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">sh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shaft</span><span class="p">):</span>
                <span class="n">shaft_number</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>
                    <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">+</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;n_l&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;n_l&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_shaft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span> <span class="ow">in</span> <span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;n_link&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">df_bearings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_bearings</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span> <span class="ow">in</span> <span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;n_link&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">df_bearings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_bearings</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">sh</span><span class="o">.</span><span class="n">n_r</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nodes_pos_r</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">beam_cg</span> <span class="o">+</span> <span class="n">nodes_pos_l</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span> <span class="o">=</span> <span class="n">axial_cg_pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shaft_number</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_l</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_pos_r</span>
        <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;axial_cg_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axial_cg_pos</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">df_shaft</span><span class="p">,</span> <span class="n">df_disks</span><span class="p">,</span> <span class="n">df_bearings</span><span class="p">,</span> <span class="n">df_point_mass</span><span class="p">,</span> <span class="n">df_seals</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;n_l&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># check consistence for disks and bearings location</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_point_mass</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_loc_point_mass</span> <span class="o">=</span> <span class="n">df_point_mass</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_loc_point_mass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_location</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">max_loc_point_mass</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">n_l</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_location</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trying to set disk or bearing outside shaft&quot;</span><span class="p">)</span>

        <span class="c1"># nodes axial position and diameter</span>
        <span class="n">nodes_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">nodes_i_d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">nodes_o_d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shafts</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">shaft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n_r</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shafts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nodes_pos</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">nodes_i_d</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">nodes_o_d</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nodes_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">nodes_i_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;i_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">nodes_o_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;o_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span> <span class="o">=</span> <span class="n">nodes_pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_i_d</span> <span class="o">=</span> <span class="n">nodes_i_d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_o_d</span> <span class="o">=</span> <span class="n">nodes_o_d</span>

        <span class="n">shaft_elements_length</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;n_l&quot;</span><span class="p">)[</span><span class="s2">&quot;L&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements_length</span> <span class="o">=</span> <span class="n">shaft_elements_length</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_pos</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># rotor mass can also be calculated with self.M()[::4, ::4].sum()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_disks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">disk</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_shaft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sh_el</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">sh_el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_disks</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_shaft</span>

        <span class="c1"># rotor center of mass and total inertia</span>
        <span class="n">CG_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">sh</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">sh</span><span class="o">.</span><span class="n">axial_cg_pos</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">CG_dsk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CG</span> <span class="o">=</span> <span class="n">CG_sh</span> <span class="o">+</span> <span class="n">CG_dsk</span>

        <span class="n">Ip_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sh</span><span class="o">.</span><span class="n">Im</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">])</span>
        <span class="n">Ip_dsk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">disk</span><span class="o">.</span><span class="n">Ip</span> <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span> <span class="o">=</span> <span class="n">Ip_sh</span> <span class="o">+</span> <span class="n">Ip_dsk</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_v0</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># used to call eigs</span>

        <span class="c1"># number of dofs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndof</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="mi">4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">n</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">shaft_elements</span><span class="p">])</span>
            <span class="o">+</span> <span class="mi">8</span>
            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">([</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">point_mass_elements</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">elm_no_shaft_id</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">elm</span>
            <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;shaft_number&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">elm_no_shaft_id</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">elm_no_shaft_id</span><span class="p">:</span>
                    <span class="n">shnum_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
                    <span class="p">]</span>
                    <span class="n">shnum_r</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
                    <span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shnum_l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shnum_r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">shnum_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
                        <span class="p">]</span>
                        <span class="n">shnum_r</span> <span class="o">=</span> <span class="n">shnum_l</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shnum_l</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shnum_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">elm_no_shaft_id</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">elm</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shnum_r</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shnum_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">elm_no_shaft_id</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">elm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">df_disks</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;DiskElement&quot;</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">df_bearings</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">df_seals</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;SealElement&quot;</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">df_point_mass</span><span class="p">[</span><span class="s2">&quot;shaft_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;PointMass&quot;</span><span class="p">),</span> <span class="s2">&quot;shaft_number&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_disks</span> <span class="o">=</span> <span class="n">df_disks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_bearings</span> <span class="o">=</span> <span class="n">df_bearings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_shaft</span> <span class="o">=</span> <span class="n">df_shaft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_point_mass</span> <span class="o">=</span> <span class="n">df_point_mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_seals</span> <span class="o">=</span> <span class="n">df_seals</span>

        <span class="k">if</span> <span class="s2">&quot;n_link&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">df_point_mass</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">aux_link</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;n_link&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
            <span class="n">aux_node</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_point_mass</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aux_link</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">aux_node</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_nodes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># global indexes for dofs</span>
        <span class="n">n_last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">dof_mapping</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_mapping</span><span class="p">()</span>
            <span class="n">global_dof_mapping</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">dof_letter</span><span class="p">,</span> <span class="n">dof_number</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">dof_letter</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dof_number</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>

            <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">global_dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">global_dof_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">v</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="s2">&quot;n_link&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">&lt;=</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x_</span><span class="si">{</span><span class="n">elm</span><span class="o">.</span><span class="n">n_link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;y_</span><span class="si">{</span><span class="n">elm</span><span class="o">.</span><span class="n">n_link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x_</span><span class="si">{</span><span class="n">elm</span><span class="o">.</span><span class="n">n_link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="p">)</span>
                    <span class="n">global_dof_mapping</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;y_</span><span class="si">{</span><span class="n">elm</span><span class="o">.</span><span class="n">n_link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">n_last</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elm</span><span class="o">.</span><span class="n">n_link</span> <span class="o">+</span> <span class="mi">5</span>
                    <span class="p">)</span>

            <span class="n">dof_tuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;GlobalIndex&quot;</span><span class="p">,</span> <span class="n">global_dof_mapping</span><span class="p">)</span>
            <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span> <span class="o">=</span> <span class="n">dof_tuple</span><span class="p">(</span><span class="o">**</span><span class="n">global_dof_mapping</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">elm</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;dof_global_index&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">dof_global_index</span>

        <span class="c1"># define positions for disks</span>
        <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">disk_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="n">nodes_pos</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">nodes_o_d</span><span class="p">[</span><span class="n">disk</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">disk</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>

        <span class="c1"># define positions for bearings</span>
        <span class="c1"># check if there are bearings without location</span>
        <span class="n">bearings_no_zloc</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">b</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearing_elements</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># cycle while there are bearings without a z location</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing_elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bearings_no_zloc</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bearings_no_zloc</span><span class="p">:</span>
                    <span class="c1"># first check if b.n is on list, if not, check for n_link</span>
                    <span class="n">node_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span>
                    <span class="n">node_r</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">node_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">n_link</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="s2">&quot;nodes_pos_l&quot;</span>
                        <span class="p">]</span>
                        <span class="n">node_r</span> <span class="o">=</span> <span class="n">node_l</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_l</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_l</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bearings_no_zloc</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_r</span><span class="p">):</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_r</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bearings_no_zloc</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">dfb</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]]</span>
        <span class="n">z_positions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">z_positions</span><span class="p">))</span>
        <span class="n">mean_od</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">nodes_o_d</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z_pos</span> <span class="ow">in</span> <span class="n">dfb</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]:</span>
            <span class="n">dfb_z_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">nodes_pos_l</span> <span class="o">==</span> <span class="n">z_pos</span><span class="p">]</span>
            <span class="n">dfb_z_pos</span> <span class="o">=</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;n_l&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">nlink</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">dfb_z_pos</span><span class="o">.</span><span class="n">n_link</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                            <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                            <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">y_pos</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                                    <span class="p">[</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                                            <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                                        <span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                                            <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;odr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                                        <span class="p">),</span>
                                    <span class="p">]</span>
                                <span class="p">)</span>
                                <span class="o">/</span> <span class="mi">2</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y_pos</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mean_od</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">nlink</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">z_pos</span> <span class="o">==</span> <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">n_r</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idr&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                                    <span class="p">[</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                                            <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idl&quot;</span><span class="p">][</span><span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                                        <span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                                            <span class="n">df_shaft</span><span class="p">[</span><span class="s2">&quot;idr&quot;</span><span class="p">][</span>
                                                <span class="n">df_shaft</span><span class="o">.</span><span class="n">_n</span> <span class="o">==</span> <span class="n">nlink</span> <span class="o">-</span> <span class="mi">1</span>
                                            <span class="p">]</span><span class="o">.</span><span class="n">values</span>
                                        <span class="p">),</span>
                                    <span class="p">]</span>
                                <span class="p">)</span>
                                <span class="o">/</span> <span class="mi">2</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y_pos_sup</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">y_pos</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mean_od</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;y_pos_sup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos_sup</span>

        <span class="c1"># define position for point mass elements</span>
        <span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;BearingElement&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">point_mass_elements</span><span class="p">:</span>
            <span class="n">z_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">dfb</span><span class="p">[</span><span class="n">dfb</span><span class="o">.</span><span class="n">n_l</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;nodes_pos_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_pos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pos</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">rotor_example</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Create a rotor as example.</span>

<span class="sd">    This function returns an instance of a simple rotor with</span>
<span class="sd">    two shaft elements, one disk and two simple bearings.</span>
<span class="sd">    The purpose of this is to make available a simple model</span>
<span class="sd">    so that doctest can be written using this.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    An instance of a rotor object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; rotor = rotor_example()</span>
<span class="sd">    &gt;&gt;&gt; modal = rotor.run_modal(speed=0)</span>
<span class="sd">    &gt;&gt;&gt; np.round(modal.wd[:4])</span>
<span class="sd">    array([ 92.,  96., 275., 297.])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#  Rotor without damping with 6 shaft elements 2 disks and 2 bearings</span>
    <span class="n">i_d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">o_d</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">shaft_elem</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ShaftElement</span><span class="p">(</span>
            <span class="n">l</span><span class="p">,</span>
            <span class="n">i_d</span><span class="p">,</span>
            <span class="n">o_d</span><span class="p">,</span>
            <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span>
            <span class="n">shear_effects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">rotary_inertia</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">gyroscopic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">L</span>
    <span class="p">]</span>

    <span class="n">disk0</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span>
    <span class="p">)</span>
    <span class="n">disk1</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span>
    <span class="p">)</span>

    <span class="n">stfx</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">stfy</span> <span class="o">=</span> <span class="mf">0.8e6</span>
    <span class="n">bearing0</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bearing1</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Rotor</span><span class="p">(</span><span class="n">shaft_elem</span><span class="p">,</span> <span class="p">[</span><span class="n">disk0</span><span class="p">,</span> <span class="n">disk1</span><span class="p">],</span> <span class="p">[</span><span class="n">bearing0</span><span class="p">,</span> <span class="n">bearing1</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">coaxrotor_example</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Create a rotor as example.</span>

<span class="sd">    This function returns an instance of a simple rotor with</span>
<span class="sd">    two shafts, four disk and four bearings.</span>
<span class="sd">    The purpose of this is to make available a simple model for co-axial rotors</span>
<span class="sd">    so that doctest can be written using this.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    An instance of a rotor object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import ross as rs</span>
<span class="sd">    &gt;&gt;&gt; rotor = rs.coaxrotor_example()</span>

<span class="sd">    Plotting rotor model</span>
<span class="sd">    &gt;&gt;&gt; fig = rotor.plot_rotor()</span>

<span class="sd">    &gt;&gt;&gt; modal = rotor.run_modal(speed=0)</span>
<span class="sd">    &gt;&gt;&gt; np.round(modal.wd[:4])</span>
<span class="sd">    array([39., 39., 99., 99.])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i_d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">o_d</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">axial_shaft</span> <span class="o">=</span> <span class="p">[</span><span class="n">ShaftElement</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i_d</span><span class="p">,</span> <span class="n">o_d</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>

    <span class="n">i_d</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">o_d</span> <span class="o">=</span> <span class="mf">0.30</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">coaxial_shaft</span> <span class="o">=</span> <span class="p">[</span><span class="n">ShaftElement</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i_d</span><span class="p">,</span> <span class="n">o_d</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>

    <span class="n">disk0</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>
    <span class="n">disk1</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>
    <span class="n">disk2</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.48</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>
    <span class="n">disk3</span> <span class="o">=</span> <span class="n">DiskElement</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.48</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>

    <span class="n">shaft</span> <span class="o">=</span> <span class="p">[</span><span class="n">axial_shaft</span><span class="p">,</span> <span class="n">coaxial_shaft</span><span class="p">]</span>
    <span class="n">disks</span> <span class="o">=</span> <span class="p">[</span><span class="n">disk0</span><span class="p">,</span> <span class="n">disk1</span><span class="p">,</span> <span class="n">disk2</span><span class="p">,</span> <span class="n">disk3</span><span class="p">]</span>

    <span class="n">stfx</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">stfy</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">bearing0</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_link</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">bearing1</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span>
        <span class="mi">10</span><span class="p">,</span> <span class="n">n_link</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.4</span>
    <span class="p">)</span>
    <span class="n">bearing2</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">bearing3</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_link</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">stfx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">stfy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">base0</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">base1</span> <span class="o">=</span> <span class="n">BearingElement</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">pointmass0</span> <span class="o">=</span> <span class="n">PointMass</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">pointmass1</span> <span class="o">=</span> <span class="n">PointMass</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">bearings</span> <span class="o">=</span> <span class="p">[</span><span class="n">bearing0</span><span class="p">,</span> <span class="n">bearing1</span><span class="p">,</span> <span class="n">bearing2</span><span class="p">,</span> <span class="n">bearing3</span><span class="p">,</span> <span class="n">base0</span><span class="p">,</span> <span class="n">base1</span><span class="p">]</span>
    <span class="n">pointmasses</span> <span class="o">=</span> <span class="p">[</span><span class="n">pointmass0</span><span class="p">,</span> <span class="n">pointmass1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">CoAxialRotor</span><span class="p">(</span><span class="n">shaft</span><span class="p">,</span> <span class="n">disks</span><span class="p">,</span> <span class="n">bearings</span><span class="p">,</span> <span class="n">pointmasses</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rotor_example_6dof</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This function returns an instance of a simple rotor with</span>
<span class="sd">    two shaft elements, one disk and two simple bearings.</span>
<span class="sd">    The purpose of this is to make available a simple model</span>
<span class="sd">    so that doctest can be written using this.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    An instance of a 6DoFs rotor object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import ross as rs</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; rotor6 = rs.rotor_assembly.rotor_example_6dof()</span>
<span class="sd">    &gt;&gt;&gt; camp6 = rotor6.run_campbell(np.linspace(0,400,101),frequencies=18)</span>

<span class="sd">    # plotting Campbell Diagram</span>
<span class="sd">    &gt;&gt;&gt; fig = camp6.plot()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#  Rotor with 6 DoFs, with internal damping, with 10 shaft elements, 2 disks and 2 bearings.</span>
    <span class="n">i_d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">o_d</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">shaft_elem</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ShaftElement6DoF</span><span class="p">(</span>
            <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span>
            <span class="n">L</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">idl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">odl</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">idr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">odr</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">beta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">rotary_inertia</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">shear_effects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">L</span>
    <span class="p">]</span>

    <span class="n">disk0</span> <span class="o">=</span> <span class="n">DiskElement6DoF</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span>
    <span class="p">)</span>
    <span class="n">disk1</span> <span class="o">=</span> <span class="n">DiskElement6DoF</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">steel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">i_d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">o_d</span><span class="o">=</span><span class="mf">0.28</span>
    <span class="p">)</span>

    <span class="n">kxx</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">kyy</span> <span class="o">=</span> <span class="mf">0.8e6</span>
    <span class="n">kzz</span> <span class="o">=</span> <span class="mf">1e5</span>
    <span class="n">cxx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cyy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">czz</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bearing0</span> <span class="o">=</span> <span class="n">BearingElement6DoF</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">kxx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">kyy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="n">cxx</span><span class="p">,</span> <span class="n">cyy</span><span class="o">=</span><span class="n">cyy</span><span class="p">,</span> <span class="n">kzz</span><span class="o">=</span><span class="n">kzz</span><span class="p">,</span> <span class="n">czz</span><span class="o">=</span><span class="n">czz</span>
    <span class="p">)</span>
    <span class="n">bearing1</span> <span class="o">=</span> <span class="n">BearingElement6DoF</span><span class="p">(</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">kxx</span><span class="o">=</span><span class="n">kxx</span><span class="p">,</span> <span class="n">kyy</span><span class="o">=</span><span class="n">kyy</span><span class="p">,</span> <span class="n">cxx</span><span class="o">=</span><span class="n">cxx</span><span class="p">,</span> <span class="n">cyy</span><span class="o">=</span><span class="n">cyy</span><span class="p">,</span> <span class="n">kzz</span><span class="o">=</span><span class="n">kzz</span><span class="p">,</span> <span class="n">czz</span><span class="o">=</span><span class="n">czz</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">Rotor</span><span class="p">(</span><span class="n">shaft_elem</span><span class="p">,</span> <span class="p">[</span><span class="n">disk0</span><span class="p">,</span> <span class="n">disk1</span><span class="p">],</span> <span class="p">[</span><span class="n">bearing0</span><span class="p">,</span> <span class="n">bearing1</span><span class="p">])</span>
</pre></div>

    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Team ROSS.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.1.<br/>
    </p>
  </div>
</footer>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-157532410-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-157532410-1');
</script>

  </body>
</html>